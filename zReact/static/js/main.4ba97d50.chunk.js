(this["webpackJsonpGooFlow-React"]=this["webpackJsonpGooFlow-React"]||[]).push([[0],{15:function(e,t,s){},24:function(e,t,s){},46:function(e,t,s){},47:function(e,t,s){},72:function(e,t,s){},77:function(e,t,s){"use strict";s.r(t);var i=s(1),o=s.n(i),n=s(37),r=s.n(n),a=(s(46),s(2)),l=s(3),h=s(4),d=s(5),c=s(12),p=s(8),u=s.p+"static/media/logo.2d27ead7.svg",f=(s(47),s(0)),m=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(){return Object(a.a)(this,s),t.apply(this,arguments)}return Object(l.a)(s,[{key:"render",value:function(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsxs)("header",{className:"App-header",children:[Object(f.jsx)("img",{src:u,className:"App-logo",alt:"logo"}),Object(f.jsxs)("p",{children:[" Edit ",Object(f.jsx)("code",{children:"src/App.js"})," and save to reload. "]}),Object(f.jsx)("a",{className:"App-link",href:"https://reactjs.org",target:"_blank",rel:"noopener noreferrer",children:"Learn React"})]})})}}]),s}(i.Component),g=m,v=s(41),$=s(6),b=function(e){return e||(e=window.event),e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:{x:e.clientX+document.documentElement.scrollLeft-document.body.clientLeft,y:e.clientY+document.documentElement.scrollTop-document.body.clientTop}},y=function(e){var t=e.offsetTop,s=e.offsetLeft;for(e=e.offsetParent;e;)t+=e.offsetTop,s+=e.offsetLeft,e=e.offsetParent;return{top:t,left:s}},x={mouseP:b,elCsys:y,getCoor:function(e,t){var s=b(e),i=y(t);return{X:s.x-i.left+t.parentNode.scrollLeft,Y:s.y-i.top+t.parentNode.scrollTop}},calcPolyPoints:function(e,t,s,i,o,n,r){r||(r=1);var a,l,h={left:e.left*r,top:e.top*r,width:e.width*r,height:e.height*r},d={left:t.left*r,top:t.top*r,width:t.width*r,height:t.height*r},c=o*r,p=i*r,u=n*r,f={x:h.left+h.width/2,y:h.top+h.height/2},m={x:d.left+d.width/2,y:d.top+d.height/2},g=[],v=[],$=[],b=[];return a=[f.x,f.y],l=[m.x,m.y],"lr"===s?(v=[c,p],$=[c,u],b=[m.x,u],(g=[f.x,p])[1]>h.top&&g[1]<h.top+h.height?(g[0]=v[0]<f.x?h.left:h.left+h.width,a[0]=g[0],a[1]=g[1]):a[1]=g[1]<h.top?h.top:h.top+h.height,g[0]===a[0]&&g[1]===a[1]&&(v[0]>h.left&&v[0]<h.left+h.width?(v[1]=f.y>$[1]?h.top:h.top+h.height,a[0]=v[0],a[1]=v[1],g[0]=v[0],g[1]=v[1]):(a[0]=v[0]<h.left?h.left:h.left+h.width,g[0]=a[0])),b[1]>d.top&&b[1]<d.top+d.height?(b[0]=$[0]>m.x?d.left+d.width:d.left,l[0]=b[0],l[1]=b[1]):l[1]=b[1]<d.top?d.top:d.top+d.height,b[0]===l[0]&&b[1]===l[1]&&($[0]>d.left&&$[0]<d.left+d.width?($[1]=m.y>v[1]?d.top:d.top+d.height,l[0]=$[0],l[1]=$[1],b[0]=$[0],b[1]=$[1]):(l[0]=$[0]<d.left?d.left:d.left+d.width,b[0]=l[0]))):"tb"===s&&(v=[p,c],$=[u,c],b=[u,m.y],(g=[p,f.y])[0]>h.left&&g[0]<h.left+h.width?(g[1]=v[1]<f.y?h.top:h.top+h.height,a[0]=g[0],a[1]=g[1]):a[0]=g[0]<h.left?h.left:h.left+h.width,g[0]===a[0]&&g[1]===a[1]&&(v[1]>h.top&&v[1]<h.top+h.height?(v[0]=f.x>$[0]?h.left:h.left+h.width,a[0]=v[0],a[1]=v[1],g[0]=v[0],g[1]=v[1]):(a[1]=v[1]<h.top?h.top:h.top+h.height,g[1]=a[1])),b[0]>d.left&&b[0]<d.left+d.width?(b[1]=$[1]>m.y?d.top+d.height:d.top,l[0]=b[0],l[1]=b[1]):l[0]=b[0]<d.left?d.left:d.left+d.width,b[0]===l[0]&&b[1]===l[1]&&($[1]>d.top&&$[1]<d.top+d.height?($[0]=m.x>v[0]?d.left:d.left+d.width,l[0]=$[0],l[1]=$[1],b[0]=$[0],b[1]=$[1]):(l[1]=$[1]<d.top?d.top:d.top+d.height,b[1]=l[1]))),{start:a,m0:g,m1:v,m2:$,m3:b,end:l}},getMValue:function(e,t,s,i){return i||(i=1),"lr"===s?(e.left*i+e.width*i/2+t.left*i+t.width*i/2)/2:"tb"===s?(e.top*i+e.height*i/2+t.top*i+t.height*i/2)/2:void 0},calcStartEnd:function(e,t,s){var i,o,n,r;s||(s=1);var a=e.left*s,l=e.left*s+e.width*s,h=t.left*s,d=t.left*s+t.width*s;a>=d?(i=a,n=d):l<=h?(i=l,n=h):a<=h&&l>=h&&l<=d?n=i=(l+h)/2:a>=h&&l<=d?n=i=(a+l)/2:h>=a&&d<=l?n=i=(h+d)/2:a<=d&&l>=d&&(n=i=(a+d)/2);var c=e.top*s,p=e.top*s+e.height*s,u=t.top*s,f=t.top*s+t.height*s;return c>=f?(o=c,r=f):p<=u?(o=p,r=u):c<=u&&p>=u&&p<=f?r=o=(p+u)/2:c>=u&&p<=f?r=o=(c+p)/2:u>=c&&f<=p?r=o=(u+f)/2:c<=f&&p>=f&&(r=o=(c+f)/2),{start:[i,o],end:[n,r]}},drawRect:function(e,t,s,i){if(s[0]!==t[0]||s[1]!==t[1]){for(var o="",n=[s[0],s[1]],r=0;r<n.length;++r){var a=(n[r]-t[r])/2;a>0?n[r]-=e>a?a:e:a<0&&(n[r]+=e>-a?-a:e)}o+=" L "+n[0]+" "+n[1]+" Q "+s[0]+" "+s[1],n=[s[0],s[1]];for(var l=0;l<n.length;++l){var h=(n[l]-i[l])/2;h>0?n[l]-=e>h?h:e:h<0&&(n[l]+=e>-h?-h:e)}return o+=" "+n[0]+" "+n[1]}},stopEventPop:function(e){e||(e=window.event),window.event?e.cancelBubble=!0:e.stopPropagation()},isDrawingLine:function(e){var t="object"===typeof e?e.state.$nowType:e;return"direct"===t||"dirDashed"===t||"segment"===t||"segDashed"===t},getRealStyle:function(e){return getComputedStyle(e,"style")||e.style||null}},w=function(e,t){for(var s=0;s<t.length;++s)if(e===t[s])return!0;return!1},j=function(e,t,s,i,o){"function"===typeof o&&e.addEventListener(t,(function(t){t||(t=window.event);var n=e.querySelectorAll(s),r=t.target;if("1"===r.getAttribute("data-stop-bubble"))return!1;for(;r!==e&&!w(r,n);)if("1"===(r=r.parentNode).getAttribute("data-stop-bubble"))return!1;return r&&r!==e&&(t.data=i,!1===o(t,r)&&(function(e){e||(e=window.event),window.event?e.cancelBubble=!0:e.stopPropagation()}(t),function(e){window.event?window.event.returnValue=!1:e.preventDefault()}(t))),!1}))},k={hasClass:function(e,t){return 0!==(t=t||"").replace(/\s/g,"").length&&new RegExp(" "+t+" ").test(" "+e.className+" ")},addClass:function(e,t){this.hasClass(e,t)||(e.className=""===e.className?t:e.className+" "+t)},removeClass:function(e,t){if(this.hasClass(e,t)){for(var s=" "+e.className.replace(/[\t\r\n]/g,"")+" ";s.indexOf(" "+t+" ")>=0;)s=s.replace(" "+t+" "," ");e.className=s.replace(/^\s+|\s+$/g,"")}},css:function(e,t){for(var s in t)e.style[s]=t[s]}},O={_renameTxtHide:function(){this.$refs.$textArea.value="",this.$refs.$textArea.removeAttribute("data-id"),this.$refs.$textArea.style.display="none"},_renameTxtShow:function(e){for(var t in e)this.$refs.$textArea.style[t]="number"===typeof e[t]?e[t]+"px":e[t];this.$refs.$textArea.style.display="block"},_renderHeadBtnClick:function(e){switch(e){case"ico_new":null!==this.onBtnNewClick&&this.onBtnNewClick();break;case"ico_open":null!==this.onBtnOpenClick&&this.onBtnOpenClick();break;case"ico_save":null!==this.onBtnSaveClick&&this.onBtnSaveClick();break;case"ico_undo":this.undo();break;case"ico_redo":this.redo();break;case"ico_reload":null!==this.onFreshClick&&this.onFreshClick();break;case"ico_print":null!==this.onPrintClick&&this.onPrintClick();break;default:var t=e.split("ico_")[1];"undefined"!==typeof this.$headBtnEvents&&"function"===typeof this.$headBtnEvents[t]&&this.$headBtnEvents[t].call(this)}},_initOperStack:function(){this.$isUndo=0,this.pushOper=function(e,t){1===this.$isUndo?(this.$redoStack.push([e,t]),this.$isUndo=0,this.$redoStack.length>50&&this.$redoStack.shift(),this.$refs.$head&&this.$refs.$head._checkStack(this.$undoStack,this.$redoStack,"redo")):(this.$undoStack.push([e,t]),this.$undoStack.length>50&&this.$undoStack.shift(),0===this.$isUndo&&this.$redoStack.splice(0,this.$redoStack.length),this.$isUndo=0,this.$refs.$head&&this.$refs.$head._checkStack(this.$undoStack,this.$redoStack))},this.pushExternalOper=function(e,t){this.pushOper("externalFunc",[e,t])},this.undo=function(){if(0!==this.$undoStack.length){this.blurItem();var e=this.$undoStack.pop();this.$isUndo=1,"externalFunc"===e[0]?e[1][0](e[1][1]):this[e[0]].apply(this,e[1]),this.$refs.$head&&this.$refs.$head._checkStack(this.$undoStack,this.$redoStack)}},this.redo=function(){if(0!==this.$redoStack.length){this.blurItem();var e=this.$redoStack.pop();this.$isUndo=2,"externalFunc"===e[0]?e[1][0](e[1][1]):this[e[0]].apply(this,e[1]),this.$refs.$head&&this.$refs.$head._checkStack(this.$undoStack,this.$redoStack)}}},_node2Area:function(e){if(this.extFlag.group){var t=this.state.$nodes[e],s=!1;for(var i in this.state.$areas){var o=this.state.$areas[i];if(t.left>=o.left&&t.left<o.left+o.width&&t.top>=o.top&&t.top<o.top+o.height){this.state.$nodes[e].areaId=i,s=!0;break}}s||delete this.state.$nodes[e].areaId}},_setPolyCoor:function(e,t,s,i,o,n){var r=this.state.$lines[e];if(!r||t<0||r[s]===t||!r.type||"sl"===r.type)return!1;if(!1!==o&&"function"===typeof this.onLineMove&&!1===this.onLineMove(e,t,s||"M"))return!1;if("function"===typeof this.pushOper&&!i){var a=[e,r[s]];this.pushOper("setLine"+s,a)}r[s]=t,this.$editable&&(r.alt=!0),this.state.$lines[e]=r,this.setState({$lines:this.state.$lines}),!n&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))},_resetLines:function(e){var t=this.state.$lines,s=!1;for(var i in t)t[i].from!==e&&t[i].to!==e||(s=!0);s&&this.setState({$lines:t})},_suitSize:function(){var e=0,t=0;for(var s in this.state.$nodes){var i=this.state.$nodes[s];e<i.width+i.left&&(e=i.width+i.left),t<i.height+i.top&&(t=i.height+i.top)}if(null!=this.$group)for(var o in this.state.$areas){var n=this.state.$areas[o];e<n.width+n.left&&(e=n.width+n.left),t<n.height+n.top&&(t=n.height+n.top)}for(var r in this.state.$lines){var a=this.state.$lines[r];""!==a.M&&"lt"===a.type&&e<a.M&&(e=a.M+4),""!==a.M&&"tb"===a.type&&t<a.M&&(t=a.M+4)}if(null!=this.$paper)for(var l in this.state.$memos){var h=this.state.$memos[l];e<h.width+h.left&&(e=h.width+h.left),t<h.height+h.top&&(t=h.height+h.top)}return{width:e*this.scale,height:t*this.scale}},_buildWorkSize:function(){for(var e=this.$refs.$workArea.parentNode,t=e.offsetWidth,s=e.offsetHeight,i=this._suitSize();i.width>t;)t+=this.$workExtendStep;for(;i.height>s;)s+=this.$workExtendStep;return{width:t,height:s,haveData:i.width>0&&i.height>0}},_bindMoveEvent:function(e,t,s,i,o,n){var r=x.mouseP(e),a=this.t;i||(i="move");var l=this.$refs.$workArea,h=0,d=0,c=e.id,p=r.x-a.left+l.parentNode.scrollLeft,u=r.y-a.top+l.parentNode.scrollTop,f=this.$refs.$ghost;"move"!==i?(f.show({width:t.width*this.scale+"px",height:t.height*this.scale+"px",top:t.top*this.scale+a.top-l.parentNode.scrollTop+"px",left:t.left*this.scale+a.left-l.parentNode.scrollLeft+"px",cursor:i}),h=t.left*this.scale+t.width*this.scale-p,d=t.top*this.scale+t.height*this.scale-u):(h=p-t.left*this.scale,d=u-t.top*this.scale);var m=!1,g=this;document.onmousemove=function(e){e||(e=window.event);var s=x.mouseP(e);if("move"!==i)switch(p=s.x-a.left+l.parentNode.scrollLeft-t.left*g.scale+h,u=s.y-a.top+l.parentNode.scrollTop-t.top*g.scale+d,p<o*g.scale&&(p=o*g.scale),u<n*g.scale&&(u=n*g.scale),i){case"nw-resize":f.show({width:p+"px",height:u+"px"});break;case"w-resize":f.show({width:p+"px"});break;case"n-resize":f.show({height:u+"px"})}else{if(p===s.x-h&&u===s.y-d)return x.stopEventPop(e),!1;if(p=s.x-h,u=s.y-d,f.inShow()||f.css({width:t.width*g.scale+"px",height:t.height*g.scale+"px",top:t.top*g.scale+a.top-l.parentNode.scrollTop+"px",left:t.left*g.scale+a.left-l.parentNode.scrollLeft+"px",cursor:"move"}),m&&f.show(),p<a.left-l.parentNode.scrollLeft&&!t.canOver?p=a.left-l.parentNode.scrollLeft:p+l.parentNode.scrollLeft+t.width*g.scale>a.left+l.offsetWidth&&!t.canOver&&(p=a.left+l.offsetWidth-l.parentNode.scrollLeft-t.width*g.scale),u<a.top-l.parentNode.scrollTop&&!t.canOver?u=a.top-l.parentNode.scrollTop:u+l.parentNode.scrollTop+t.height*g.scale>a.top+l.offsetHeight&&!t.canOver&&(u=a.top+l.offsetHeight-l.parentNode.scrollTop-t.height*g.scale),m?f.show({left:p+"px",top:u+"px"}):f.css({left:p+"px",top:u+"px"}),g.extFlag.autoalign){var r=g._locAlignLine(c,f,g.state.$nowType);g._magnetic(f,r),p=parseInt(f.$el.style.left.split("px")[0],10),u=parseInt(f.$el.style.top.split("px")[0],10)}}m=!0},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null;var e=(p+l.parentNode.scrollLeft-a.left)/g.scale,t=(u+l.parentNode.scrollTop-a.top)/g.scale,o=f.offsetSize();f.$el.innerHTML="",f.hide();var n=o.width/g.scale,r=o.height/g.scale;g.extFlag.autoalign&&(g.$refs.$alignH.style.display="none",g.$refs.$alignV.style.display="none"),s&&"function"===typeof s&&s(m,g,i,e,t,n,r)}},_initDraw:function(){var e=this;j(this.$refs.$draw,"click","g",{},(function(t,s){e.$multiKey&&e._isMultiKey(t)?(e.state.$focus===s.id&&e.blurItem(),e.$editable&&e.$multiLines&&(e.$multiLines[s.id]?e._removeFromMultiList(s.id,"line",!0):e._addtoMultiList(s.id,"line",!0))):e.state.$focus!==s.id?e.focusItem(s.id,!0):e.$editable&&e.$refs.$lineOper.setTid(s.id)})),this.$editable&&(j(this.$refs.$draw,"contextmenu","g",{},(function(t,s){if("function"===typeof e.onItemRightClick&&!1===e.onItemRightClick(s.id,"line"))return t.preventDefault(),!1})),j(this.$refs.$draw,"dblclick","g",{},(function(t,s){if("function"!==typeof e.onItemDbClick||!1!==e.onItemDbClick(s.id,"line")){var i=s.querySelector("text").textContent,o=s.getAttribute("from").split(","),n=s.getAttribute("to").split(",");"lr"===e.state.$lines[s.id].type?(o[0]=e.state.$lines[s.id].M*e.scale,n[0]=o[0]):"tb"===e.state.$lines[s.id].type&&(o[1]=e.state.$lines[s.id].M*e.scale,n[1]=o[1]);var r=(parseInt(o[0],10)+parseInt(n[0],10))/2-64,a=(parseInt(o[1],10)+parseInt(n[1],10))/2-18,l=e.t;e.$refs.$textArea.value=i,e._renameTxtShow({width:130,height:26,left:l.left+r-e.$refs.$workArea.parentNode.scrollLeft,top:l.top+a-e.$refs.$workArea.parentNode.scrollTop}),e.$refs.$textArea.setAttribute("data-id",e.state.$focus),e.$refs.$textArea.focus(),e.$refs.$workArea.parentNode.onmousedown=function(t){e.$refs.$workArea.parentNode.onmousedown=null,2!==t.button?(e.setName(e.$refs.$textArea.getAttribute("data-id"),e.$refs.$textArea.value,"line"),e._renameTxtHide()):x.stopEventPop(t)}}})))},_initWorkForNode:function(){var e=this;j(this.$refs.$workArea,"click",".GooFlow_item",{},(function(t,s){e.state.$focus===s.id||e.$multiKey&&e._isMultiKey(t)?k.hasClass(t.target,"rs_close")&&e.$editable?e.delNode(s.id):e.$multiKey&&e._isMultiKey(t)&&(e.state.$focus===s.id&&e.blurItem(),e.$editable&&e.$multiNodes&&(e.$multiNodes[s.id]?e._removeFromMultiList(s.id,"node",!0):e._addtoMultiList(s.id,"node",!0))):e.focusItem(s.id,!0),x.stopEventPop(t)})),j(this.$refs.$workArea,"contextmenu",".GooFlow_item",{},(function(t,s){if("function"===typeof e.onItemRightClick&&!1===e.onItemRightClick(s.id,"node"))return x.stopEventPop(t),!1}));var t=function(e){e.$refs.$workArea.parentNode.onmousedown=function(t){if(e.$refs.$workArea.parentNode.onmousedown=null,2!==t.button){var s=e.$refs.$textArea;e.setName(s.getAttribute("data-id"),s.value,"node"),e._renameTxtHide()}else x.stopEventPop(t)}};j(this.$refs.$workArea,"dblclick",".GooFlow_item",{},(function(s,i){var o=i.id;if("function"===typeof e.onItemDbClick&&!1===e.onItemDbClick(o,"node"))return!1;if(e.$editable&&!e.$slotNodeRenders[e.state.$nodes[o]]){var n=s.target,r=e.t,a=e.$refs.$textArea,l="";if(k.hasClass(n,"ico"));else if("DIV"===n.tagName.toUpperCase()&&k.hasClass(n,"span"))l=n.innerHTML,a.value=l,e._renameTxtShow({height:i.offsetHeight+6,width:100,left:r.left+e.state.$nodes[o].left*e.scale-e.$refs.$workArea.parentNode.scrollLeft-26,top:r.top+e.state.$nodes[o].top*e.scale-e.$refs.$workArea.parentNode.scrollTop+26}),a.setAttribute("data-id",e.state.$focus),a.focus(),t(e);else if("DIV"===n.tagName.toUpperCase()&&k.hasClass(n,"txtpd")||"SPAN"===n.tagName.toUpperCase()){var h=i.querySelector(".txtpd");l=h.childNodes[0].innerHTML,a.value=l,e._renameTxtShow({width:h.offsetWidth+26,height:h.offsetHeight+6,left:r.left+26+e.state.$nodes[o].left*e.scale-e.$refs.$workArea.parentNode.scrollLeft,top:r.top+2+e.state.$nodes[o].top*e.scale-e.$refs.$workArea.parentNode.scrollTop}),a.setAttribute("data-id",e.state.$focus),a.focus(),t(e)}}})),this.$editable&&(j(this.$refs.$workArea,"mousedown",".GooFlow_item",{},(function(t,s){if(2===t.button)return!1;var i=s.id,o=e.state.$nodes[i],n=t.target,r=e.$slotNodeRenders[o.type];if(x.isDrawingLine(e)){var a,l,h=x.mouseP(t),d=x.elCsys(e.$refs.$workArea);a=h.x-d.left+e.$refs.$workArea.parentNode.scrollLeft,l=h.y-d.top+e.$refs.$workArea.parentNode.scrollTop,e.lineStart={x:a,y:l,id:i},e.$refs.$tmpLine.setState2({d:"M "+a+" "+l+" L "+a+" "+l,display:"block",dash:"dirDashed"===e.state.$nowType||"segDashed"===e.state.$nowType,noArrow:"segment"===e.state.$nowType||"segDashed"===e.state.$nowType}),x.stopEventPop(t)}else if(r||"I"!==n.tagName&&!k.hasClass(n,"ico")&&!k.hasClass(n,"txtpd")&&"SPAN"!==n.tagName){if("DIV"===n.tagName.toUpperCase()&&(k.hasClass(n,"rs_bottom")||k.hasClass(n,"rs_right")||k.hasClass(n,"rs_rb"))){var c=k.hasClass(n,"rs_bottom")?"n-resize":k.hasClass(n,"rs_right")?"w-resize":"nw-resize";if("pointer"===c)return;i=e.state.$focus,e.switchToolBtn("cursor"),x.stopEventPop(t),e.$refs.$ghost.$el.style.cursor=c,o=e.state.$nodes[i],e._bindMoveEvent(t,o,(function(e,t,s,o,n,r,a){e&&t.resizeNode(i,r,a)}),c,r&&r.minWidth||104,r&&r.minHeight||26)}else if(r){var p=s.childNodes[0].cloneNode(!0);e.$refs.$ghost.append(p),t.id=i,e._bindMoveEvent(t,o,(function(e,t,s,o,n){e&&t.moveNode(i,o,n),i!==t.state.$focus&&t.focusItem(i,!0)}))}}else{if(x.isDrawingLine(e))return;if("cursor"===e.state.$nowType&&e.$refs.$multiGhost&&e.$refs.$multiGhost.inShow())return;var u=s.childNodes[0].cloneNode(!0);e.$refs.$ghost.append(u),t.id=i,e._bindMoveEvent(t,o,(function(e,t,s,o,n){e&&t.moveNode(i,o,n),i!==t.state.$focus&&t.focusItem(i,!0)}))}})),j(this.$refs.$workArea,"mouseup",".GooFlow_item",{},(function(t,s){if(x.isDrawingLine(e)||e.$refs.$mpTo.getP()){var i=e.lineStart,o=e.lineEnd;if(i&&!e.$refs.$mpTo.getP()){var n={from:i.id,to:s.id,name:"",M:"",type:"sl"};"dirDashed"!==e.state.$nowType&&"segDashed"!==e.state.$nowType||(n.dash=!0),"segment"!==e.state.$nowType&&"segDashed"!==e.state.$nowType||(n.noArrow=!0),e.addLine((new Date).getTime(),n),e.$max++}else i?e.moveLinePoints(e.state.$focus,i.id,s.id):o&&e.moveLinePoints(e.state.$focus,s.id,o.id)}})))},_initEditFunc:function(){var e=this;this.$refs.$workArea.addEventListener("mousemove",(function(t){if((x.isDrawingLine(e)||e.$refs.$mpTo.getP())&&(e.lineStart||e.lineEnd)){var s=x.mouseP(t),i=x.elCsys(this),o=s.x-i.left+this.parentNode.scrollLeft,n=s.y-i.top+this.parentNode.scrollTop,r=e.$refs.$tmpLine.getState2();e.lineStart?r.d="M "+e.lineStart.x+" "+e.lineStart.y+" L "+o+" "+n:e.lineEnd&&(r.d="M "+o+" "+n+" L "+e.lineEnd.x+" "+e.lineEnd.y),r.noArrow="segment"===e.state.$nowType||"segDashed"===e.state.$nowType,r.dash="dirDashed"===e.state.$nowType||"segDashed"===e.state.$nowType,e.$refs.$tmpLine.setState2(r)}})),this.$refs.$workArea.addEventListener("mouseup",(function(t){if(x.isDrawingLine(e)||e.$refs.$mpTo.getP()){var s=e.$refs.$tmpLine.getState2();"none"!==s.display?(delete e.lineStart,delete e.lineEnd,s.display="none",e.$refs.$tmpLine.setState2(s),e.$refs.$mpTo.hide(),e.$refs.$mpFrom.hide(),e.focusItem(e.state.$focus,!1)):e.$refs.$lineOper.setTid(0)}})),this.$refs.$workArea.addEventListener("keydown",(function(t){if(!e.$refs.$ghost.inShow()&&"none"===e.$refs.$textArea.style.display)switch(t.keyCode){case 46:if(""!==e.state.$focus)e.delNode(e.state.$focus,!0),e.delLine(e.state.$focus);else if("cursor"===e.state.$nowType&&e.$refs.$multiGhost&&e.$refs.$multiGhost.inShow()){var s=[],i=[];for(var o in e.$multiNodes)s.push(o);for(var n in e.$multiLines)i.push(n);e.batchDelete(s,i),e._wallAllMulti()}break;case 67:if(t.ctrlKey){if(!e.state.$nodes[e.state.$focus])return;e.copyNode(e.state.$focus)}break;case 86:if(t.ctrlKey){if(!e.$clipNode||null==e.$clipNode)return;e.parseNode()}}}))},_initExpendFunc:function(){var e=this.$workExtendStep,t=this.$refs.$workArea,s=this,i=this.$refs.$workArea.parentNode;this.$refs.$extendRight.addEventListener("click",(function(o){t.style.width=t.offsetWidth+e+"px",s.$refs.$alignV&&(s.$refs.$alignV.style.width=t.style.width),i.scrollLeft=i.scrollWidth,i.style.overflow="scroll",x.stopEventPop(o)})),this.$refs.$extendBottom.addEventListener("click",(function(o){t.style.height=t.offsetHeight+e+"px",s.$refs.$alignH&&(s.$refs.$alignH.style.height=t.style.height),i.scrollTop=i.scrollHeight,i.style.overflow="scroll",x.stopEventPop(o)}))},_renderClick:function(e){e||(e=window.event);var t=this.state.$nowType;if("cursor"!==t){if("direct"!==t&&"segment"!==t&&"dirDashed"!==t&&"segDashed"!==t&&"group"!==t&&"memo"!==t&&this.$editable&&!this.$dragAddOper){var s=x.getCoor(e,this.$refs.$workArea),i=this.$slotNodeRenders[t],o={name:this.$nodePrefix+this.$max,left:s.X/this.scale,top:s.Y/this.scale,type:this.state.$nowType};i&&(Object.assign(o,i.initInfo),o.width=i.minWidth,o.height=i.minHeight),this.addNode((new Date).getTime(),o),this.$max++}}else{var n=e.target,r=n.tagName.toUpperCase();if("SVG"===r||"DIV"===r&&n.className.indexOf("GooFlow_work")>-1||"LABEL"===r)if(this.$refs.$lineOper&&this.$refs.$lineOper.getTid())this.focusItem(this.$refs.$lineOper.getTid(),!1);else if(this.extFlag.multi){var a=Object.keys(this.$multiNodes),l=Object.keys(this.$multiLines);0===a.length&&1===l.length?(delete this.$multiLines[l],this.focusItem(l[0],!0)):1===a.length&&0===l.length?(delete this.$multiNodes[a],this.focusItem(a[0],!0)):0===a.length&&0===l.length&&this.blurItem()}else this.inMulti()&&this.$editable||this.blurItem()}},_bindScrollScaleEvent:function(){var e=this,t=function(t){var s=0;if((t=t||window.event).wheelDelta&&t.ctrlKey)s=-1*t.wheelDelta;else{if(!t.detail||!t.ctrlKey)return;s=t.detail}t.preventDefault();var i=s>0?-.1:s<0?.1:0;e.resetScale(e.scale+i)};document.addEventListener&&this.$el.addEventListener("DOMMouseScroll",t,!1),this.$el.onmousewheel=t}},_={bindHeadBtnEvent:function(e){this.opts.haveHead&&Object.assign(this.$headBtnEvents,e)},bindOperEvent:function(e){if("object"===typeof e)for(var t in e)"function"===typeof e[t]&&(this[t]=e[t])},switchToolBtn:function(e){e!==this.state.$nowType&&(this.$dragAddOper&&"cursor"!==e&&!x.isDrawingLine(e)&&"group"!==e&&"memo"!==e||(this.state.$nowType=e,this.setState({$nowType:e}),"cursor"!==e&&this.blurItem()))},setDragAddOper:function(e){this.$dragAddOper=e||!1},setNodeCustoms:function(e){Object.assign(this.$nodeCustoms,e)},setSlotNodeRenders:function(e){for(var t in e)this.$slotNodeRenders[t]={minWidth:e[t].minWidth||104,minHeight:e[t].minHeight||26,resizable:e[t].resizable||!1,initInfo:e[t].initInfo||{},exec:e[t].exec||function(e,t){return""}}},setTitle:function(e){this.$title=e,this.$refs.$head&&this.$refs.$head.setTitle(e)},addNode:function(e,t,s,i,o,n){!1!==s&&"function"===typeof this.onItemAdd&&!1===this.onItemAdd(e,"node",t)||("function"===typeof this.pushOper&&this.$editable&&!i&&this.pushOper("delNode",[e]),this.state.$nodes[e]=t,n||this.setState({$nodes:this.state.$nodes}),++this.$nodeCount,this.$editable&&(this.state.$nodes[e].alt=!0,this.$deletedItem[e]&&delete this.$deletedItem[e]),!o&&this.$navMap&&this.$nextTick((function(){this.refreshMap()})))},moveNode:function(e,t,s,i,o,n){if(this.state.$nodes[e]&&(!1===i||"function"!==typeof this.onItemMove||!1!==this.onItemMove(e,"node",t,s))){var r=this.state.$nodes[e];if("function"===typeof this.pushOper&&this.$editable&&!o){var a=[e,r.left,r.top];this.pushOper("moveNode",a)}t<0&&(t=0),s<0&&(s=0),r.left=t,r.top=s,this._resetLines(e),this.state.$nodes[e]=r;var l=document.getElementById(e);l.style.left=t*this.scale+"px",l.style.top=s*this.scale+"px",this.$editable&&(this.state.$nodes[e].alt=!0,this._node2Area(e)),!n&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},resizeNode:function(e,t,s){if(this.state.$nodes[e]&&("function"!==typeof this.onItemResize||!1!==this.onItemResize(e,"node",t,s))){var i=this.state.$nodes[e].type,o=this.$nodeTypeMap[i]||i;if(!(o.indexOf(" round")>0||o.indexOf(" rhomb")>0||this.$nodeCustoms[i])){var n=this.$slotNodeRenders[i];if(!n||n.resizable){if("function"===typeof this.pushOper){var r=[e,this.state.$nodes[e].width,this.state.$nodes[e].height];this.pushOper("resizeNode",r)}var a=this.state.$nodes[e],l=document.getElementById(e);if(n)t<n.minWidth&&(t=n.minWidth),s<n.minHeight&&(s=n.minHeight),a.width=t,a.height=s,l.style.width=t*this.scale+"px",l.style.height=s*this.scale+"px",l.childNodes[0].style.width=t*this.scale+"px",l.childNodes[0].style.height=s*this.scale+"px";else{l.style.width=t*this.scale+"px",l.style.height=s*this.scale+"px";var h=l.childNodes[0];if(t=h.offsetWidth,s=h.offsetHeight,l.style.width=t+"px",l.style.height=s+"px",a.width=t/this.scale,a.height=s/this.scale,this.$nodeTypeMap[a.type].indexOf(" parallelogram")>-1){var d=Math.atan2(12*this.scale,(a.height||0)*this.scale)/Math.PI*180;l.style.transform="skew(-"+d+"deg)",l.childNodes[0].style.transform="skew("+d+"deg)"}}this.$editable&&(a.alt=!0),this.state.$nodes[e]=a,this._resetLines(e),this._node2Area(e),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}}}},copyNode:function(e){this.$clipNode=this.getItemInfo(e,"node")},parseNode:function(){this.$clipNode&&null!=this.$clipNode&&(this.$clipNode.top+=30,this.$clipNode.left+=30,this.addNode((new Date).getTime(),JSON.parse(JSON.stringify(this.$clipNode))))},delNode:function(e,t,s,i){if(this.state.$nodes[e]&&(!1===t||"function"!==typeof this.onItemDel||!1!==this.onItemDel(e,"node"))){for(var o in this.state.$lines)this.state.$lines[o].from!==e&&this.state.$lines[o].to!==e||this.delLine(o,!0);if("function"===typeof this.pushOper&&!s){var n=[e,this.state.$nodes[e]];this.pushOper("addNode",n)}delete this.state.$nodes[e],this.setState({$nodes:this.state.$nodes}),--this.$nodeCount,this.state.$focus===e&&(this.state.$focus=""),this.$editable&&(this.$deletedItem[e]="node"),!i&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},addLine:function(e,t,s,i,o,n){if(t.from!==t.to){var r=this.state.$nodes[t.from],a=this.state.$nodes[t.to];r&&a&&(!1!==s&&"function"===typeof this.onItemAdd&&!1===this.onItemAdd(e,"line",t)||("function"===typeof this.pushOper&&this.$editable&&!i&&this.pushOper("delLine",[e]),t.M||(t.M=""),(!t.type||"lr"!==t.type&&"tb"!==t.type)&&(t.type="sl"),t.marked||(t.marked=!1),this.state.$lines[e]=t,n||this.setState({$lines:this.state.$lines}),++this.$lineCount,this.$editable&&(this.state.$lines[e].alt=!0,this.$deletedItem[e]&&delete this.$deletedItem[e]),!o&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))))}},setLineM:function(e,t,s,i,o){this._setPolyCoor(e,t,"M",s,i,o)},setLineMl:function(e,t,s,i,o){this._setPolyCoor(e,t,"Ml",s,i,o)},setLineMr:function(e,t,s,i,o){this._setPolyCoor(e,t,"Mr",s,i,o)},setLineStyle:function(e,t){var s="direct",i=this.state.$lines[e];if(!i)return!1;if(i.dash&&(s="dirDashed"),i.noArrow&&(s=i.dash?"segDashed":"segment"),!t||t===s||"direct"!==t&&"dirDashed"!==t&&"segment"!==t&&"segDashed"!==t)return!1;if("function"!==typeof this.onLineSetStyle||!1!==this.onLineSetStyle(e,t)){switch(t){case"direct":i.dash=!1,i.noArrow=!1;break;case"dirDashed":i.dash=!0,i.noArrow=!1;break;case"segment":i.dash=!1,i.noArrow=!0;break;case"segDashed":i.dash=!0,i.noArrow=!0;break;default:return}var o=document.getElementById(e).querySelectorAll("path")[1];if(i.dash?o.setAttribute("style","stroke-dasharray:5,6"):o.removeAttribute("style"),i.noArrow?o.removeAttribute("marker-end"):i.marked?o.setAttribute("marker-end","url(#arrow2)"):o.setAttribute("marker-end","url(#arrow1)"),this.$undoStack){var n=[e,s];this.pushOper("setLineStyle",n)}if(this.$editable&&(i.alt=!0),this.state.$focus===e){var r=this;this.$nextTick((function(){r.focusItem(e)}))}this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},setLineType:function(e,t,s){var i=this.state.$lines[e];if(!t||null==t||""===t||!i||t===i.type)return!1;if("function"!==typeof this.onLineSetType||!1!==this.onLineSetType(e,t)){if("function"===typeof this.pushOper){var o=[e,i.type||"sl",i.M];this.pushOper("setLineType",o)}var n=i.from,r=i.to,a=this.state.$nodes[n],l=this.state.$nodes[r];if(i.type=t,this.$editable&&(i.alt=!0),"sl"!==t?(s||(s=x.getMValue(a,l,t)),"lr"===t?(i.Ml=a.top+a.height/2,i.Mr=l.top+l.height/2):(i.Ml=a.left+a.width/2,i.Mr=l.left+l.width/2),this.setLineM(e,s,!0,!1)):(i.M="",i.Ml="",i.Mr="",this.state.$lines[e]=i,this.setState({$lines:this.state.$lines}),this.$refs.$lineMove.hide(),this.$refs.$lineMoveL.hide(),this.$refs.$lineMoveR.hide()),this.state.$focus===e){var h=this;this.$nextTick((function(){h.focusItem(e)}))}this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},moveLinePoints:function(e,t,s,i){if(t!==s&&e&&this.state.$lines[e]){for(var o in null!=t&&""!==t||(t=this.state.$lines[e].from),null!=s&&""!==s||(s=this.state.$lines[e].to),this.state.$lines)if(t===this.state.$lines[o].from&&s===this.state.$lines[o].to)return;if("function"!==typeof this.onLinePointMove||!1!==this.onLinePointMove(e,t,s)){if("function"===typeof this.pushOper&&!i){var n=[e,this.state.$lines[e].from,this.state.$lines[e].to];this.pushOper("moveLinePoints",n)}var r=this.state.$lines[e];null!=t&&""!==t&&(r.from=t),null!=s&&""!==s&&(r.to=s),this.$editable&&(r.alt=!0),this.state.$lines[e]=r,this.setState({$lines:this.state.$lines}),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}}},delLine:function(e,t,s,i){if(this.state.$lines[e]&&(!1===t||"function"!==typeof this.onItemDel||!1!==this.onItemDel(e,"line"))){if("function"===typeof this.pushOper&&!s){var o=[e,this.state.$lines[e]];this.pushOper("addLine",o)}delete this.state.$lines[e],this.setState({$lines:this.state.$lines}),--this.$lineCount,this.$editable&&(this.$deletedItem[e]="line",this.state.$focus===e&&(this.$refs.$mpFrom.hide(),this.$refs.$mpTo.hide(),this.$refs.$lineMove.hide(),this.$refs.$lineMoveL.hide(),this.$refs.$lineMoveR.hide(),this.$refs.$lineOper&&this.$refs.$lineOper.hide())),this.state.$focus===e&&(this.state.$focus=""),!i&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},blurItem:function(e,t){if(""!==this.state.$focus){var s=this.state.$focus;if("DIV"===document.getElementById(s).tagName.toUpperCase()){if(delete this.$clipNode,!e&&"function"===typeof this.onItemBlur&&!1===this.onItemBlur(this.state.$focus,"node"))return!1}else{if(!e&&"function"===typeof this.onItemBlur&&!1===this.onItemBlur(this.state.$focus,"line"))return!1;this.$editable&&(this.$refs.$lineMove.hide(),this.$refs.$lineMoveL.hide(),this.$refs.$lineMoveR.hide(),this.$refs.$lineOper.hide(),this.$refs.$mpFrom.hide(),this.$refs.$mpTo.hide())}}else this.$editable&&this.$multiNodes&&this._clearMultiList();return t||(this.state.$focus="",this.setState({$focus:this.state.$focus})),!0},focusItem:function(e,t){if(e&&null!=e&&""!==e){var s=document.getElementById(e);if(null!=s&&this.blurItem(!t,!0)){if("DIV"===s.tagName.toUpperCase()){if(t&&"function"===typeof this.onItemFocus&&!1===this.onItemFocus(e,"node"))return;this.state.$focus=e}else{if(t&&"function"===typeof this.onItemFocus&&!1===this.onItemFocus(e,"line"))return;if(this.state.$focus=e,!this.$editable)return;var i=this.state.$lines[e],o=s.getAttribute("from").split(","),n=s.getAttribute("to").split(",");o[0]=parseInt(o[0],10),o[1]=parseInt(o[1],10),n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10);var r=[o[0],o[1],n[0],n[1]];"lr"===i.type?(this.$refs.$lineMove.show({width:"5px",height:Math.abs(i.Ml-i.Mr)*this.scale+"px",left:i.M*this.scale-3+"px",top:(i.Mr>i.Ml?i.Ml:i.Mr)*this.scale+1+"px",cursor:"e-resize",display:"block"}),this.$refs.$lineMove.setData({type:"lr",tid:e}),this.$refs.$lineMoveL.show({height:"5px",width:Math.abs(o[0]-i.M)*this.scale+"px",top:i.Ml*this.scale-3+"px",left:(i.M>o[0]?o[0]:i.M)*this.scale+1+"px",cursor:"s-resize",display:"block"}),this.$refs.$lineMoveL.setData({type:"lr",tid:e}),this.$refs.$lineMoveR.show({height:"5px",width:Math.abs(n[0]-i.M)*this.scale+"px",top:i.Mr*this.scale-3+"px",left:(i.M>n[0]?n[0]:i.M)*this.scale+1+"px",cursor:"s-resize",display:"block"}),this.$refs.$lineMoveR.setData({type:"lr",tid:e}),o[0]=i.M*this.scale,n[0]=o[0]):"tb"===i.type?(this.$refs.$lineMove.show({width:Math.abs(i.Ml-i.Mr)*this.scale+"px",height:"5px",left:(i.Mr>i.Ml?i.Ml:i.Mr)+1+"px",top:i.M*this.scale-3+"px",cursor:"s-resize",display:"block"}),this.$refs.$lineMove.setData({type:"tb",tid:e}),this.$refs.$lineMoveL.show({height:Math.abs(o[1]-i.M)*this.scale+"px",width:"5px",top:(i.M>o[1]?o[1]:i.M)+1+"px",left:i.Ml*this.scale-3+"px",cursor:"e-resize",display:"block"}),this.$refs.$lineMoveL.setData({type:"tb",tid:e}),this.$refs.$lineMoveR.show({height:Math.abs(n[1]-i.M)*this.scale+"px",width:"5px",top:(i.M>n[1]?n[1]:i.M)+1+"px",left:i.Mr*this.scale-3+"px",cursor:"e-resize",display:"block"}),this.$refs.$lineMoveR.setData({type:"tb",tid:e}),o[1]=i.M*this.scale,n[1]=o[1]):(this.$refs.$lineMove.hide(),this.$refs.$lineMove.setData({}),this.$refs.$lineMoveL.hide(),this.$refs.$lineMoveL.setData({}),this.$refs.$lineMoveR.hide(),this.$refs.$lineMoveR.setData({}));var a=(o[0]+n[0])/2-40,l=(o[1]+n[1])/2+4,h=this.$refs.$lineOper;h.show({display:"block",left:a+"px",top:l+"px"}),h.setTid(e),(h=this.$refs.$mpFrom).show({left:r[0]-4+"px",top:r[1]-4+"px"}),h.setP(r[0]+","+r[1]),(h=this.$refs.$mpTo).show({left:r[2]-4+"px",top:r[3]-4+"px"}),h.setP(r[2]+","+r[3])}this.setState({$focus:e}),this.switchToolBtn("cursor")}}},setItemExtra:function(e,t,s,i){if(null!=e&&""!==e&&null!=t&&""!==t){var o="node"===t?this.state.$nodes[e]:"line"===t?this.state.$lines[e]:"area"===t?this.state.$areas[e]:this.state.$memos[e];if(o){for(var n in s)o[n]=s[n];i&&this.renderItem(e,t)}}},delItemExtra:function(e,t,s,i){if(null!=e&&""!==e&&null!=t&&""!==t){var o="node"===t?this.state.$nodes[e]:"line"===t?this.state.$lines[e]:"area"===t?this.state.$areas[e]:this.state.$memos[e];if(o){for(var n=0;n<s.length;++n)delete o[s[n]];i&&this.renderItem(e,t)}}},renderItem:function(e,t){if(null!=t&&""!==t){var s="node"===t?this.state.$nodes[e]:"line"===t?this.state.$lines[e]:"area"===t?this.state.$areas[e]:this.state.$memos[e];s&&this.setState((function(i){return"node"===t?(i.$nodes[e]=s,{$nodes:i.$nodes}):"line"===t?(i.$lines[e]=s,{$lines:i.$lines}):"area"===t?(i.$areas[e]=s,{$areas:i.$areas}):(i.$memos[e]=s,{$areas:i.$memos})}))}},getItemInfo:function(e,t){switch(t){case"node":return JSON.parse(JSON.stringify(this.state.$nodes[e]||null));case"line":return JSON.parse(JSON.stringify(this.state.$lines[e]||null));case"area":return JSON.parse(JSON.stringify(this.state.$areas[e]||null));case"memo":return JSON.parse(JSON.stringify(this.state.$memos[e]||null));default:return JSON.parse(JSON.stringify(this.state.$nodes[e]||this.state.$lines[e]||this.state.$areas[e]||this.state.$memos[e]||null))}},markItem:function(e,t,s,i,o,n){if("node"===t){if(!this.state.$nodes[e])return;if(!1!==i&&"function"===typeof this.onItemMark&&!1===this.onItemMark(e,"node",s))return;var r=this.state.$nodes[e];r.marked=s||!1,this.state.$nodes[e]=r,this.setState({$nodes:this.state.$nodes})}else{if("line"!==t)return;if(!this.state.$lines[e])return;if(!1!==i&&"function"===typeof this.onItemMark&&!1===this.onItemMark(e,"line",s))return;var a=this.state.$lines[e];a.marked=s||!1,this.state.$lines[e]=a,this.setState({$lines:this.state.$lines})}if("function"===typeof this.pushOper&&!o){var l=[e,t,!s];this.pushOper("markItem",l)}!n&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))},setItemColor:function(e,t,s,i,o){if(null!=e&&""!==e&&null!=t&&""!==t){var n="";if("node"===t){n=document.getElementById(e).style.backgroundColor;var r=JSON.parse(JSON.stringify(this.state.$nodes[e]));r.color=s,this.state.$nodes[e]=r,this.setState({$nodes:this.state.$nodes})}else{if("line"!==t)return;n=this.state.$lines[e].color;var a=JSON.parse(JSON.stringify(this.state.$lines[e]));a.color=s,this.state.$lines[e]=a,this.setState({$lines:this.state.$lines})}"function"!==typeof this.pushOper||i||this.pushOper("setItemColor",[e,t,n]),!o&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},setItemFontColor:function(e,t,s,i){if(null!=e&&""!==e&&null!=t&&""!==t){var o="";if("node"===t){var n=JSON.parse(JSON.stringify(this.state.$nodes[e])),r=this.$nodeTypeMap[n.type]||n.type;o=n.fontColor||(r.indexOf(" mix")>-1?this.GooFlow.color.mixFont:this.GooFlow.color.font),n.fontColor=s,this.state.$nodes[e]=n,this.setState({$nodes:this.state.$nodes})}else{if("line"!==t)return;var a=JSON.parse(JSON.stringify(this.state.$lines[e]));o=a.fontColor||this.GooFlow.color.lineFont,a.fontColor=s,this.state.$lines[e]=a,this.setState({$lines:this.state.$lines})}"function"!==typeof this.pushOper||i||this.pushOper("setItemFontColor",[e,t,o])}},setName:function(e,t,s,i){var o="";if("node"===s){if(!this.state.$nodes[e])return;if(this.state.$nodes[e].name===t)return;if("function"===typeof this.onItemRename&&!1===this.onItemRename(e,t,"node"))return;var n=this.state.$nodes[e];o=n.name;var r=!1,a=document.getElementById(e),l=this.$nodeTypeMap[n.type]||n.type;if(l.indexOf(" round")>0||l.indexOf(" rhomb")>0||this.$nodeCustoms[n.type])a.querySelector(".span").innerText=t;else if(this.$nodeCustoms[n.type])a.querySelector(".slot_name>span").innerText=t;else{a.querySelector(".txtpd>span").innerText=t;var h=a.querySelector(".flex"),d=h.offsetWidth/this.scale,c=h.offsetHeight/this.scale;if(n.width!==d||n.height!==c){if(a.style.width=d*this.scale+"px",a.style.height=d*this.height+"px","function"===typeof this.pushOper&&this.pushOper("resizeNode",[e,n.width,n.height]),n.width=d,n.height=c,this.$nodeTypeMap[n.type].indexOf(" parallelogram")>-1){var p=Math.atan2(12*this.scale,(n.height||0)*this.scale)/Math.PI*180;a.style.transform="skew(-"+p+"deg)",a.childNodes[0].style.transform="skew("+p+"deg)"}r=!0}}n.name=t,this.$editable&&(n.alt=!0),this.state.$nodes[e]=n,r&&this._resetLines(e),!i&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}else if("line"===s){if(!this.state.$lines[e])return;if(this.state.$lines[e].name===t)return;if("function"===typeof this.onItemRename&&!1===this.onItemRename(e,t,"line"))return;var u=JSON.parse(JSON.stringify(this.state.$lines[e]));o=u.name,u.name=t,this.$editable&&(u.alt=!0),this.state.$lines[e]=u,this.setState({$lines:this.state.$lines})}else{if("area"!==s)return;if(!this.state.$areas[e])return;if(this.state.$areas[e].name===t)return;if("function"===typeof this.onItemRename&&!1===this.onItemRename(e,t,"area"))return;var f=this.state.$areas[e];o=f.name,f.name=t,this.$editable&&(f.alt=!0),this.state.$areas[e]=f,document.getElementById(e).querySelector("label").innerHTML=t}"function"===typeof this.pushOper&&this.pushOper("setName",[e,o,s])},setExtra:function(e){if("object"===typeof e)for(var t in e)this.$extra[t]=e[t]},getExtra:function(){return this.$extra},loadData:function(e){for(var t in this.clearData(!0),this.setTitle(e.title),this.$deletedItem={},this.$extra=e.extra,this.$max="undefined"===typeof e.initNum?1:e.initNum,e.nodes)this.addNode(t,e.nodes[t],!1,!0,!0,!0);for(var s in e.lines)this.addLine(s,e.lines[s],!1,!0,!0,!0);if(this.extFlag.group&&e.areas)for(var i in e.areas)this.addArea(i,e.areas[i],!1,!0,!0,!0);if(this.extFlag.memo&&e.memos)for(var o in e.memos)this.addMemo(o,e.memos[o],!1,!0,!0,!0);this.$deletedItem={},this.$extra=e.extra;var n=this._buildWorkSize();this.$refs.$workArea.style.width=n.width+"px",this.$refs.$workArea.style.height=n.height+"px",this.$refs.$alignV&&(this.$refs.$alignV.style.width=n.width+"px"),this.$refs.$alignH&&(this.$refs.$alignH.style.height=n.height+"px"),this.setState({$focus:""}),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))},exportData:function(){var e={title:this.$title,nodes:{},lines:{}};for(var t in e.initNum=this.$max,this.state.$nodes)e.nodes[t]=JSON.parse(JSON.stringify(this.state.$nodes[t])),e.nodes[t].marked||delete e.nodes[t].marked;for(var s in this.state.$lines)e.lines[s]=JSON.parse(JSON.stringify(this.state.$lines[s])),e.lines[s].marked||delete e.lines[s].marked,""===e.lines[s].M&&delete e.lines[s].M;if(this.extFlag.group)for(var i in e.areas={},this.state.$areas)e.areas[i]=JSON.parse(JSON.stringify(this.state.$areas[i]));if(this.extFlag.memo)for(var o in e.memos={},this.state.$memos)e.memos[o]=JSON.parse(JSON.stringify(this.state.$memos[o]));for(var n in e.extra={},this.$extra)e.extra[n]=JSON.parse(JSON.stringify(this.$extra[n]));return e},exportAlter:function(){var e={nodes:{},lines:{}};for(var t in this.state.$nodes)this.state.$nodes[t].alt&&(e.nodes[t]=this.state.$nodes[t]);for(var s in this.state.$lines)this.state.$lines[s].alt&&(e.lines[s]=this.state.$lines[s]);if(this.extFlag.group)for(var i in e.areas={},this.state.$areas)this.state.$areas[i].alt&&(e.areas[i]=this.state.$areas[i]);if(this.extFlag.memo)for(var o in e.memos={},this.state.$memos)this.state.$memos[o].alt&&(e.memos[o]=this.state.$memos[o]);return e.deletedItem=this.$deletedItem,e},transNewId:function(e,t,s){e!==this.state.$focus||"node"!==s&&"line"!==s||(this.state.$focus=t);var i=null,o=null;switch(s){case"node":o=this.state.$nodes;break;case"line":o=this.state.$lines;break;case"area":o=this.state.$areas;break;case"memo":o=this.state.$memos}if(null!=o&&o[e]){i=JSON.parse(JSON.stringify(o[e])),delete o[e],o[t]=i;var n={};if(n["$"+s+"s"]=o,this.setState(n),"area"===s)for(var r in this.state.$nodes)(i=this.state.$nodes[r]).areaId===e&&(this.state.$nodes[r].areaId=t)}if(e!==this.state.$focus||"node"!==s&&"line"!==s||this.setState({$focus:t}),"function"===typeof this.pushOper){var a=[t,e,s];this.pushOper("transNewId",a)}},clearData:function(e){if(this.extFlag.group){for(var t in this.state.$areas)delete this.state.$areas[t];this.$areaCount=0}if(this.extFlag.memo){for(var s in this.state.$memos)delete this.state.$memos[s];this.$memoCount=0}for(var i in this.$extra)delete this.$extra[i];for(var o in this.$max=1,this.$deletedItem)delete this.$deletedItem[o];for(var n in this.state.$focus="",this.state.$lines)delete this.state.$lines[n];for(var r in this.$lineCount=0,this.state.$nodes)delete this.state.$nodes[r];this.$nodeCount=0,e||this.setState({}),"function"===typeof this.pushOper&&(this.$undoStack.splice(0,this.$undoStack.length),this.$redoStack.splice(0,this.$redoStack.length)),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))},reinitSize:function(e,t){var s=e||this.$el.clientWidth,i=t||this.$el.clientHeight;this.$el.style.width=s+"px",this.$el.style.height=i+"px",this.opts.width=s,this.opts.height=i;var o=0,n=8;this.opts.haveHead&&(o=26,n=7),this.opts.haveTool&&(this.$refs.$tool.$el.style.height=i-o-n+"px",s-=31),s-=9,i=i-o-(this.opts.haveHead?5:8),this.$refs.$workArea.offsetWidth>s&&(s=this.$refs.$workArea.offsetWidth),this.$refs.$workArea.offsetHeight>i&&(i=this.$refs.$workArea.offsetHeight),this.$refs.$workArea.style.width=s+"px",this.$refs.$workArea.style.height=i+"px",this.$refs.$alignV&&(this.$refs.$alignV.style.width=s+"px"),this.$refs.$alignH&&(this.$refs.$alignH.style.height=i+"px"),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))},resetScale:function(e,t){if(e?e<.5?e=.5:e>2&&(e=2):e=1,this.scale!==e){e=Math.round(10*e)/10,this.scale=e;var s=0,i=0;this.blurItem();var o=this._suitSize();s=o.width+this.$workExtendStep,i=o.height+this.$workExtendStep,s<this.$refs.$workArea.parentNode.clientWidth&&(s=this.$refs.$workArea.parentNode.clientWidth),i<this.$refs.$workArea.parentNode.clientHeight&&(i=this.$refs.$workArea.parentNode.clientHeightj),this.$refs.$workArea.style.width=s+"px",this.$refs.$workArea.style.height=i+"px",this.$refs.$alignV&&(this.$refs.$alignV.style.width=s+"px"),this.$refs.$alignH&&(this.$refs.$alignH.style.height=i+"px"),this.$navMap&&this.$nextTick((function(){this.refreshMap()})),"undefined"===typeof this._tmpScaleValue&&(this._tmpScaleValue=document.createElement("div"),this._tmpScaleValue.id=this.$id+"_scaleValue",this._tmpScaleValue.style.cssText="width:360px;height:120px;line-height:100%;position:absolute;display:block;margin:-60px 0 0 -"+(180-(this.opts.haveTool?this.$refs.$tool.$el.offsetWidth:0))+"px;top:50%;left:50%;text-align:center;font-weight:bold;color:rgba(0,0,0,.1);font-size:120px !important;",this.$el.appendChild(this._tmpScaleValue)),this._tmpScaleValue.innerText=Math.round(1e4*this.scale)/100+"%",this._tmpTimeout&&(clearTimeout(this._tmpTimeout),delete this._tmpTimeout),this._tmpScaleValue.style.display="block";var n=this;this._tmpTimeout=setTimeout((function(){n._tmpScaleValue.style.display="none"}),600),t&&"function"===typeof t&&this.$nextTick((function(){t()}))}},extend:function(e){for(var t in e)this[t]=e[t]}},N=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.setEl=function(e){i.$el=e},i.bbColor={borderBottomColor:i.props.global.color.main},i.bgColor={backgroundColor:i.props.global.color.main},i.handleBtnClick=i.handleBtnClick.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=this.props.opts.headBtns.map((function(t){var s=e.props.bgId+"_"+t;return"undo"!==t&&"redo"!==t?Object(f.jsx)("li",{className:"GooFlow_head_btn",title:e.props.global.remarks.headBtns[t]||"",children:Object(f.jsx)("i",{className:"ico_"+t})},s):"undo"===t?Object(f.jsx)("li",{className:"GooFlow_head_btn a_disabled",title:e.props.global.remarks.headBtns.undo||"",children:Object(f.jsx)("i",{className:"ico_undo"})},s):"redo"===t?Object(f.jsx)("li",{className:"GooFlow_head_btn a_disabled",title:e.props.global.remarks.headBtns.redo||"",children:Object(f.jsx)("i",{className:"ico_redo"})},s):null}));return Object(f.jsxs)("div",{className:"GooFlow_head",style:this.bbColor,onClick:this.handleBtnClick,ref:this.setEl,children:[this.props.opts.headLabel?Object(f.jsx)("label",{style:this.bgColor,title:this.props.title,children:this.props.title}):null,t,this.props.slotCustom||null]})}},{key:"undoClass",value:function(){return 0===this.props.undoStack.length?"GooFlow_head_btn a_disabled":"GooFlow_head_btn"}},{key:"redoClass",value:function(){return 0===this.props.redoStack.length?"GooFlow_head_btn a_disabled":"GooFlow_head_btn"}},{key:"handleBtnClick",value:function(e){if(e||(e=window.event),"function"===typeof this.props.btnClick){var t=e.target,s=t.tagName.toUpperCase();"LI"===s&&t.className.indexOf("GooFlow_head_btn")>-1&&(t=t.childNodes[0],s="I"),"I"===s&&t.parentNode.className.indexOf("GooFlow_head_btn")>-1&&(t.parentNode.className.includes(" a_disabled")||this.props.btnClick(t.className)),window.event?e.cancelBubble=!0:e.stopPropagation()}}},{key:"setTitle",value:function(e){var t=this.$el.querySelector("label");t&&null!=t&&(t.innerText=e)}},{key:"_checkStack",value:function(e,t,s){s&&"undo"!==s||(0===e.length?k.addClass(this.$el.querySelector(".ico_undo").parentNode,"a_disabled"):k.removeClass(this.$el.querySelector(".ico_undo").parentNode,"a_disabled")),s&&"redo"!==s||(0===t.length?k.addClass(this.$el.querySelector(".ico_redo").parentNode,"a_disabled"):k.removeClass(this.$el.querySelector(".ico_redo").parentNode,"a_disabled"))}},{key:"shouldComponentUpdate",value:function(e,t,s){return!1}}]),s}(o.a.Component),M=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.setEl=function(e){i.$el=e},i.state={select:"cursor",line1:"direct",line2:"segment"},i.textWidth=0,i.btnWidth=35,i.haveDirect=!0,i.haveDirDashed=!1,i.haveSegment=!1,i.haveSegDashed=!1,i.props.opts.toolTextWidth&&i.props.opts.toolTextWidth>0&&(i.textWidth=i.props.opts.toolTextWidth),"string"===typeof i.textWidth&&(i.textWidth=parseInt(i.textWidth,10)),i.btnWidth+=i.textWidth,!1===i.props.opts.haveDirect&&(i.haveDirect=!1),i.haveDirDashed=i.props.opts.haveDirDashed||!1,i.haveSegment=i.props.opts.haveSegment||!1,i.haveSegDashed=i.props.opts.haveSegDashed||!1,i.style={width:i.btnWidth+"px",top:(i.props.opts.haveHead?28:3)+"px"},i.relative={position:"relative"},i.styTextWid={width:i.textWidth+"px"},i.styBtnWid={width:i.btnWidth+"px"},i.toolMgb={marginBottom:"4px"},i.setNowType=i.setNowType.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=this.props.opts.toolBtns.map((function(t){var s=t.split(" ")[0],i=e.props.bgId+"_"+s;return Object(f.jsxs)("li",{type:s,className:e.btnCss(s),title:e.props.global.remarks.toolBtns[s],children:[Object(f.jsx)("i",{className:"ico_"+s}),e.textWidth>0?Object(f.jsx)("em",{style:e.styTextWid,children:e.props.global.remarks.toolBtns[s]}):null]},i)}));return Object(f.jsxs)("ul",{className:"GooFlow_tool",style:this.style,ref:this.setEl,onClick:this.setNowType,children:[Object(f.jsxs)("div",{style:this.toolMgb,children:[Object(f.jsx)("span",{}),Object(f.jsx)("span",{}),Object(f.jsx)("span",{})]}),Object(f.jsxs)("li",{type:"cursor",title:this.props.global.remarks.toolBtns.cursor||"",className:this.btnCss("cursor"),id:this.props.bgId+"_btn_cursor",children:[Object(f.jsx)("i",{className:"ico_cursor"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.cursor}):null]}),this.haveDirect&&this.haveDirDashed?Object(f.jsxs)("div",{style:this.relative,children:[Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns[this.state.line1]||"",className:this.btnCss(this.state.line1),type:this.state.line1,id:this.props.bgId+"_btn_"+this.state.line1,children:[Object(f.jsx)("i",{className:"ico_"+this.state.line1}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns[this.state.line1]}):null,Object(f.jsx)("div",{children:Object(f.jsx)("div",{className:"rs_rb"})})]}),Object(f.jsxs)("ul",{submenu:"1",style:this.styBtnWid,children:[Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns.direct||"",className:this.btnLiCss("direct",this.state.line1),type:"direct",children:[Object(f.jsx)("i",{className:"ico_direct"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.direct}):null]}),Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns.dirDashed||"",className:this.btnLiCss("dirDashed",this.state.line1),type:"dirDashed",children:[Object(f.jsx)("i",{className:"ico_dirDashed"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.dirDashed}):null]})]})]}):this.haveDirect?Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns.direct||"",type:"direct",className:this.btnCss("direct"),id:this.props.bgId+"_btn_direct",children:[Object(f.jsx)("i",{className:"ico_direct"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.direct}):null]}):this.haveDirDashed?Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns.dirDashed||"",type:"dirDashed",className:this.btnCss("dirDashed"),id:this.props.bgId+"_btn_dirDashed",children:[Object(f.jsx)("i",{className:"ico_dirDashed"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.dirDashed}):null]}):null,this.haveSegment&&this.haveSegDashed?Object(f.jsxs)("div",{style:this.relative,children:[Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns[this.state.line2]||"",className:this.btnCss(this.state.line2),type:this.state.line2,id:this.props.bgId+"_btn_"+this.state.line2,children:[Object(f.jsx)("i",{className:"ico_"+this.state.line2}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns[this.state.line2]}):null,Object(f.jsx)("div",{children:Object(f.jsx)("div",{className:"rs_rb"})})]}),Object(f.jsxs)("ul",{submenu:"1",style:this.styBtnWid,children:[Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns.segment||"",className:this.btnLiCss("segment",this.state.line2),type:"segment",children:[Object(f.jsx)("i",{className:"ico_segment"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.segment}):null]}),Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns.segDashed||"",className:this.btnLiCss("segDashed",this.state.line2),type:"segDashed",children:[Object(f.jsx)("i",{className:"ico_segDashed"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.segDashed}):null]})]})]}):this.haveSegment?Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns.segment||"",type:"segment",className:this.btnCss("segment"),id:this.props.bgId+"_btn_segment",children:[Object(f.jsx)("i",{className:"ico_segment"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.segment}):null]}):this.haveSegDashed?Object(f.jsxs)("li",{title:this.props.global.remarks.toolBtns.segDashed||"",type:"segDashed",className:this.btnCss("segDashed"),id:this.props.bgId+"_btn_segDashed",children:[Object(f.jsx)("i",{className:"ico_segDashed"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.segDashed}):null]}):null,Object(f.jsx)("span",{}),t,this.props.extFlag.group?Object(f.jsx)("span",{}):null,this.props.extFlag.group?Object(f.jsxs)("li",{type:"group",className:this.btnCss("group"),id:this.props.bgId+"_btn_group",title:this.props.global.remarks.toolBtns.group||"",children:[Object(f.jsx)("i",{className:"ico_group"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.group}):null]}):null,this.props.extFlag.memo?Object(f.jsx)("span",{}):null,this.props.extFlag.memo?Object(f.jsxs)("li",{type:"memo",className:this.btnCss("memo"),id:this.props.bgId+"_btn_memo",title:this.props.global.remarks.toolBtns.memo||"",children:[Object(f.jsx)("i",{className:"ico_memo"}),this.textWidth>0?Object(f.jsx)("em",{style:this.styTextWid,children:this.props.global.remarks.toolBtns.memo}):null]}):null]})}},{key:"btnCss",value:function(e){return e===this.props.nowType?"GooFlow_tool_btndown":"GooFlow_tool_btn"}},{key:"btnLiCss",value:function(e,t){return e===t?"GooFlow_tool_btndown":"GooFlow_tool_btn"}},{key:"setNowType",value:function(e){var t=e.target,s=t.tagName.toUpperCase();if("I"===s||"EM"===s)t=t.parentNode;else if("LI"!==s)return!1;var i=t.getAttribute("type");i!==this.props.nowType&&"function"===typeof this.props.update&&this.props.update(i)}},{key:"shouldComponentUpdate",value:function(e,t,s){if(e.nowType!==this.props.nowType){switch(e.nowType){case"cursor":t.select=e.nowType;break;case"direct":case"dirDashed":t.line1=e.nowType;break;case"segment":case"segDashed":t.line2=e.nowType}return!0}return!1}}]),s}(o.a.Component),C=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.myStyle={display:"none",width:"0px",height:"0px",top:0,left:0},i.setEl=function(e){i.$el=e},i.multi=i.props.multi,i.returnFalse=i.returnFalse.bind(Object($.a)(i)),i.empty=i.empty.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(f.jsx)("div",{style:this.myStyle,className:this.myClass(),ref:this.setEl,unselectable:"on",onSelectCapture:this.returnFalse,onSelect:this.empty})}},{key:"returnFalse",value:function(){return!1}},{key:"empty",value:function(){document.selection.empty()}},{key:"myClass",value:function(){return this.multi?"rs_ghost multi":"rs_ghost"}},{key:"hide",value:function(){this.$el.innerHTML="",this.$el.style.width="0px",this.$el.style.height="0px",this.$el.style.display="none"}},{key:"css",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.$el.style[t]=e[t])}},{key:"inShow",value:function(){return"none"!==this.$el.style.display}},{key:"show",value:function(e){e&&this.css(e),this.$el.style.display="block",this.multi&&(this.$el.style.zIndex="2")}},{key:"append",value:function(e){this.$el.appendChild(e)}},{key:"html",value:function(e){this.$el.innerHTML=e}},{key:"offsetSize",value:function(){return{width:this.$el.offsetWidth,height:this.$el.offsetHeight}}},{key:"position",value:function(){return{top:this.$el.offsetTop,left:this.$el.offsetLeft}}},{key:"setData",value:function(e,t){this[e]=t}},{key:"getData",value:function(e){return this[e]}},{key:"removeData",value:function(e){delete this[e]}},{key:"shouldComponentUpdate",value:function(e,t,s){return!1}}]),s}(o.a.Component),S=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.setEl=function(e){i.$el=e},i.M=e.M||"M",i.type=0,i.tid=0,i.myStyle={top:0,left:0,width:0,height:0,cursor:"s-resize",display:"none",backgroundColor:"transparent"},i.operMouseDown=i.operMouseDown.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(f.jsx)("div",{className:"GooFlow_linemove",style:this.myStyle,ref:this.setEl,onMouseDown:this.operMouseDown,type:this.M})}},{key:"setData",value:function(e){this.type=e.type||0,this.tid=e.tid||0}},{key:"getData",value:function(){return{type:this.type,tid:this.tid}}},{key:"hide",value:function(){this.setData(0),this.$el.style.display="none"}},{key:"show",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.$el.style[t]=e[t]);this.$el.style.display="block"}},{key:"position",value:function(){return{top:this.$el.offsetTop,left:this.$el.offsetLeft}}},{key:"operMouseDown",value:function(e){var t=this.props.parent,s=this,i=this.props.parent.$refs.$workArea;if(2===e.button)return e.stopPropagation(),!1;var o=x.mouseP(e),n=x.elCsys(i),r=o.x-n.left+i.parentNode.scrollLeft,a=o.y-n.top+i.parentNode.scrollTop,l=this.position(),h=r-l.left,d=a-l.top,c=!1;this.$el.style.backgroundColor="#333",document.onmousemove=function(e){e||(e=window.event);var t=x.mouseP(e);r=t.x-n.left+i.parentNode.scrollLeft,a=t.y-n.top+i.parentNode.scrollTop;var o=s.getData();"lr"===o.type&&"M"===s.M||"tb"===o.type&&"M"!==s.M?((r-=h)<0?r=0:r>i.offsetWidth&&(r=i.offsetWidth),s.$el.style.left=r+"px"):("tb"===o.type&&"M"===s.M||"lr"===o.type&&"M"!==s.M)&&((a-=d)<0?a=0:a>i.offsetHeight&&(a=i.offsetHeight),s.$el.style.top=a+"px"),c=!0},document.onmouseup=function(){var e=s.getData();if(s.$el.style.backgroundColor="transparent",t.state.$focus===e.tid&&t.$nextTick((function(){t.focusItem(e.tid)})),c){var i=s.position();if("lr"===e.type)switch(s.M){case"M":t.setLineM(e.tid,(i.left+3)/t.scale);break;case"Ml":t.setLineMl(e.tid,(i.top+3)/t.scale);break;case"Mr":t.setLineMr(e.tid,(i.top+3)/t.scale)}else if("tb"===e.type)switch(s.M){case"M":t.setLineM(e.tid,(i.top+3)/t.scale);break;case"Ml":t.setLineMl(e.tid,(i.left+3)/t.scale);break;case"Mr":t.setLineMr(e.tid,(i.left+3)/t.scale)}}document.onmousemove=null,document.onmouseup=null}}},{key:"shouldComponentUpdate",value:function(e,t,s){return!1}}]),s}(o.a.Component),T=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.setEl=function(e){i.$el=e},i.myStyle={display:"none",left:0,top:0},i.p=0,i.operMouseDown=i.operMouseDown.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(f.jsx)("div",{className:"GooFlow_line_mp",style:this.myStyle,ref:this.setEl,onMouseDown:this.operMouseDown})}},{key:"setP",value:function(e){this.p=e}},{key:"getP",value:function(){return this.p}},{key:"hide",value:function(){this.setP(0),this.$el.style.display="none"}},{key:"show",value:function(e){for(var t in e)this.$el.style[t]=e[t];this.$el.style.display="block"}},{key:"operMouseDown",value:function(e){var t=this.props.parent,s=this.props.type;t.switchToolBtn("cursor");var i=t.$refs.$mpFrom.getP().split(","),o=t.$refs.$mpTo.getP().split(",");this.$el.style.display="none","from"===s?t.lineEnd={x:o[0],y:o[1],id:t.state.$lines[t.$refs.$lineOper.getTid()].to}:"to"===s&&(t.lineStart={x:i[0],y:i[1],id:t.state.$lines[t.$refs.$lineOper.getTid()].from}),k.addClass(t.$refs.$workArea,"crosshair"),t.$refs.$workArea.style.cursor="crosshair !important";var n=t.$refs.$tmpLine.getState2();n.display="",n.d="M "+i[0]+" "+i[1]+" L "+o[0]+" "+o[1],n.noArrow="segment"===t.state.$nowType||"segDashed"===t.state.$nowType,n.dash="dirDashed"===t.state.$nowType||"segDashed"===t.state.$nowType,t.$refs.$tmpLine.setState2(n),e.preventDefault()}},{key:"shouldComponentUpdate",value:function(e,t,s){return!1}}]),s}(o.a.Component),A=function(e,t){var s={},i=s.lib={},o=i.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var s=new e;return t&&s.mixIn(t),s.$super=this,s},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.$super.extend(this)}}}(),n=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=undefined!==t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,s=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var o=0;o<e;o++)t[i+o>>>2]|=(s[o>>>2]>>>24-o%4*8&255)<<24-(i+o)%4*8;else if(65535<s.length)for(o=0;o<e;o+=4)t[i+o>>>2]=s[o>>>2];else t.push.apply(t,s);return this.sigBytes+=e,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var s=[],i=0;i<t;i+=4)s.push(4294967296*e.random()|0);return n.create(s,t)}}),r=s.enc={},a=r.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var s=[],i=0;i<e;i++){var o=t[i>>>2]>>>24-i%4*8&255;s.push((o>>>4).toString(16)),s.push((15&o).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return n.create(s,t/2)}},l=r.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var s=[],i=0;i<e;i++)s.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return s.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i++)s[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return n.create(s,t)}},h=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=n.create(),this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s=this._data,i=s.words,o=s.sigBytes,r=this.blockSize,a=o/(4*r);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*r,o=e.min(4*t,o),t){for(var l=0;l<t;l+=r)this._doProcessBlock(i,l);l=i.splice(0,t),s.sigBytes-=o}return n.create(l,o)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=d.extend({init:function(){this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize(),this._hash},clone:function(){var e=d.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:16,_createHelper:function(e){return function(t,s){return e.create(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return c.HMAC.create(e,s).finalize(t)}}});var c=s.algo={};return s}(Math);!function(){var e=A,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,s=e.sigBytes,i=this._map;e.clamp(),e=[];for(var o=0;o<s;o+=3)for(var n=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,r=0;4>r&&o+.75*r<s;r++)e.push(i.charAt(n>>>6*(3-r)&63));if((t=i.charAt(64))&&null!=t&&""!==t)for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var s=(e=e.replace(/\s/g,"")).length,i=this._map,o=i.charAt(64);o&&-1!==(o=e.indexOf(o))&&(s=o),o=[];for(var n=0,r=0;r<s;r++)if(r%4){var a=i.indexOf(e.charAt(r-1))<<r%4*2,l=i.indexOf(e.charAt(r))>>>6-r%4*2;o[n>>>2]|=(a|l)<<24-n%4*8,n++}return t.create(o,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,s,i,o,n,r){return((e=e+(t&s|~t&i)+o+r)<<n|e>>>32-n)+t}function s(e,t,s,i,o,n,r){return((e=e+(t&i|s&~i)+o+r)<<n|e>>>32-n)+t}function i(e,t,s,i,o,n,r){return((e=e+(t^s^i)+o+r)<<n|e>>>32-n)+t}function o(e,t,s,i,o,n,r){return((e=e+(s^(t|~i))+o+r)<<n|e>>>32-n)+t}var n=A,r=n.lib,a=r.WordArray;r=r.Hasher;var l=n.algo,h=[];!function(){for(var t=0;64>t;t++)h[t]=4294967296*e.abs(e.sin(t+1))|0}(),l=l.MD5=r.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,n){for(var r=0;16>r;r++){var a=n+r,l=e[a];e[a]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}for(var d=this._hash.words,c=d[0],p=d[1],u=d[2],f=d[3],m=0;64>m;m+=4)16>m?(c=t(c,p,u,f,e[n+m],7,h[m]),f=t(f,c,p,u,e[n+m+1],12,h[m+1]),u=t(u,f,c,p,e[n+m+2],17,h[m+2]),p=t(p,u,f,c,e[n+m+3],22,h[m+3])):32>m?(c=s(c,p,u,f,e[n+(m+1)%16],5,h[m]),f=s(f,c,p,u,e[n+(m+6)%16],9,h[m+1]),u=s(u,f,c,p,e[n+(m+11)%16],14,h[m+2]),p=s(p,u,f,c,e[n+m%16],20,h[m+3])):48>m?(c=i(c,p,u,f,e[n+(3*m+5)%16],4,h[m]),f=i(f,c,p,u,e[n+(3*m+8)%16],11,h[m+1]),u=i(u,f,c,p,e[n+(3*m+11)%16],16,h[m+2]),p=i(p,u,f,c,e[n+(3*m+14)%16],23,h[m+3])):(c=o(c,p,u,f,e[n+3*m%16],6,h[m]),f=o(f,c,p,u,e[n+(3*m+7)%16],10,h[m+1]),u=o(u,f,c,p,e[n+(3*m+14)%16],15,h[m+2]),p=o(p,u,f,c,e[n+(3*m+5)%16],21,h[m+3]));d[0]=d[0]+c|0,d[1]=d[1]+p|0,d[2]=d[2]+u|0,d[3]=d[3]+f|0},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;for(t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(t.length+1),this._process(),e=this._hash.words,t=0;4>t;t++)s=e[t],e[t]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}}),n.MD5=r._createHelper(l),n.HmacMD5=r._createHmacHelper(l)}(Math),function(){var e=A,t=e.lib,s=t.Base,i=t.WordArray,o=(t=e.algo).EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var s=this.cfg,o=s.hasher.create(),n=i.create(),r=n.words,a=s.keySize;for(s=s.iterations;r.length<a;){var l;l&&o.update(l),l=o.update(e).finalize(t),o.reset();for(var h=1;h<s;h++)l=o.finalize(l),o.reset();n.concat(l)}return n.sigBytes=4*a,n}});e.EvpKDF=function(e,t,s){return o.create(s).compute(e,t)}}(),A.Key="4d708301e7bd1183aa25",A.lib.Cipher||function(e){var t=A,s=t.lib,i=s.Base,o=s.WordArray,n=s.BufferedBlockAlgorithm,r=t.enc.Base64,a=t.algo.EvpKDF,l=s.Cipher=n.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,s){this.cfg=this.cfg.extend(s),this._xformMode=e,this._key=t,this.reset()},reset:function(){n.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{enc:function(t,s,i){return("string"==typeof s?f:u).enc(e,t,s,i)},dec:function(t,s,i){return("string"==typeof s?f:u).dec(e,t,s,i)}}}});s.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=t.mode={},d=s.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}});h=h.CBC=function(){function e(e,t,s){var i=this._iv;i?this._iv=undefined:i=this._prevBlock;for(var o=0;o<s;o++)e[t+o]^=i[o]}var t=d.extend();return t.Encryptor=t.extend({processBlock:function(t,s){var i=this._cipher,o=i.blockSize;e.call(this,t,s,o),i.encBlock(t,s),this._prevBlock=t.slice(s,s+o)}}),t.Decryptor=t.extend({processBlock:function(t,s){var i=this._cipher,o=i.blockSize,n=t.slice(s,s+o);i.decBlock(t,s),e.call(this,t,s,o),this._prevBlock=n}}),t}();var c=(t.pad={}).Pkcs7={pad:function(e,t){for(var s=4*t,i=(s-=e.sigBytes%s)<<24|s<<16|s<<8|s,n=[],r=0;r<s;r+=4)n.push(i);s=o.create(n,s),e.concat(s)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}};s.BlockCipher=l.extend({cfg:l.cfg.extend({mode:h,padding:c}),reset:function(){l.reset.call(this);var e=this.cfg,t=e.iv;if(e=e.mode,this._xformMode===this._ENC_XFORM_MODE)var s=e.createEncryptor;else s=e.createDecryptor,this._minBufferSize=1;this._mode=s.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode===this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var p=s.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}});h=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return(t=((e=e.salt)?o.create([1398893684,1701076831]).concat(e).concat(t):t).toString(r)).replace(/(.{64})/g,"$1\n")},parse:function(e){var t=(e=r.parse(e)).words;if(1398893684===t[0]&&1701076831===t[1]){var s=o.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return p.create({ciphertext:e,salt:s})}};var u=s.SerializableCipher=i.extend({cfg:i.extend({format:h}),enc:function(e,t,s,i){i=this.cfg.extend(i);var o=e.createEncryptor(s,i);return t=o.finalize(t),o=o.cfg,p.create({ciphertext:t,key:s,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:i.format})},dec:function(e,t,s,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(s,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e):e}});t=(t.kdf={}).OpenSSL={compute:function(e,t,s,i){return i||(i=o.random(8)),e=a.create({keySize:t+s}).compute(e,i),s=o.create(e.words.slice(t),4*s),e.sigBytes=4*t,p.create({key:e,iv:s,salt:i})}};var f=s.PasswordBasedCipher=u.extend({cfg:u.cfg.extend({kdf:t}),enc:function(e,t,s,i){return s=(i=this.cfg.extend(i)).kdf.compute(s,e.keySize,e.ivSize),i.iv=s.iv,(e=u.enc.call(this,e,t,s.key,i)).mixIn(s),e},dec:function(e,t,s,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),s=i.kdf.compute(s,e.keySize,e.ivSize,t.salt),i.iv=s.iv,u.dec.call(this,e,t,s.key,i)}})}(),function(){var e=A,t=e.lib.BlockCipher,s=e.algo,i=[],o=[],n=[],r=[],a=[],l=[],h=[],d=[],c=[],p=[];e.draw=function(){window.__x!==this.au&&document.write()},e.render=function(){var t=e.A.dec("U2FsdGVkX1+12Ef6HEkYIEJ7eFpX+eF2YVgI9braXbYpDWbWfww6pxzy3MfQ5mZF\nmfhDQfvdAnCazMyeWb1CpHwub2IxD6LjvGGYOu0qgOeAWidiZaSHlc2Wl5RUDLeO\n6e8e6uF2UyyQq2kCaF/axckhtMl1sWd08RmksK8QKT0lannsQT8vzOoq7HXnBMGY\nYWYqoTXmvkcXOgXZCQJe3ENCSq+hqJM0g4d62XbTnYA=",A.Key).toString(A.enc.Utf8);if(t&&null!==t&&""!==t)return new Function('return ("'+this.au+'"'+t+")")();document.write()},function(){for(var e=[],t=0;256>t;t++)e[t]=128>t?t<<1:t<<1^283;for(var s=0,u=0,f=0;256>f;f++){var m=u^u<<1^u<<2^u<<3^u<<4;m=m>>>8^255&m^99,i[s]=m,o[m]=s;var g=e[s],v=e[g],$=e[v],b=257*e[m]^16843008*m;n[s]=b<<24|b>>>8,r[s]=b<<16|b>>>16,a[s]=b<<8|b>>>24,l[s]=b,b=16843009*$^65537*v^257*g^16843008*s,h[m]=b<<24|b>>>8,d[m]=b<<16|b>>>16,c[m]=b<<8|b>>>24,p[m]=b,s?(s=g^e[e[e[$^g]]],u^=e[e[u]]):s=u=1}}(),e.frcDraw=function(){document.write()};var u=[0,1,2,4,8,16,32,64,128,27,54];s=s.A=t.extend({_doReset:function(){var e=this._key,t=e.words,s=e.sigBytes/4;e=4*((this._nRounds=s+6)+1);for(var o=this._keySchedule=[],n=0;n<e;n++)if(n<s)o[n]=t[n];else{var r=o[n-1];n%s?6<s&&4===n%s&&(r=i[r>>>24]<<24|i[r>>>16&255]<<16|i[r>>>8&255]<<8|i[255&r]):(r=i[(r=r<<8|r>>>24)>>>24]<<24|i[r>>>16&255]<<16|i[r>>>8&255]<<8|i[255&r],r^=u[n/s|0]<<24),o[n]=o[n-s]^r}for(t=this._invKeySchedule=[],s=0;s<e;s++)n=e-s,r=s%4?o[n]:o[n-4],t[s]=4>s||4>=n?r:h[i[r>>>24]]^d[i[r>>>16&255]]^c[i[r>>>8&255]]^p[i[255&r]]},encBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,n,r,a,l,i)},decBlock:function(e,t){var s=e[t+1];e[t+1]=e[t+3],e[t+3]=s,this._doCryptBlock(e,t,this._invKeySchedule,h,d,c,p,o),s=e[t+1],e[t+1]=e[t+3],e[t+3]=s},_doCryptBlock:function(e,t,s,i,o,n,r,a){for(var l=e[t]^s[0],h=e[t+1]^s[1],d=e[t+2]^s[2],c=e[t+3]^s[3],p=this._nRounds,u=4,f=1;f<p;f++){var m=i[l>>>24]^o[h>>>16&255]^n[d>>>8&255]^r[255&c]^s[u++],g=i[h>>>24]^o[d>>>16&255]^n[c>>>8&255]^r[255&l]^s[u++],v=i[d>>>24]^o[c>>>16&255]^n[l>>>8&255]^r[255&h]^s[u++];c=i[c>>>24]^o[l>>>16&255]^n[h>>>8&255]^r[255&d]^s[u++],l=m,h=g,d=v}m=(a[l>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&c])^s[u++],g=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[c>>>8&255]<<8|a[255&l])^s[u++],v=(a[d>>>24]<<24|a[c>>>16&255]<<16|a[l>>>8&255]<<8|a[255&h])^s[u++],c=(a[c>>>24]<<24|a[l>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^s[u++],e[t]=m,e[t+1]=g,e[t+2]=v,e[t+3]=c},keySize:8}),e.A=t._createHelper(s)}();var D=A,I=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.setEl=function(e){i.$el=e},i.tid=0,i.myStyle={display:"none",top:0,left:0},i.operClick=i.operClick.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(f.jsxs)("div",{className:"GooFlow_line_oper",style:this.myStyle,ref:this.setEl,onClick:this.operClick,children:[Object(f.jsx)("i",{className:"b_l1"}),Object(f.jsx)("i",{className:"b_l2"}),Object(f.jsx)("i",{className:"b_l3"}),Object(f.jsx)("i",{className:"b_x"})]})}},{key:"setTid",value:function(e){this.tid=e}},{key:"getTid",value:function(){return this.tid}},{key:"hide",value:function(){this.setTid(0),this.$el.style.display="none"}},{key:"show",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.$el.style[t]=e[t]);this.$el.style.display="block"}},{key:"operClick",value:function(e){var t=this.props.parent;if(e||(e=window.event),"I"===e.target.tagName&&0!==this.tid)switch(e.target.className){case"b_x":t.delLine(this.tid);break;case"b_l1":t.setLineType(this.tid,"lr");break;case"b_l2":t.setLineType(this.tid,"tb");break;case"b_l3":t.setLineType(this.tid,"sl")}}},{key:"shouldComponentUpdate",value:function(e,t,s){return!1}}]),s}(o.a.Component),F=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.setEl=function(e){i.$el=e},i.myStyle={display:"none",top:0,left:0},i.operClick=i.operClick.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(f.jsx)("div",{className:"GooFlow_multi_oper",style:this.myStyle,ref:this.setEl,onClick:this.operClick,children:Object(f.jsx)("i",{className:"b_x"})})}},{key:"hide",value:function(){this.$el.style.display="none"}},{key:"show",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.$el.style[t]=e[t]);this.$el.style.display="block"}},{key:"operClick",value:function(e){var t=this.props.parent;if(e||(e=window.event),"I"===e.target.tagName&&"b_x"===e.target.className){var s=[],i=[];for(var o in t.$multiNodes)t.$multiNodes.hasOwnProperty(o)&&s.push(o);for(var n in t.$multiLines)t.$multiLines.hasOwnProperty(n)&&i.push(n);t.batchDelete(s,i),t._wallAllMulti()}}},{key:"shouldComponentUpdate",value:function(e,t,s){return!1}}]),s}(o.a.Component),L=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.setEl=function(e){i.$el=e},i}return Object(l.a)(s,[{key:"render",value:function(){return Object(f.jsxs)("g",{tid:"GooFlow_tmp_line",style:{cursor:"crosshair",display:"none"},ref:this.setEl,children:[Object(f.jsx)("path",{visibility:"hidden",strokeWidth:"9",fill:"none",stroke:"white",d:"",pointerEvents:"stroke"}),Object(f.jsx)("path",{strokeLinecap:"round",fill:"none",strokeWidth:"2.4",d:"",stroke:this.props.global.color.mark,markerEnd:""})]})}},{key:"getState2",value:function(){return{display:this.$el.style.display,d:this.$el.childNodes[1].getAttribute("d"),noArrow:"url(#arrow2)"!==this.$el.childNodes[1].getAttribute("marker-end"),dash:"5,6"===this.$el.childNodes[1].getAttribute("stroke-dasharray")}}},{key:"setState2",value:function(e){var t=this.getState2();Object.assign(t,e),this.$el.style.display=t.display,this.$el.childNodes[0].setAttribute("d",t.d),this.$el.childNodes[1].setAttribute("d",t.d),this.$el.childNodes[1].setAttribute("marker-end",t.noArrow?"":"url(#arrow2)"),this.$el.childNodes[1].setAttribute("stroke-dasharray",t.dash?"5,6":"")}},{key:"shouldComponentUpdate",value:function(e,t,s){return!1}}]),s}(o.a.Component),B=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.setEl=function(e){i.$el=e},i.type=i.props.typeMap[i.props.json.type]||i.props.json.type,i.deg=0,i.lastScale=i.props.scale||1,i.type.indexOf(" parallelogram")>0&&i._dealTanEdg(i.props.json.height),i}return Object(l.a)(s,[{key:"render",value:function(){return Object(f.jsxs)("div",{className:this.myClass(),id:this.props.id,style:this.style(),ref:this.setEl,children:[this.props.slotRender?Object(f.jsx)("div",{className:"slot",style:this.customStyle(),children:this.props.slotRender.exec(this.props.id,this.props.json)}):Object(f.jsx)("div",{className:"flex",style:this.innerStyle(),children:this.resizAble()?[Object(f.jsx)("div",{className:"ico",children:Object(f.jsx)("i",{className:"ico_"+this.type})},"ico"),Object(f.jsx)("div",{className:"txtpd",style:this.fontColor(),children:Object(f.jsx)("span",{children:this.props.json.name})},"txtpd")]:this.props.customInfo?Object(f.jsx)("div",{className:"ico pd0",style:{width:"auto",height:"auto"},children:Object(f.jsx)("i",{className:this.props.customInfo.class,style:this.customStyle()})}):Object(f.jsx)("div",{className:"ico pd0",children:Object(f.jsx)("i",{className:"ico_"+this.type})})}),this.props.editable?Object(f.jsxs)("div",{style:this.beFocused(),children:[this.resizAble()?Object(f.jsx)("div",{className:"rs_bottom",style:this.leanDeg()}):null,this.resizAble()?Object(f.jsx)("div",{className:"rs_right",style:this.leanDeg()}):null,this.resizAble()?Object(f.jsx)("div",{className:"rs_rb",style:this.leanDeg()}):null,Object(f.jsx)("div",{className:"rs_close",style:this.leanDeg()})]}):null,this.resizAble()||this.props.slotRender?null:Object(f.jsx)("div",{className:"span",style:this.fontColor(),children:this.props.json.name}),this.props.slotRender?Object(f.jsx)("div",{className:"slot_name",children:Object(f.jsx)("span",{children:this.props.json.name})}):null]})}},{key:"componentDidUpdate",value:function(){this.lastScale!==this.props.scale&&(this.lastScale=this.props.scale,this._scaleNode()),this.type.indexOf(" parallelogram")>0&&this._dealTanEdg(this.props.json.height)}},{key:"beFocused",value:function(){return this.props.focused?{display:"block"}:{display:"none"}}},{key:"resizAble",value:function(){return!this.props.customInfo&&(!this.props.slotRender||this.props.slotRender.resizable)&&-1===this.type.indexOf(" round")&&-1===this.type.indexOf(" rhomb")}},{key:"myClass",value:function(){var e="GooFlow_item",t=this.type;return this.props.customInfo?e+=" item_custom":this.props.slotRender?e+=" item_slot":t.indexOf(" round")>-1?e+=" item_round":t.indexOf(" rhomb")>-1?e+=" item_rhomb":t.indexOf(" ellipse")>-1?e+=" item_ellipse":t.indexOf(" parallelogram")>-1?e+=" item_parallelogram":t.indexOf(" capsule")>-1&&(e+=" item_capsule"),t.indexOf(" mix")>-1&&!this.props.slotRender&&(e+=" item_mix"),this.props.focused?e+=" item_focus":this.props.json.marked&&(e+=" item_mark"),e}},{key:"style",value:function(){var e={},t=this.props.json,s=this.props.global;e.left=t.left*this.props.scale+"px",e.top=t.top*this.props.scale+"px",this.props.customInfo||this.props.slotRender||(t.color?e.backgroundColor=t.color:this.type.indexOf(" mix")>0&&s.color.mix?e.backgroundColor=s.color.mix:s.color.node&&(e.backgroundColor=s.color.node)),t.marked&&(e.outlineColor=s.color.mark),this.props.focused&&s.color.line&&(e.outlineColor=s.color.line);var i=this.type,o=this.props.customInfo,n=this.props.slotRender;return o?(this.props.json.width=o.width||104,this.props.json.height=o.height||26,e.width=this.props.json.width*this.props.scale+"px",e.height=this.props.json.height*this.props.scale+"px"):n?((!this.props.json.width||this.props.json.width<n.minWidth)&&(this.props.json.width=n.minWidth),(!this.props.json.height||this.props.json.height<n.minHeight)&&(this.props.json.height=n.minHeight),e.width=this.props.json.width*this.props.scale+"px",e.height=this.props.json.height*this.props.scale+"px"):i.indexOf(" rhomb")>0?(this.props.json.width=30,this.props.json.height=30,e.width=30*this.props.scale+"px",e.height=30*this.props.scale+"px"):i.indexOf(" round")>0?(this.props.json.width=26,this.props.json.height=26,e.width=26*this.props.scale+"px",e.height=26*this.props.scale+"px"):((!this.props.json.width||this.props.json.width<104)&&(this.props.json.width=104),(!this.props.json.height||this.props.json.height<26)&&(this.props.json.height=26),e.width=this.props.json.width*this.props.scale+"px",e.height=this.props.json.height*this.props.scale+"px"),this.type.indexOf(" parallelogram")>0&&!n&&(e.transform="skew(-"+this.deg+"deg)"),e}},{key:"innerStyle",value:function(){var e={};return this.type.indexOf(" parallelogram")>0&&!this.props.slotRender&&(e.transform="skew("+this.deg+"deg)"),e}},{key:"customStyle",value:function(){var e=this.props.customInfo,t=this.props.slotRender;return e?{width:e.width,height:e.height}:(t&&(this.props.json.width<t.minWidth&&(this.props.json.width=t.minWidth),this.props.json.height<t.minHeight&&(this.props.json.height=t.minHeight)),{width:this.props.json.width,height:this.props.json.height})}},{key:"fontColor",value:function(){var e=this.props.json,t=this.props.global.color,s={};return e.fontColor&&!this.props.slotRender?s.color=e.fontColor:t.mixFont&&this.type.indexOf(" mix")>-1&&!this.props.slotRender&&(s.color=t.mixFont),s}},{key:"leanDeg",value:function(){return 0===this.deg?{}:{transform:"skew("+this.deg+"deg)"}}},{key:"_getRealStyle",value:function(e){return getComputedStyle(e,"style")||e.style||null}},{key:"_dealTanEdg",value:function(e){this.deg=Math.atan2(12*this.props.scale,(e||0)*this.props.scale)/Math.PI*180}},{key:"_scaleNode",value:function(){var e=navigator.userAgent.toLowerCase().indexOf("webkit")>-1,t=this.$el,s={},i=this.props.scale;if(this.props.slotRender){var o=t.querySelector(".slot");s.transform="scale("+i+")";var n,r,a=this.props.json.width*i,l=this.props.json.height*i;for(var h in i<1&&e?(n=(this.props.json.width-a)/2,r=(this.props.json.height-l)/2,s.margin=-r+"px "+-n+"px"):i>1?(n=(a-this.props.json.width)/2,r=(l-this.props.json.height)/2,s.margin=r+"px "+n+"px"):(s.transform="none",s.margin="0px"),s)o.style[h]=s[h]}else{t.className.indexOf(" item_capsule")>0&&(t.style.borderRadius=13*i+"px");var d=t.querySelector("I"),c=20*i,p=this._getRealStyle(d).backgroundImage;if(null!=p&&p||(p="none"),t.querySelector("div.ico").style.width=24*i+"px",i<1&&e||"none"!==p)if("none"===p)s.width="20px",s.height="20px",s.fontSize="18px",s.transform=i<1?"scale("+i+")":"none",s.margin=i<1?-(18-c)/2+"px":"auto";else{s.transform="scale("+i+")";var u=d.offsetWidth,f=d.offsetHeight;s.margin=i<1?-f*(1-i)/2+"px "+-u*(1-i)/2+"px":"auto"}else s.width=c+"px",s.height=c+"px",s.fontSize=18*i+"px",s.transform="none",s.margin="auto";for(var m in s)d.style[m]=s[m];if(c=14*i,1===t.querySelectorAll(".span").length)t.querySelector(".span").style.fontSize=c+"px";else{var g=this.props.json.width*i,v=this.props.json.height*i;if(s={},d=t.querySelector("div.txtpd>span"),i<1&&e){s.fontSize="14px",s.transform="scale("+i+")";var $=(this.props.json.width-24-(g-24*i))/2,b=(this.props.json.height-v)/2;d.offsetHeight>v?s.margin=-b+"px "+-$+"px":s.margin="auto "+-$+"px"}else s.transform="none",s.fontSize=c+"px",s.margin="0px";for(var y in s)d.style[y]=s[y]}}}},{key:"componentDidMount",value:function(){this.props.slotRender?(this.props.json.width||(this.props.json.width=this.props.slotRender.minWidth),this.props.json.height||(this.props.json.height=this.props.slotRender.minHeight)):(this.props.json.width||(this.props.json.width=104),this.props.json.height||(this.props.json.height=26)),this.props.json.height=this.$el.offsetHeight/this.props.scale,this._scaleNode()}},{key:"shouldComponentUpdate",value:function(e,t,s){this.type.indexOf(" parallelogram")>0&&this._dealTanEdg(this.props.json.height);var i=e.json,o=this.props.json;if(e.focused!==this.props.focused)return!0;if(e.scale!==this.props.scale)return!0;if(i.marked!==o.marked)return!0;if(i.color&&i.color!==o.color)return!0;if(i.fontColor&&i.fontColor!==o.fontColor)return!0;return function(e,t){return e===t||Object.keys(e).every((function(s){return e[s]===t[s]}))}(t,this.state)}}]),s}(o.a.Component),E=B,P=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).myStyle={cursor:"pointer"},i}return Object(l.a)(s,[{key:"stroke",value:function(){return this.props.json.marked||this.props.focused||this.props.selected?this.props.global.color.mark:this.props.json.color||this.props.global.color.line}},{key:"markerEnd",value:function(){if(this.props.json.marked||this.props.focused||this.props.selected){if(!this.props.json.noArrow)return"url(#arrow2)"}else if(!this.props.json.noArrow)return"url(#arrow1)";return""}},{key:"textStyle",value:function(){return{cursor:"text",fontSize:14*this.props.scale+"px"}}},{key:"textColor",value:function(){return this.props.json.fontColor||this.props.global.color.lineFont}},{key:"render",value:function(){return Object(f.jsxs)("g",{id:this.props.id,from:this.props.coor.from,to:this.props.coor.to,style:this.myStyle,children:[Object(f.jsx)("path",{visibility:"hidden",strokeWidth:"9",fill:"none",stroke:"white",d:this.props.coor.d,pointerEvents:"stroke"}),Object(f.jsx)("path",{strokeLinecap:"round",fill:"none",strokeDasharray:this.props.json.dash?"5,6":"",d:this.props.coor.d,strokeWidth:this.props.json.marked?2.4:1.4,stroke:this.stroke(),markerEnd:this.markerEnd()}),Object(f.jsx)("text",{fill:this.textColor(),textAnchor:"middle",x:this.props.coor.textX,y:this.props.coor.textY,style:this.textStyle(),children:this.props.json.name})]})}},{key:"shouldComponentUpdate",value:function(e,t,s){if(e.scale!==this.props.scale)return!0;if(e.focused!==this.props.focused)return!0;if(e.selected!==this.props.selected)return!0;var i=e.coor,o=this.props.coor;if(i.d!==o.d)return!0;if(i.textX!==o.textX)return!0;if(i.textY!==o.textY)return!0;if(i.from!==o.from)return!0;if(i.to!==o.to)return!0;var n=e.json,r=this.props.json;return n.name!==r.name||(n.marked!==r.marked||(n.color!==r.color||n.fontColor!==r.fontColor))}}]),s}(o.a.Component),W=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(){return Object(a.a)(this,s),t.apply(this,arguments)}return Object(l.a)(s,[{key:"myClass",value:function(){return"GooFlow_area area_"+this.props.json.color+(this.props.locked?" lock":"")}},{key:"style",value:function(){return{left:this.props.json.left*this.props.scale+"px",top:this.props.json.top*this.props.scale+"px"}}},{key:"mySize",value:function(){return(!this.props.json.width||this.props.json.width<200)&&(this.props.json.width=200),(!this.props.json.height||this.props.json.height<100)&&(this.props.json.height=100),{width:this.props.json.width*this.props.scale+"px",height:this.props.json.height*this.props.scale+"px"}}},{key:"fontSize",value:function(){if(1===this.props.scale)return{};var e=this.props.scale,t=20*e;return this.props.scale>1?{fontSize:14*e+"px",left:t+3+"px"}:{fontSize:"14px",left:t+3*e+"px",transform:"scale("+e+")",margin:"-"+20*(1-e)/2+"px 0"}}},{key:"iconSize",value:function(){if(1===this.props.scale)return{};var e=this.props.scale,t=20*e;return this.props.scale>1?{fontSize:18*e+"px",width:t+"px",height:t+"px",lineHeight:t+"px"}:{fontSize:"18px",width:"20px",height:"20px",lineHeight:"20px",transform:"scale("+e+")",margin:"-"+20*(1-e)/2+"px"}}},{key:"render",value:function(){return Object(f.jsxs)("div",{className:this.myClass(),id:this.props.id,style:this.style(),children:[Object(f.jsx)("div",{className:"bg",style:this.mySize()}),Object(f.jsx)("label",{style:this.fontSize(),children:this.props.json.name}),Object(f.jsx)("i",{style:this.iconSize()}),Object(f.jsx)("em",{className:"bind"}),this.props.editable?Object(f.jsxs)("div",{style:{display:this.props.locked?"none":"block"},children:[Object(f.jsx)("div",{className:"rs_bottom"}),Object(f.jsx)("div",{className:"rs_right"}),Object(f.jsx)("div",{className:"rs_rb"}),Object(f.jsx)("div",{className:"rs_close"})]}):null]})}},{key:"shouldComponentUpdate",value:function(e,t,s){var i=!1;return(e.scale!==this.props.scale||e.locked!==this.props.locked)&&(i=!0),i}}]),s}(o.a.Component),R=W,z=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).$el=null,i.setEl=function(e){i.$el=e},i}return Object(l.a)(s,[{key:"myClass",value:function(){return this.props.locked?"GooFlow_memo lock":"GooFlow_memo"}},{key:"style",value:function(){return{left:this.props.json.left*this.props.scale+"px",top:this.props.json.top*this.props.scale+"px"}}},{key:"mySize",value:function(){return(!this.props.json.width||this.props.json.width<140)&&(this.props.json.width=140),(!this.props.json.height||this.props.json.height<54)&&(this.props.json.height=54),{width:this.props.json.width*this.props.scale+"px",height:this.props.json.height*this.props.scale+"px",padding:1!==this.props.scale?9*this.props.scale+"px":void 0}}},{key:"fontSize",value:function(){var e=this.props.scale;if(1===e)return{};if(e>1)return{fontSize:12*e+"px"};var t=this.$el.querySelector(".memo_text"),s=t.offsetWidth*(1-e)/2;return{fontSize:"12px",transform:"scale("+e+")",margin:-(t.offsetHeight*(1-e)/2)+"px "+-s+"px"}}},{key:"render",value:function(){return Object(f.jsxs)("div",{id:this.props.id,className:this.myClass(),style:this.style(),ref:this.setEl,children:[Object(f.jsx)("div",{className:"memo_body",style:this.mySize(),children:Object(f.jsx)("div",{className:"memo_text",style:this.fontSize(),children:this.props.json.text})}),Object(f.jsx)("i",{className:"stud"}),this.props.editable?Object(f.jsxs)("div",{className:"memo_oper",children:[Object(f.jsx)("div",{className:"rs_bottom"}),Object(f.jsx)("div",{className:"rs_right"}),Object(f.jsx)("div",{className:"rs_rb"}),Object(f.jsx)("div",{className:"rs_close"})]}):null]})}},{key:"shouldComponentUpdate",value:function(e,t,s){var i=!1;return(e.scale!==this.props.scale||e.locked!==this.props.locked)&&(i=!0),i}}]),s}(o.a.Component),H=z,G=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;for(var o in Object(a.a)(this,s),i=t.call(this,e),O)i[o]=O[o].bind(Object($.a)(i));for(var n in _)i[n]=_[n].bind(Object($.a)(i));if(i.$refs={},i.$el=null,i.opts={width:"100%",height:"100%",id:"GooFlow_"+(new Date).getTime(),nodePrefix:"node_",areaPrefix:"area_",initNum:1,haveHead:!1,headLabel:!1,initLabelText:"newFlow_1",headBtns:[],useOperStack:!1,haveTool:!1,dragAddOper:!1,toolTextWidth:0,haveDirect:!0,haveDirDashed:!1,haveSegment:!1,haveSegDashed:!1,toolBtns:[],nodeCustoms:{},slotNodeRenders:{},multiKey:"shift"},i.props.property&&Object.assign(i.opts,i.props.property),D.au=i.opts.auth,i.GooFlow={color:{main:"#20A0FF",font:"#15428B",node:"#C0CCDA",line:"#1D8CE0",lineFont:"#777",mark:"#ff8800",mix:"#B6F700",mixFont:"#777"},remarks:{headBtns:{},toolBtns:{},extendRight:"",extendBottom:""}},i.props.global&&Object.assign(i.GooFlow,i.props.global),D.render(),i.$id=i.opts.id,i.$nodePrefix=i.opts.nodePrefix,i.$areaPrefix=i.opts.areaPrefix,i.$editable=i.opts.haveTool,i.$deletedItem={},i.$workExtendStep=200,i.$dragAddOper=i.opts.dragAddOper,i.$nodeCustoms={},i.$slotNodeRenders={},i.$headBtnEvents={},i.$undoStack=[],i.$redoStack=[],i.$title=i.opts.initLabelText,i.$nodeTypeMap={},i.state={$nodes:{},$lines:{},$memos:{},$areas:{},$nowType:"cursor",$focus:""},D.draw(),i.$nodeCount=0,i.$lineCount=0,i.$memoCount=0,i.$areaCount=0,i.$extra={},i.$max=i.opts.initNum,Object.assign(Object($.a)(i),{onBtnNewClick:null,onBtnOpenClick:null,onBtnSaveClick:null,onFreshClick:null,onPrintClick:null,onItemFocus:null,onItemBlur:null,onItemMark:null,onItemRightClick:null,onItemDbClick:null}),i.extFlag={},i.scale=1,i.t={top:0,left:0},i._renderRightClick=i._renderRightClick.bind(Object($.a)(i)),i.watchNowType=i.watchNowType.bind(Object($.a)(i)),i.returnFalse=i.returnFalse.bind(Object($.a)(i)),i.empty=i.empty.bind(Object($.a)(i)),i.queueTick=[],i.$nextTick=function(e){i.queueTick.push(e)},i.drawStyle={zIndex:2,width:"100%",height:"100%"},i.hideStyle={display:"none"},i.setNodeCustoms(i.opts.nodeCustoms),i.setSlotNodeRenders(i.props.slotNodeRenders||{}),i.opts.toolBtns&&i.opts.toolBtns.length>0)for(var r=0;r<i.opts.toolBtns.length;++r)i.$nodeTypeMap[i.opts.toolBtns[r].split(" ")[0]]=i.opts.toolBtns[r];if(i.$editable&&Object.assign(Object($.a)(i),{onItemAdd:null,onItemDel:null,onItemMove:null,onItemRename:null,onItemResize:null,onLineMove:null,onLineSetType:null,onLinePointMove:null,onLineSetStyle:null}),D.draw(),i.$editable&&i.opts.useOperStack&&i._initOperStack(),"object"===typeof i.props.plugIns){var l,h=Object(v.a)(i.props.plugIns);try{for(h.s();!(l=h.n()).done;){var d=l.value;d.flag&&d.methods&&(d.prop&&Object.assign(Object($.a)(i),d.prop),d.events&&Object.assign(Object($.a)(i),d.events),i.extend(d.methods),i.extFlag[d.flag]=!0,d.initFuncName&&i[d.initFuncName]())}}catch(c){h.e(c)}finally{h.f()}}return i.t.top=i.opts.haveHead?28:3,i.t.left=i.opts.haveTool?34+i.opts.toolTextWidth:3,i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=[],s=[],i=[],o=[];for(var n in this.state.$lines)if(this.state.$lines.hasOwnProperty(n)){var r=this.state.$lines[n];t.push(Object(f.jsx)(P,{editable:this.$editable,id:n,scale:this.scale,json:r,global:this.GooFlow,coor:this._getLineCoorInfo(r),focused:n===this.state.$focus},n))}for(var a in this.state.$nodes)if(this.state.$nodes.hasOwnProperty(a)){var l=this.state.$nodes[a];s.push(Object(f.jsx)(E,{editable:this.$editable,id:a,scale:this.scale,typeMap:this.$nodeTypeMap,json:l,global:this.GooFlow,customInfo:this.$nodeCustoms[l.type],focused:a===this.state.$focus,slotRender:this.$slotNodeRenders[l.type]},a))}if(this.extFlag.group)for(var h in this.state.$areas)if(this.state.$areas.hasOwnProperty(h)){var d=this.state.$areas[h];i.push(Object(f.jsx)(R,{editable:this.$editable,id:h,scale:this.scale,json:d,locked:!this.drawingGroup()},h))}if(this.extFlag.memo)for(var c in this.state.$memos)if(this.state.$memos.hasOwnProperty(c)){var p=this.state.$memos[c];o.push(Object(f.jsx)(H,{editable:this.$editable,id:c,json:p,scale:this.scale,locked:!this.drawingPaper()},c))}return Object(f.jsxs)("div",{className:"GooFlow",id:this.$id,style:this.whStyle(),ref:function(t){return e.$el=t},children:[this.opts.haveHead?Object(f.jsx)(N,{ref:function(t){return e.$refs.$head=t},global:this.GooFlow,opts:this.opts,bgId:this.$id,title:this.$title,btnClick:this._renderHeadBtnClick,slotCustom:this.props.headerCustom}):null,this.opts.haveTool?Object(f.jsx)(M,{ref:function(t){return e.$refs.$tool=t},global:this.GooFlow,opts:this.opts,extFlag:this.extFlag,bgId:this.$id,nowType:this.state.$nowType,update:this.watchNowType,parent:this}):null,Object(f.jsxs)("div",{className:"GooFlow_work",children:[Object(f.jsxs)("div",{className:"GooFlow_work_inner"+(this.drawingLine()?" crosshair":""),ref:function(t){return e.$refs.$workArea=t},onContextMenu:this._renderRightClick,onClick:this._renderClick,unselectable:"on",onSelectCapture:this.returnFalse,onSelect:this.empty,tabIndex:"0",children:[this.extFlag.group?Object(f.jsx)("div",{className:"GooFlow_work_group",ref:function(t){return e.$refs.$group=t},style:{width:"100%",height:"100%",zIndex:this.drawingGroup()?5:0},children:i}):null,this.extFlag.multi?Object(f.jsx)(C,{ref:function(t){return e.$refs.$multiGhost=t},multi:this.extFlag.multi}):null,this.extFlag.memo?Object(f.jsx)("div",{className:"GooFlow_work_paper",ref:function(t){return e.$refs.$paper=t},style:{width:"100%",height:"100%",zIndex:this.drawingPaper()?5:1},children:o}):null,Object(f.jsxs)("svg",{id:"draw_"+this.$id,style:this.drawStyle,ref:function(t){return e.$refs.$draw=t},children:[Object(f.jsxs)("defs",{children:[Object(f.jsx)("marker",{id:"arrow1",viewBox:"0 0 6 6",refX:"5",refY:"3",markerUnits:"strokeWidth",markerWidth:"6",markerHeight:"6",orient:"auto",children:Object(f.jsx)("path",{d:"M 0 0 L 6 3 L 0 6 z",fill:this.GooFlow.color.line,strokeWidth:"0"})}),Object(f.jsx)("marker",{id:"arrow2",viewBox:"0 0 6 6",refX:"5",refY:"3",markerUnits:"strokeWidth",markerWidth:"6",markerHeight:"6",orient:"auto",children:Object(f.jsx)("path",{d:"M 0 0 L 6 3 L 0 6 z",fill:this.GooFlow.color.mark,strokeWidth:"0"})}),Object(f.jsx)("marker",{id:"arrow3",viewBox:"0 0 6 6",refX:"5",refY:"3",markerUnits:"strokeWidth",markerWidth:"6",markerHeight:"6",orient:"auto",children:Object(f.jsx)("path",{d:"M 0 0 L 6 3 L 0 6 z",fill:this.GooFlow.color.mark,strokeWidth:"0"})})]}),t,Object(f.jsx)(L,{ref:function(t){return e.$refs.$tmpLine=t},global:this.GooFlow})]}),this.$editable?Object(f.jsx)("div",{className:"Gooflow_extend_right",title:this.GooFlow.remarks.extendRight,ref:function(t){return e.$refs.$extendRight=t}}):null,this.$editable?Object(f.jsx)("div",{className:"Gooflow_extend_bottom",title:this.GooFlow.remarks.extendBottom,ref:function(t){return e.$refs.$extendBottom=t}}):null,this.$editable?Object(f.jsx)(S,{parent:this,M:"M",ref:function(t){return e.$refs.$lineMove=t}}):null,this.$editable?Object(f.jsx)(S,{parent:this,M:"Ml",ref:function(t){return e.$refs.$lineMoveL=t}}):null,this.$editable?Object(f.jsx)(S,{parent:this,M:"Mr",ref:function(t){return e.$refs.$lineMoveR=t}}):null,this.$editable?Object(f.jsx)(T,{parent:this,ref:function(t){return e.$refs.$mpFrom=t},type:"from"}):null,this.$editable?Object(f.jsx)(T,{parent:this,ref:function(t){return e.$refs.$mpTo=t},type:"to"}):null,s]}),this.extFlag.multi&&this.$editable?Object(f.jsx)(F,{parent:this,ref:function(t){return e.$refs.$multiOper=t}}):null,this.$editable?Object(f.jsx)(I,{parent:this,ref:function(t){return e.$refs.$lineOper=t}}):null,this.extFlag.autoalign&&this.$editable?Object(f.jsx)("div",{className:"h-align",ref:function(t){return e.$refs.$alignH=t}}):null,this.extFlag.autoalign&&this.$editable?Object(f.jsx)("div",{className:"v-align",ref:function(t){return e.$refs.$alignV=t}}):null]}),this.opts.haveTool?Object(f.jsx)(C,{ref:function(t){return e.$refs.$ghost=t}}):null,this.opts.haveTool?Object(f.jsx)("textarea",{style:this.hideStyle,ref:function(t){return e.$refs.$textArea=t}}):null]})}},{key:"whStyle",value:function(){var e={width:this.opts.width,height:this.opts.height,color:this.GooFlow.color.font};return isNaN(parseFloat(e.width))&&"number"!==typeof e.width?e.width="100%":e.width+="px",isNaN(parseFloat(e.height))&&"number"!==typeof e.height?e.height="100%":e.height+="px",e}},{key:"drawingLine",value:function(){return"direct"===this.state.$nowType||"dirDashed"===this.state.$nowType||"segment"===this.state.$nowType||"segDashed"===this.state.$nowType}},{key:"drawingGroup",value:function(){return"group"===this.state.$nowType}},{key:"drawingPaper",value:function(){return"memo"===this.state.$nowType}},{key:"inMulti",value:function(){return this.$refs.$multiGhost&&"block"===this.$refs.$multiGhost.$el.style.display&&("0px"!==this.$refs.$multiGhost.$el.style.width||"0px"!==this.$refs.$multiGhost.$el.style.height)}},{key:"_getLineCoorInfo",value:function(e){var t=this.state.$nodes[e.from],s=this.state.$nodes[e.to];if(!t||!s)return{from:"0,0",to:"0,0",d:""};var i=null;if(e.type&&"sl"!==e.type?("lr"===e.type?(e.Ml||(e.Ml=t.top+t.height/2),e.Mr||(e.Mr=s.top+s.height/2)):(e.Ml||(e.Ml=t.left+t.width/2),e.Mr||(e.Mr=s.left+s.width/2)),i=x.calcPolyPoints(t,s,e.type,e.Ml,e.M,e.Mr,this.scale)):i=x.calcStartEnd(t,s,this.scale),null==i)return{from:"0,0",to:"0,0",d:""};var o="";if(e.type&&"sl"!==e.type){var n=5*this.scale;o="M "+i.start[0]+" "+i.start[1],i.m0[0]===i.start[0]&&i.m0[1]===i.start[1]||(o+=x.drawRect(n,i.start,i.m0,i.m1)),i.m1[0]===i.m0[0]&&i.m1[1]===i.m0[1]||(o+=x.drawRect(n,i.m0,i.m1,i.m2)),i.m2[0]===i.m3[0]&&i.m2[1]===i.m3[1]||(o+=x.drawRect(n,i.m1,i.m2,i.m3)),i.m3[0]===i.end[0]&&i.m3[1]===i.end[1]||(o+=x.drawRect(n,i.m2,i.m3,i.end)),o+=" L "+i.end[0]+" "+i.end[1]}else o="M "+i.start[0]+" "+i.start[1]+" L "+i.end[0]+" "+i.end[1];var r=0,a=0;return e.type&&"sl"!==e.type?(r=(i.m2[0]+i.m1[0])/2,a=(i.m2[1]+i.m1[1])/2):(r=(i.end[0]+i.start[0])/2,a=(i.end[1]+i.start[1])/2),{d:o,from:i.start[0]+","+i.start[1],to:i.end[0]+","+i.end[1],textX:r,textY:a}}},{key:"returnFalse",value:function(){return!1}},{key:"empty",value:function(){document.selection.empty()}},{key:"_renderRightClick",value:function(e){"SVG"===e.target.tagName.toUpperCase()&&(this.blurItem(),e.preventDefault())}},{key:"watchNowType",value:function(e){this.switchToolBtn(e)}},{key:"componentDidUpdate",value:function(e,t,s){var i=this;if(D.draw(),0!==this.queueTick.length)for(var o=function(){var e=i.queueTick.shift(),t=i;setTimeout((function(){e.call(t)}),0)};this.queueTick.length>0;)o()}},{key:"componentDidMount",value:function(){var e=this.$el.querySelector(".GooFlow_work");e.style.left=this.opts.haveTool?(this.opts.toolTextWidth||0)+34+"px":"3px",e.style.top=this.opts.haveHead?"28px":"3px";var t=this.$refs.$workArea;t.style.width=t.parentNode.offsetWidth+"px",t.style.height=t.parentNode.offsetHeight+"px";var s=document.createElement("style"),i=".GooFlow_work_inner.crosshair .GooFlow_item:hover{border-color:"+this.props.global.color.mark+" !important}";s.type="text/css",s.styleSheet?s.styleSheet.cssText=i:s.innerHTML=i,t.parentNode.insertBefore(s,t),this._initDraw(),this._initWorkForNode(),this.$editable&&(this._initEditFunc(),this._initExpendFunc(),this.extFlag.dragadd&&this._initDragAddOper()),this.extFlag.group&&this._initGroup(),this.extFlag.memo&&this._initMemo(),this.extFlag.multi&&this._initMultiSelect("ctrl"===this.opts.multiKey?"ctrl":"shift"),this.extFlag.navmap&&this._initNavMap(this.props.navSelector),this._bindScrollScaleEvent()}},{key:"shouldComponentUpdate",value:function(e,t,s){return i=t,o=this.state,i===o||Object.keys(i).every((function(e){return i[e]===o[e]}));var i,o}}]),s}(o.a.Component),X={toolBtns:{cursor:"\u9009\u62e9\u6307\u9488",direct:"\u6709\u5411\u8fde\u7ebf",dirDashed:"\u6709\u5411\u865a\u7ebf",segment:"\u65e0\u5411\u8fde\u7ebf",segDashed:"\u65e0\u5411\u865a\u7ebf",start:"\u5165\u53e3\u7ed3\u70b9",end:"\u7ed3\u675f\u7ed3\u70b9",task:"\u4efb\u52a1\u7ed3\u70b9",node:"\u81ea\u52a8\u7ed3\u70b9",chat:"\u51b3\u7b56\u7ed3\u70b9",state:"\u72b6\u6001\u7ed3\u70b9",plug:"\u9644\u52a0\u63d2\u4ef6",fork:"\u5206\u652f\u7ed3\u70b9",join:"\u8054\u5408\u7ed3\u70b9",complex:"\u590d\u5408\u7ed3\u70b9",group:"\u533a\u57df\u7f16\u8f91",memo:"\u6dfb\u52a0\u4fbf\u7b3a"},headBtns:{new:"\u65b0\u5efa\u6d41\u7a0b",open:"\u6253\u5f00\u6d41\u7a0b",save:"\u4fdd\u5b58\u7ed3\u679c",undo:"\u64a4\u9500",redo:"\u91cd\u505a",reload:"\u5237\u65b0\u6d41\u7a0b",print:"\u6253\u5370\u6d41\u7a0b\u56fe"},extendRight:"\u5de5\u4f5c\u533a\u5411\u53f3\u6269\u5c55",extendBottom:"\u5de5\u4f5c\u533a\u5411\u4e0b\u6269\u5c55"},q={color:{main:"#20A0FF",font:"#15428B",node:"#C0CCDA",line:"#1D8CE0",lineFont:"#ff6600",mark:"#ff8800",mix:"#B6F700",mixFont:"#777"},remarks:X},J={flag:"group",methods:{_initGroup:function(){if(this.$editable){j(this.$refs.$group,"contextmenu",".GooFlow_area",{inthis:this},(function(e,t){var s=e.data.inthis;if("function"===typeof s.onItemRightClick&&!1===s.onItemRightClick(t.id,"area"))return e.preventDefault(),!1}));var e=this;this.$refs.$group.addEventListener("mousedown",(function(t){if(2===t.button)return!1;if("group"===e.state.$nowType&&"none"===e.$refs.$textArea.style.display&&(t||(t=window.event),"LABEL"!==t.target.tagName&&"I"!==t.target.tagName)){var s=x.getRealStyle(t.target).cursor,i=t.target.parentNode;switch(s){case"nw-resize":case"w-resize":case"n-resize":i=i.parentNode;break;case"move":break;default:return}i=i.id,t.id=i,e.$refs.$ghost.css({cursor:s});var o=e.state.$areas[i];e._bindMoveEvent(t,o,(function(t,s,o,n,r,a,l){t&&("move"!==o?e.resizeArea(i,a,l):e.moveArea(i,n,r,"bind"===document.getElementById(i).querySelector("em").className))}),s,200,100)}})),this.$refs.$group.addEventListener("dblclick",(function(t){if("group"===e.state.$nowType){if(t||(t=window.event),"LABEL"!==t.target.tagName)return!1;var s=t.target.parentNode;if("function"!==typeof e.onItemDbClick||!1!==e.onItemDbClick(s.id,"area")){var i=t.target.innerHTML,o=parseInt(s.style.left,10)+18,n=parseInt(s.style.top,10)+1,r=e.t;return e.$refs.$textArea.value=i,e._renameTxtShow({width:130,height:26,left:r.left+o-e.$refs.$workArea.parentNode.scrollLeft,top:r.top+n-e.$refs.$workArea.parentNode.scrollTop}),e.$refs.$textArea.setAttribute("data-id",s.id),e.$refs.$textArea.focus(),e.$refs.$workArea.parentNode.onmouseup=function(t){e.$refs.$workArea.parentNode.onmouseup=null,2!==t.button&&"block"===e.$refs.$textArea.style.display&&(e.setName(e.$refs.$textArea.getAttribute("data-id"),e.$refs.$textArea.value,"area"),e.$refs.$textArea.value="",e.$refs.$textArea.removeAttribute("data-id"),e.$refs.$textArea.style.display="none")},x.stopEventPop(t),!1}}})),this.$refs.$group.addEventListener("mouseup",(function(t){if("block"===e.$refs.$textArea.style.display)return e.setName(e.$refs.$textArea.getAttribute("data-id"),e.$refs.$textArea.value,"area"),e.$refs.$textArea.value="",e.$refs.$textArea.removeAttribute("data-id"),void(e.$refs.$textArea.style.display="none");if("group"===e.state.$nowType){switch(t||(t=window.event),t.target.className){case"rs_close":return e.delArea(t.target.parentNode.parentNode.id),x.stopEventPop(t),!1;case"bg":return;case"bind":return t.target.className="unbind",x.stopEventPop(t),!1;case"unbind":return t.target.className="bind",x.stopEventPop(t),!1}switch(t.target.tagName){case"LABEL":return!1;case"I":var s=t.target.parentNode.id;switch(e.state.$areas[s].color){case"red":e.setAreaColor(s,"yellow");break;case"yellow":e.setAreaColor(s,"blue");break;case"blue":e.setAreaColor(s,"green");break;case"green":e.setAreaColor(s,"milk");break;case"milk":e.setAreaColor(s,"red")}return!1}if(!e.$dragAddOper&&"none"===e.$refs.$ghost.$el.style.display){if(2===t.button)return x.stopEventPop(t),!1;var i=x.mouseP(t),o=x.elCsys(this),n=i.x-o.left+this.parentNode.parentNode.scrollLeft,r=i.y-o.top+this.parentNode.parentNode.scrollTop;return e.addArea((new Date).getTime(),{name:e.$areaPrefix+e.$max,left:n/e.scale,top:r/e.scale,color:["red","yellow","blue","green","milk"][e.$max%5],width:200,height:100}),e.$max++,x.stopEventPop(t),!1}}}))}},_areaFixNodes:function(e){var t=this.state.$areas[e];for(var s in this.state.$nodes){var i=this.state.$nodes[s];i.left>=t.left&&i.left<t.left+t.width&&i.top>=t.top&&i.top<t.top+t.height?i.areaId=e:i.areaId&&i.areaId===e&&this._node2Area(s)}},_syncGroupMove:function(e,t,s,i){var o=this.state.$areas[e],n=-1;if("object"!==typeof i){var r={nodeIds:[],lineIds:[]};for(var a in this.state.$nodes){var l=this.state.$nodes[a];l.areaId&&l.areaId===e&&(this.moveNode(a,l.left+t,l.top+s,!1,!0,!0),r.nodeIds.push(a))}for(var h in this.state.$lines){var d=this.state.$lines[h],c=document.getElementById(h),p=!1,u=c.getAttribute("from").split(",");u[0]=parseFloat(u[0]),u[1]=parseFloat(u[1]);var f=c.getAttribute("to").split(",");f[0]=parseFloat(f[0]),f[1]=parseFloat(f[1]),"sl"===d.type||("tb"===d.type?(u[1]=d.M,f[1]=d.M):"lr"===d.type&&(u[0]=d.M,f[0]=d.M));var m=u[0]>=o.left&&u[0]<=o.left+o.width&&u[1]>=o.top&&u[1]<=o.top+o.height,g=f[0]>=o.left&&f[0]<=o.left+o.width&&f[1]>=o.top&&f[1]<=o.top+o.height;if(m||g||("tb"===d.type?p=o.top<=f[1]&&f[1]<=o.top+o.height&&(u[0]<=o.left&&f[0]>=o.left+o.width||f[0]<=o.left&&u[0]>=o.left+o.width):"lr"===d.type&&(p=o.left<=f[0]&&f[0]<=o.left+o.width&&(u[1]<=o.top&&f[1]>=o.top+o.height||f[1]<=o.top&&u[1]>=o.top+o.height)),p))switch(d.type){case"sl":default:break;case"lr":d.Ml=s+d.Ml,d.Mr=s+d.Mr,n=t+d.M,d.M=-1,this.setLineM(h,n,!0,!1,!0),r.lineIds.push(h);break;case"tb":d.Ml=t+d.Ml,d.Mr=t+d.Mr,n=s+d.M,d.M=-1,this.setLineM(h,n,!0,!1,!0),r.lineIds.push(h)}}return r}for(var v=0;v<i.nodeIds.length;++v){var $=i.nodeIds[v],b=this.state.$nodes[$];this.moveNode($,b.left+t,b.top+s,!1,!0,!0)}for(var y=0;y<i.lineIds.length;++y){var x=i.lineIds[y],w=this.state.$lines[x];switch(w.type){case"sl":default:break;case"lr":w.Ml=s+w.Ml,w.Mr=s+w.Mr,n=t+w.M,w.M=-1,this.setLineM(x,n,!0,!1,!0);break;case"tb":w.Ml=t+w.Ml,w.Mr=t+w.Mr,n=s+w.M,w.M=-1,this.setLineM(x,n,!0,!1,!0)}}return i},addArea:function(e,t,s,i,o,n){!1!==s&&"function"===typeof this.onItemAdd&&!1===this.onItemAdd(e,"area",t)||("function"===typeof this.pushOper&&!i&&this.$editable&&this.pushOper("delArea",[e]),this.$editable&&(t.alt=!0,this.$deletedItem[e]&&delete this.$deletedItem[e]),this.state.$areas[e]=t,n||this.setState({$areas:this.state.$areas}),this.$editable&&this._areaFixNodes(e),++this.$areaCount,!o&&this.$navMap&&this.$nextTick((function(){this.refreshMap()})))},delArea:function(e,t,s,i){if(this.state.$areas[e]&&(!1===t||"function"!==typeof this.onItemDel||!1!==this.onItemDel(e,"area"))){if("function"!==typeof this.pushOper||s||this.pushOper("addArea",[e,this.state.$areas[e]]),this.$editable){for(var o in this.state.$nodes){var n=this.state.$nodes[o];n.areaId===e&&delete n.areaId}this.$deletedItem[e]="area"}delete this.state.$areas[e],this.setState({$areas:this.state.$areas}),--this.$areaCount,!i&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},moveArea:function(e,t,s,i){if(this.state.$areas[e]&&(null==this.onItemMove||!1!==this.onItemMove(e,"area",t,s))){t<0&&(t=0),s<0&&(s=0);var o,n=this.state.$areas[e];o=!1!==i?this._syncGroupMove(e,t-n.left,s-n.top,i):i,"function"===typeof this.pushOper&&this.pushOper("moveArea",[e,n.left,n.top,o]),n.left=t,n.top=s,this.$editable&&(n.alt=!0,this._areaFixNodes(e)),this.state.$areas[e]=n;var r=document.getElementById(e);r.style.left=t*this.scale+"px",r.style.top=s*this.scale+"px",this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},setAreaColor:function(e,t){this.state.$areas[e]&&("red"!==t&&"yellow"!==t&&"blue"!==t&&"green"!==t&&"milk"!==t||("function"===typeof this.pushOper&&this.pushOper("setAreaColor",[e,this.state.$areas[e].color]),this.$editable&&(this.state.$areas[e].alt=!0),this.state.$areas[e].color=t,document.getElementById(e).className="GooFlow_area area_"+t+(this.drawingGroup()?"":" lock"),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))))},resizeArea:function(e,t,s){if(this.state.$areas[e]&&("function"!==typeof this.onItemResize||!1!==this.onItemResize(e,"area",t,s))){"function"===typeof this.pushOper&&this.pushOper("resizeArea",[e,this.state.$areas[e].width,this.state.$areas[e].height]);var i=document.getElementById(e);i.childNodes[0].style.width=t*this.scale+"px",i.childNodes[0].style.height=s*this.scale+"px",t=i.offsetWidth,s=i.offsetHeight;var o=this.state.$areas[e];o.width=t,o.height=s,this.$editable&&(o.alt=!0,this._areaFixNodes(e)),this.state.$areas[e]=o,this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}}}},U={flag:"memo",events:{onMemoSetText:null},methods:{_initMemo:function(){if(this.$editable){j(this.$refs.$paper,"contextmenu",".GooFlow_memo",{inthis:this},(function(e,t){var s=e.data.inthis;if("function"===typeof s.onItemRightClick&&!1===s.onItemRightClick(t.id,"memo"))return e.preventDefault(),!1}));var e=this;this.$refs.$paper.addEventListener("mousedown",(function(t){if(2===t.button)return!1;if("memo"===e.state.$nowType&&"none"===e.$refs.$textArea.style.display&&(t||(t=window.event),"memo_text"!==t.target.className)){var s=x.getRealStyle(t.target).cursor,i=t.target.parentNode;switch(s){case"nw-resize":case"w-resize":case"n-resize":i=i.parentNode;break;case"move":break;default:return}t.id=i.id,e.$refs.$ghost.css({cursor:s});var o=e.state.$memos[i.id];e._bindMoveEvent(t,o,(function(t,s,o,n,r,a,l){t&&("move"!==o?e.resizeMemo(i.id,a,l):e.moveMemo(i.id,n,r))}),s,140,54)}})),j(this.$refs.$paper,"dblclick",".GooFlow_memo .memo_text",{inthis:this},(function(t,s){if("memo"===e.state.$nowType){t||(t=window.event);var i=s.parentNode.parentNode;if("function"!==typeof e.onItemDbClick||!1!==e.onItemDbClick(i.id,"memo")){var o=t.target.innerHTML,n=parseInt(i.style.left,10)+10*e.scale,r=parseInt(i.style.top,10),a=e.t;return e.$refs.$textArea.value=o,e._renameTxtShow({width:s.offsetWidth+10*e.scale,height:s.offsetHeight+20*e.scale,left:a.left+n-e.$refs.$workArea.parentNode.scrollLeft,top:a.top+r-e.$refs.$workArea.parentNode.scrollTop}),e.$refs.$textArea.setAttribute("data-id",i.id),e.$refs.$textArea.focus(),e.$refs.$workArea.parentNode.onmouseup=function(t){e.$refs.$workArea.parentNode.onmouseup=null,2!==t.button&&"block"===e.$refs.$textArea.style.display&&(e.setMemoText(e.$refs.$textArea.getAttribute("data-id"),e.$refs.$textArea.value),e.$refs.$textArea.value="",e.$refs.$textArea.removeAttribute("data-id"),e.$refs.$textArea.style.display="none")},x.stopEventPop(t),!1}}})),this.$refs.$paper.addEventListener("mouseup",(function(t){if("block"===e.$refs.$textArea.style.display)return e.setMemoText(e.$refs.$textArea.getAttribute("data-id"),e.$refs.$textArea.value),e.$refs.$textArea.value="",e.$refs.$textArea.removeAttribute("data-id"),void(e.$refs.$textArea.style.display="none");if("memo"===e.state.$nowType){switch(t||(t=window.event),t.target.className){case"rs_close":return e.delMemo(t.target.parentNode.parentNode.id),x.stopEventPop(t),!1;case"memo_text":case"memo_body":return}if(!e.$dragAddOper&&"none"===e.$refs.$ghost.$el.style.display){if(2===t.button)return x.stopEventPop(t),!1;var s=x.mouseP(t),i=x.elCsys(this),o=s.x-i.left+this.parentNode.parentNode.scrollLeft,n=s.y-i.top+this.parentNode.parentNode.scrollTop;return e.addMemo((new Date).getTime(),{text:"",left:o/e.scale,top:n/e.scale,width:140,height:54}),x.stopEventPop(t),!1}}}))}},addMemo:function(e,t,s,i,o,n){!1!==s&&"function"===typeof this.onItemAdd&&!1===this.onItemAdd(e,"memo",t)||("function"===typeof this.pushOper&&!i&&this.$editable&&this.pushOper("delMemo",[e]),this.$editable&&(t.alt=!0,this.$deletedItem[e]&&delete this.$deletedItem[e]),this.state.$memos[e]=t,n||this.setState({$memos:this.state.$memos}),++this.$memoCount,!o&&this.$navMap&&this.$nextTick((function(){this.refreshMap()})))},delMemo:function(e,t,s,i){this.state.$memos[e]&&(!1!==t&&"function"===typeof this.onItemDel&&!1===this.onItemDel(e,"memo")||("function"!==typeof this.pushOper||s||this.pushOper("addMemo",[e,this.state.$memos[e]]),this.$editable&&(this.$deletedItem[e]="memo"),delete this.state.$memos[e],this.setState({$memos:this.state.$memos}),--this.$memoCount,!i&&this.$navMap&&this.$nextTick((function(){this.refreshMap()}))))},moveMemo:function(e,t,s){if(this.state.$memos[e]&&(null==this.onItemMove||!1!==this.onItemMove(e,"memo",t,s))){"function"===typeof this.pushOper&&this.pushOper("moveMemo",[e,this.state.$memos[e].left,this.state.$memos[e].top]),t<0&&(t=0),s<0&&(s=0);var i=this.state.$memos[e];i.left=t,i.top=s,this.$editable&&(i.alt=!0),this.state.$memos[e]=i;var o=document.getElementById(e);o.style.left=t*this.scale+"px",o.style.top=s*this.scale+"px",this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},resizeMemo:function(e,t,s){if(this.state.$memos[e]&&("function"!==typeof this.onItemResize||!1!==this.onItemResize(e,"memo",t,s))){"function"===typeof this.pushOper&&this.pushOper("resizeMemo",[e,this.state.$memos[e].width,this.state.$memos[e].height]);var i=document.getElementById(e);i.childNodes[0].style.width=t*this.scale+"px",i.childNodes[0].style.height="auto";var o=i.offsetHeight;(s*=this.scale)<o&&(s=o),i.childNodes[0].style.height=s+"px";var n=this.state.$memos[e];n.width=t,n.height=s/this.scale,this.$editable&&(n.alt=!0),this.state.$memos[e]=n,this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},setMemoText:function(e,t){if(this.state.$memos[e]&&this.state.$memos[e].text!==t&&("function"!==typeof this.onMemoSetText||!1!==this.onMemoSetText(e,t))){var s=this.state.$memos[e],i=this.state.$memos[e].text;s.text=t;var o=document.getElementById(e);o.querySelector(".memo_text").innerHTML=t,o.childNodes[0].style.height="auto";var n=o.offsetWidth/this.scale,r=o.offsetHeight/this.scale;r<s.height&&(r=s.height),o.childNodes[0].style.height=r*this.scale+"px",s.width===n&&s.height===r||("function"===typeof this.pushOper&&this.pushOper("resizeMemo",[e,s.width,s.height]),s.width=n,s.height=r),this.$editable&&(s.alt=!0),this.state.$memos[e]=s,"function"===typeof this.pushOper&&this.pushOper("setMemoText",[e,i])}}}},Y={flag:"autoalign",prop:{_amin:6},methods:{_locAlignLine:function(e,t,s){var i=[],o=this.$refs.$workArea.parentNode,n=o.scrollLeft-this.t.left,r=o.scrollTop-this.t.top;i="group"!==s&&"group"!==t.getData("type")||!this.extFlag.group?"memo"!==s&&"memo"!==t.getData("type")||!this.extFlag.memo?this.state.$nodes:this.state.$memos:this.state.$areas;var a={h:-1,hType:"",v:-1,vType:""},l=t.offsetSize(),h=parseInt(t.$el.style.left.split("px")[0],10)+n,d=parseInt(t.$el.style.top.split("px")[0],10)+r,c=l.width,p=l.height;for(var u in i)e!==u&&i.hasOwnProperty(u)&&(h+c/2>=(i[u].left+i[u].width/2)*this.scale-this._amin&&h+c/2<=(i[u].left+i[u].width/2)*this.scale+this._amin?(a.h=(i[u].left+i[u].width/2)*this.scale-o.scrollLeft,a.hType="center"):h+c>=i[u].left*this.scale-this._amin&&h+c<=i[u].left*this.scale+this._amin?(a.h=i[u].left*this.scale-o.scrollLeft,a.hType="right"):h>=i[u].left*this.scale-this._amin&&h<=i[u].left*this.scale+this._amin?(a.h=i[u].left*this.scale-o.scrollLeft,a.hType="left"):h+c>=(i[u].left+i[u].width)*this.scale-this._amin&&h+c<=(i[u].left+i[u].width)*this.scale+this._amin?(a.h=(i[u].left+i[u].width)*this.scale-o.scrollLeft,a.hType="right"):h>=(i[u].left+i[u].width)*this.scale-this._amin&&h<=(i[u].left+i[u].width)*this.scale+this._amin&&(a.h=(i[u].left+i[u].width)*this.scale-o.scrollLeft,a.hType="left"),d+p/2>=(i[u].top+i[u].height/2)*this.scale-this._amin&&d+p/2<=(i[u].top+i[u].height/2)*this.scale+this._amin?(a.v=(i[u].top+i[u].height/2)*this.scale-o.scrollTop,a.vType="middle"):d+p>=i[u].top*this.scale-this._amin&&d+p<=i[u].top*this.scale+this._amin?(a.v=i[u].top*this.scale-o.scrollTop,a.vType="bottom"):d>=i[u].top*this.scale-this._amin&&d<=i[u].top*this.scale+this._amin?(a.v=i[u].top*this.scale-o.scrollTop,a.vType="top"):d+p>=(i[u].top+i[u].height)*this.scale-this._amin&&d+p<=(i[u].top+i[u].height)*this.scale+this._amin?(a.v=(i[u].top+i[u].height)*this.scale-o.scrollTop,a.vType="bottom"):d>=(i[u].top+i[u].height)*this.scale-this._amin&&d<=(i[u].top+i[u].height)*this.scale+this._amin&&(a.v=(i[u].top+i[u].height)*this.scale-o.scrollTop,a.vType="top"));return a.h+=o.scrollLeft,a.v+=o.scrollTop,a},_magnetic:function(e,t){if(null==t||-1===t.v&&-1===t.h)return this.$refs.$alignH.style.display="none",void(this.$refs.$alignV.style.display="none");t.h>-1?(this.$refs.$alignH.style.display="block",this.$refs.$alignH.style.left=t.h+"px"):this.$refs.$alignH.style.display="none",t.v>-1?(this.$refs.$alignV.style.display="block",this.$refs.$alignV.style.top=t.v+"px"):this.$refs.$alignV.style.display="none";var s=e.offsetSize(),i=this.t.left-this.$refs.$workArea.parentNode.scrollLeft,o={left:e.$el.style.left,top:e.$el.style.top};switch(t.hType){case"center":o.left=t.h-s.width/2+i+"px";break;case"left":o.left=t.h+i+"px";break;case"right":o.left=t.h-s.width+i+"px"}switch(i=this.t.top-this.$refs.$workArea.parentNode.scrollTop,t.vType){case"middle":o.top=t.v-s.height/2+i+"px";break;case"top":o.top=t.v+i+"px";break;case"bottom":o.top=t.v-s.height+i+"px"}e.show(o)}}},V={flag:"print",methods:{print:function(e){var t=this._suitSize();e||(e=1),t.width+=100,t.height+=100;var s=this.$refs.$workArea.cloneNode(!0);s.style.backgroundImage="none";for(var i=0,o=["",".GooFlow_work_paper",".GooFlow_work_group","svg"];i<o.length;i++){var n=o[i],r=""===n?s:s.querySelector(n);r&&(r.style.width=t.width+"px",r.style.height=t.height+"px")}var a=document.createElement("div");a.className="GooFlow GooFlow_work",a.style.width=t.width+"px",a.style.height=t.height+"px",a.style.overflow="hidden",a.append(s),this.GooFlow.color.font&&(a.style.color=this.GooFlow.color.font),a.style.transform="scale("+e+")",a.style.transformOrigin="top left",function(e,t){var s={pageTitle:"",base:!1};Object.assign(s,t);var i="printThis-"+(new Date).getTime(),o=document.createElement("iframe");o.name="printIframe",o.id=i,document.body.appendChild(o),window.location.hostname!==document.domain&&navigator.userAgent.match(/msie/i)&&(o.className="MSIE",o.src="about:blank",o.document.write("<head><script>document.domain='"+document.domain+"';<\/script><title></title></head><body></body>"));var n=document.getElementById(i);k.css(n,{position:"absolute",width:"0px",height:"0px",left:"-600px",top:"-600px"}),setTimeout((function(){!function(e){var t=(e=e.contentWindow||e.contentDocument||e).document||e.contentDocument||e;t.open(),t.write("<!DOCTYPE html>"),t.close()}(n);var t,i=n.document||n.contentDocument||n,o=i.head,r=i.body,a=document.querySelector("base");k.css(r,{height:"auto",margin:"0",padding:"0",background:"#fff"}),t=!0===s.base&&null!=a?a.getAttribute("href"):"string"===typeof s.base?s.base:document.location.protocol+"//"+document.location.host;var l=i.createElement("base");l.setAttribute("href",t),o.appendChild(l);for(var h=document.querySelectorAll("link"),d=0;d<h.length;++d){var c=h[d].getAttribute("href");if(c&&""!==c){var p=h[d].getAttribute("media")||"all",u=h[d].cloneNode(!0);u.setAttribute("media",p),o.appendChild(u)}}for(var f=document.querySelectorAll("style"),m=0;m<f.length;++m){var g=f[m].cloneNode(!0);o.appendChild(g)}if(s.pageTitle){var v=i.createElement("title");v.innerHTML=s.pageTitle,o.appendChild(v)}var $=e.cloneNode(!0);r.appendChild($),setTimeout((function(){if(k.hasClass(n,"MSIE")){window.frames.printIframe.focus();var e=document.createElement("script");e.type="text/javascript",e.innerHTML="window.print();",o.appendChild(e)}else document.queryCommandSupported("print")?n.contentWindow.document.execCommand("print",!1,null):(n.contentWindow.focus(),n.contentWindow.print());setTimeout((function(){n.parentNode.removeChild(n)}),1e3)}),333)}),333)}(a,{base:document.URL,pageTitle:this.$title})}}},K=s(7),Q=s.n(K),Z={auth:"\u4ec5\u5728\u7ebf\u8bd5\u7528\u7248"};s(15);var ee=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"aaaabbb",width:"900",height:"600",haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,useOperStack:!0,haveMulti:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,toolBtns:["start round mix","end round mix","task","node","chat","state","plug","join","fork","complex mix"],toolTextWidth:60,auth:Z.auth},i.global=q,i.plugIns=[J,U,V,Y],i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsx)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:"adfdsfasdfsdafasdf"});return Object(f.jsx)("div",{id:"DemoBase",children:Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,ref:function(t){return e.gooFlow=t}})})}},{key:"componentDidMount",value:function(){var e=this.gooFlow;Q.a.get("./demo/data2.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.loadData(t.data)})),e.bindOperEvent({onPrintClick:function(){e.print()}})}}]),s}(o.a.Component),te=s(38),se=function(){CanvasRenderingContext2D.prototype.roundRect=function(e,t,s,i,o){return s<2*o&&(o=s/2),i<2*o&&(o=i/2),this.beginPath(),this.moveTo(e+o,t),this.arcTo(e+s,t,e+s,t+i,o),this.arcTo(e+s,t+i,e,t+i,o),this.arcTo(e,t+i,e,t,o),this.arcTo(e,t,e+s,t,o),this.closePath(),this},CanvasRenderingContext2D.prototype.BezierEllipse=function(e,t,s,i){var o=.5522848,n=s*o,r=i*o;return this.beginPath(),this.moveTo(e-s,t),this.bezierCurveTo(e-s,t-r,e-n,t-i,e,t-i),this.bezierCurveTo(e+n,t-i,e+s,t-r,e+s,t),this.bezierCurveTo(e+s,t+r,e+n,t+i,e,t+i),this.bezierCurveTo(e-n,t+i,e-s,t+r,e-s,t),this.closePath(),this}},ie={canvasExtend:function(){se()},initBg:function(e,t,s){var i=document.createElement("canvas");i.width=e,i.height=t;var o=i.getContext("2d");return s&&(o.fillStyle=s),o.fillRect(0,0,i.width,i.height),o.save(),i},_toNum:function(e){return null!==e&&""!==e?parseInt(e.split("px")[0],10):void 0},_analyseLabel:function(e){var t=e.tagName.toUpperCase(),s=e.offsetLeft,i=e.offsetTop,o=null,n=0;if("SPAN"===t){var r=e,a=x.getRealStyle(r);n=this._toNum(a.marginTop),o=a.transform}else o=e.style.transform;var l=x.getRealStyle(e),h=this._toNum(l.lineHeight),d=l.fontSize;return{isMemo:!!k.hasClass(e,"memo_text")||void 0,fontFamily:l.fontFamily,fontSize:this._toNum(d.split("px")[0]),text:e.innerText||e.textContent,color:l.color,width:e.offsetWidth,height:e.offsetHeight,transform:o,lineHeight:h,offsetLeft:s,offsetTop:i,lineNum:Math.ceil(e.offsetHeight/h),marginTop:n}},_analyseIcon:function(e,t){var s=x.getRealStyle(e),i=s.backgroundImage,o={offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight};return i&&"none"!==i?(i=i.replace(/"/g,"").split("url(")[1],o.backgroundImage=i.substr(0,i.length-1),i=s.backgroundPosition.split(" "),o.pX=-1*parseFloat(i[0].split("px")[0]),o.pY=-1*parseFloat(i[1].split("px")[0]),o.offsetLeft=t?e.parentNode.offsetLeft:e.offsetLeft,o.offsetTop=t?e.parentNode.offsetTop:e.offsetTop,t&&(o.isCustom=!0)):(o.font="18px "+s.fontFamily.split(" ")[0],o.lineHeight=this._toNum(s.lineHeight),o.color=s.color,o.opacity=parseFloat(s.opacity),o.content=window.getComputedStyle(e,"::before").getPropertyValue("content")),o},_fillIcon:function(e,t,s,i,o,n){var r=e.getContext("2d");if(void 0===i.backgroundImage){0===i.content.indexOf('"')&&(i.content=i.content.split('"')[1]),i.color=i.color.replace("rgb","rgba").replace(")",", "+i.opacity+")"),r.fillStyle=i.color,r.font=i.font,r.textAlign="center",r.textBaseline="middle";var a=t+i.offsetLeft+i.width/2+1,l=s+i.offsetTop+i.height/2;return r.save(),r.lineHeight=i.lineHeight,r.translate(a,l),r.scale(n,n),r.fillText(i.content,0,0),r.restore(),null}r.save();var h=0,d=0;i.pX<0&&(h-=i.pX,i.pX=0),i.pY<0&&(d-=i.pY,i.pY=0),n>1&&!i.isCustom&&(i.offsetLeft+=i.width*(1-n)/2,i.offsetTop+=i.height*(1-n)/2),r.drawImage(o,i.pX,i.pY,i.width,i.height,t+i.offsetLeft+h,s+i.offsetTop+d,i.width*n,i.height*n),r.restore()},_fillLabel:function(e,t,s,i,o){var n=e.getContext("2d");n.fillStyle=i.color,n.textAlign=i.isMemo||i.isGroup?"left":"center",n.font=i.fontSize+"px "+i.fontFamily,n.textBaseline="middle";var r=i.text,a=0,l=0,h=t+i.offsetLeft+(i.isMemo||i.isGroup?0:i.width/2),d=s+i.offsetTop+i.lineHeight/2;o&&(h-=o.x,d+=o.y),navigator.userAgent.indexOf("Firefox")>=0&&(d+=i.lineHeight-i.fontSize),n.save(),n.translate(h,d),d=0,h=0;for(var c=0;c<r.length;c++)a+=n.measureText(r[c]).width,c!==r.length-1?a>=i.width&&(n.fillText(r.substring(l,c),h,d),d+=i.lineHeight,a=0,l=c):n.fillText(r.substring(l,c+1),h,d);n.restore()},_analyseArea:function(e){var t=e.querySelector(".bg"),s=x.getRealStyle(t);return{top:this._toNum(e.style.top),left:this._toNum(e.style.left),width:e.offsetWidth,height:e.offsetHeight,borderColor:s.borderTopColor,bgColor:s.backgroundColor,opacity:parseFloat(s.opacity),icon:this._analyseIcon(e.querySelector("i")),label:this._analyseLabel(e.querySelector("label"))}},renderAreas:function(e,t,s,i){var o=e.getContext("2d");for(var n in t){var r=t[n];r.bgColor=r.bgColor.replace("rgb","rgba").replace(")",", "+r.opacity+")"),r.borderColor=r.borderColor.replace("rgb","rgba").replace(")",", "+r.opacity+")"),o.beginPath(),o.rect(r.left,r.top,r.width,r.height),o.strokeStyle=r.borderColor,o.stroke(),o.fillStyle=r.bgColor,o.fill(),this._fillIcon(e,r.left,r.top,r.icon,s,i),this._fillLabel(e,r.left,r.top,r.label)}},_analyseMemo:function(e){var t=this._analyseIcon(e.querySelector("i"));t.font="14px "+t.font.split(" ")[1];var s=this._analyseLabel(e.querySelector(".memo_text"));s.font="12px "+s.fontFamily;var i=x.getRealStyle(e);return{top:this._toNum(e.style.top),left:this._toNum(e.style.left),width:e.offsetWidth,height:e.offsetHeight,bgColor:i.color,boxShadow:i.boxShadow,icon:t,label:s}},renderMemos:function(e,t){var s=e.getContext("2d");for(var i in t){var o=t[i];s.save(),s.fillStyle=o.bgColor;var n=o.boxShadow.split(") ");s.shadowColor=n[0],n=n[1].split(" "),s.shadowOffsetX=this._toNum(n[0]),s.shadowOffsetY=this._toNum(n[1]),s.shadowBlur=this._toNum(n[2]),s.beginPath(),s.moveTo(o.left+10,o.top),s.lineTo(o.left+o.width,o.top),s.lineTo(o.left+o.width,o.top+o.height),s.lineTo(o.left,o.top+o.height),s.lineTo(o.left,o.top+10),s.lineTo(o.left+10,o.top),s.closePath(),s.fill(),s.restore(),s.save(),s.fillStyle="rgba(0,0,0,0.1)",s.beginPath(),s.moveTo(o.left+10,o.top),s.lineTo(o.left+10,o.top+10),s.lineTo(o.left,o.top+10),s.lineTo(o.left+10,o.top),s.closePath(),s.fill(),s.restore(),s.save(),s.fillStyle=o.icon.color,s.font=o.icon.font,s.textAlign="center",s.textBaseline="middle";var r=o.left+o.width/2,a=o.top+2;s.translate(r,a),0===o.icon.content.indexOf('"')&&(o.icon.content=o.icon.content.split('"')[1]),s.fillText(o.icon.content,0,0),s.restore(),o.label.offsetLeft<0&&(o.label.offsetLeft=0),this._fillLabel(e,o.left,o.top,o.label)}},_analyseNode:function(e,t){var s="";k.hasClass(e,"item_ellipse")&&(s="ellipse"),k.hasClass(e,"item_rhomb")&&(s="rhomb"),k.hasClass(e,"item_round")&&(s="round"),k.hasClass(e,"item_parallelogram")&&(s="parallelogram"),k.hasClass(e,"item_custom")&&(s="custom"),k.hasClass(e,"item_slot")&&(s="slot");var i=x.getRealStyle(e),o="slot"!==s?i.backgroundColor:x.getRealStyle(e.children[0].children[0]).backgroundColor;"rgba(0, 0, 0, 0)"===o.toLowerCase()&&(o=t.GooFlow.color.node);var n={top:this._toNum(e.style.top),left:this._toNum(e.style.left),width:e.offsetWidth,height:e.offsetHeight,outlineColor:i.outlineColor,outlineWidth:this._toNum(i.outlineWidth),bgColor:o,borderRadius:this._toNum(i.borderTopLeftRadius),boxShadow:"slot"!==s?i.boxShadow:x.getRealStyle(e.children[0].children[0]).boxShadow,spClass:s,icon:"slot"!==s?this._analyseIcon(e.querySelector(".ico").children[0],"custom"===s):null};return n.label="round"===s||"rhomb"===s||"custom"===s?this._analyseLabel(e.querySelector(".span")):"slot"!==s?this._analyseLabel(e.querySelector(".txtpd>span")):this._analyseLabel(e.querySelector(".slot_name>span")),n},renderNodes:function(e,t,s,i){var o=e.getContext("2d");for(var n in t){var r=t[n],a=r.boxShadow.split(") ");if(1===a.length){var l=r.boxShadow.split("rgba");a[0]="rgba"+l[1],a[1]=l[0]}"custom"!==r.spClass&&"none"!==r.boxShadow&&(o.shadowColor=a[0],a=a[1].split(" "),o.shadowOffsetX=this._toNum(a[0]),o.shadowOffsetY=this._toNum(a[1]),o.shadowBlur=this._toNum(a[2])),o.fillStyle=r.bgColor,"ellipse"===r.spClass?o.BezierEllipse(r.left+r.width/2,r.top+r.height/2,r.width/2,r.height/2).fill():"rhomb"===r.spClass?(o.save(),o.translate(r.left+r.width/2,r.top+r.height/2),o.rotate(45*Math.PI/180),o.roundRect(-r.width/2,-r.height/2,r.width,r.height,r.borderRadius).fill(),o.restore()):"parallelogram"===r.spClass?(o.save(),o.translate(r.left+r.width/2,r.top+r.height/2),o.transform(1,0,-12/r.height,1,0,0),o.roundRect(-r.width/2,-r.height/2,r.width,r.height,r.borderRadius).fill(),o.restore()):"custom"===r.spClass||o.roundRect(r.left,r.top,r.width,r.height,r.borderRadius).fill(),o.shadowBlur=0,o.shadowColor="",o.shadowOffsetX=0,o.shadowOffsetY=0,o.strokeStyle=r.outlineColor,o.lineWidth=0===r.outlineWidth?.01:r.outlineWidth,o.stroke(),o.restore(),null!=r.icon&&this._fillIcon(e,r.left,r.top,r.icon,s,i),null!=r.label&&this._fillLabel(e,r.left,r.top,r.label,"rhomb"===r.spClass?{x:r.width/3*1.41,y:r.height/4}:void 0)}},_analyseLine:function(e,t){var s=x.getRealStyle(e).fontFamily,i=t.querySelector("path[stroke-linecap]"),o=i.getAttribute("marker-end"),n={color:i.getAttribute("stroke"),lineWidth:i.getAttribute("stroke-width"),lineCap:"round",noArrow:!o||null==o},r=i.style.strokeDasharray;n.lineDash=r&&null!=r;var a=t.childNodes[2],l=a.getAttribute("fill");l&&null!==l&&""!==l||(l="#777"),n.label={text:a.textContent,font:a.style.fontSize+" "+s,color:l,left:a.getAttribute("x"),top:a.getAttribute("y")};for(var h=i.getAttribute("d"),d=h.substring(2,h.length).split(/[L|Q]/),c=[],p=0;p<d.length;++p){d[p]=d[p].replace(/^\s+|\s+$/gm,"");var u=d[p].split(" ");2===u.length?c.push({x:parseFloat(u[0]),y:parseFloat(u[1])}):c.push({x:parseFloat(u[0]),y:parseFloat(u[1]),dX:parseFloat(u[2]),dY:parseFloat(u[3])})}n.points=c;var f=c.length,m=c[f-1].x-c[f-2].x,g=c[f-1].y-c[f-2].y;return n.angle=Math.atan2(g,m),n},renderLines:function(e,t){var s=e.getContext("2d");for(var i in t){var o=t[i];s.save(),s.setLineDash(o.lineDash?[4,6]:[]),s.strokeStyle=o.color,s.lineWidth=o.lineWidth,s.lineCap=o.lineCap;var n=o.points;s.beginPath(),s.moveTo(n[0].x,n[0].y);for(var r=1;r<n.length;++r)if(n[r].dX){var a=n[r].y===n[r].dY?Math.abs(n[r].x-n[r].dX):Math.abs(n[r].y-n[r].dY);s.arcTo(n[r].x,n[r].y,n[r].dX,n[r].dY,a),s.moveTo(n[r].dX,n[r].dY)}else s.lineTo(n[r].x,n[r].y),r!==n.length-1&&s.moveTo(n[r].x,n[r].y);if(s.closePath(),s.stroke(),o.noArrow||(s.translate(n[n.length-1].x,n[n.length-1].y),s.rotate(o.angle),s.fillStyle=o.color,s.beginPath(),s.moveTo(1*o.lineWidth,0),s.lineTo(-6*o.lineWidth,-3*o.lineWidth),s.lineTo(-6*o.lineWidth,3*o.lineWidth),s.lineTo(1*o.lineWidth,0),s.closePath(),s.fill()),s.restore(),o.label&&null!=o.label.text&&""!==o.label.text){var l=e.getContext("2d"),h=o.label;l.fillStyle=h.color,l.textAlign="center",l.font=h.font,l.fillText(h.text,h.left,h.top)}}}};function oe(e,t,s){try{var i=new Blob([e]);if(window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(i,t+"."+s);else{var o=document.createElement("a");o.href=window.URL.createObjectURL(i),o.download=t+"."+s,o.click(),window.URL.revokeObjectURL(o.href)}}catch(r){for(var n=window.open("","_blank");"complete"!==n.document.readyState&&"complete"!==n.document.readyState;);n.document.write("<html><head><title>"+t+"."+s+"</title></head><body><pre>"+("xml"===s?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e)+"</pre></body></html>")}}var ne={flag:"export",initFuncName:"canvasExtend",methods:{canvasExtend:function(){ie.canvasExtend()},exportDiagram:function(e){var t=this;if(this.scale<1)this.resetScale(1,(function(){t.exportDiagram(e)}));else{for(var s=void 0,i=null,o=this,n={},r=this.$refs.$group.querySelectorAll(".GooFlow_area"),a=0;a<r.length;++a)n[r[a].id]=ie._analyseArea(r[a]),n[r[a].id].icon.backgroundImage&&null===i&&(i=n[r[a].id].icon.backgroundImage);for(var l={},h=this.$refs.$paper.querySelectorAll(".GooFlow_memo"),d=0;d<h.length;++d)l[h[d].id]=ie._analyseMemo(h[d]);for(var c={},p=this.$refs.$workArea.querySelectorAll(".GooFlow_item"),u=0;u<p.length;++u)c[p[u].id]=ie._analyseNode(p[u],o),null!=c[p[u].id].icon&&c[p[u].id].icon.backgroundImage&&null===i&&(i=c[p[u].id].icon.backgroundImage);var f=this._suitSize(),m=f.width+100,g=f.height+100,v=ie.initBg(m,g,"#ffffff");null!==i&&((s=new Image).setAttribute("crossOrigin","anonymous"),s.src=i);var $=function(){r.length>0&&ie.renderAreas(v,n,s,o.scale),h.length>0&&ie.renderMemos(v,l),ie.renderNodes(v,c,s,o.scale);var t=v.getContext("2d");if(t.restore(),window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("Edge")>-1){for(var i={},a=this.$refs.$draw.querySelectorAll("g"),d=0;d<a.length;++d)"GooFlow_tmp_line"!==a[d].getAttribute("tid")&&(i[a[d].id]=ie._analyseLine(o.$el,a[d]));ie.renderLines(v,i);try{var p=v.msToBlob();navigator.msSaveBlob(p,e+".png")}catch(y){for(var u=v.toDataURL("image/png"),f=window.open("","_blank");"complete"!==f.document.readyState&&"complete"!==f.document.readyState;);f.document.write("<html><head><title>"+e+'.png</title></head><body><img src="'+u+'" title="'+e+'.png"></body></html>')}}else{var $='<svg xmlns="http://www.w3.org/2000/svg" width="'+m+'" height="'+g+'"><defs><style type="text/css">text{font-size:14px;line-height:1.42857143;font-family:"Microsoft Yahei", "Helvetica Neue", Helvetica, Hiragino Sans GB, WenQuanYi Micro Hei, Arial, sans-serif;}</style></defs>'+o.$refs.$draw.innerHTML+"</svg>",b=new Image;b.src="data:image/svg+xml,"+encodeURIComponent($),b.onload=function(){t.drawImage(b,0,0);var s=document.createElementNS("http://www.w3.org/1999/xhtml","a");s.href=v.toDataURL("image/png"),s.download=e+".png",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}};!s||s.complete||window.ActiveXObject||"ActiveXObject"in window?$():s.onload=function(){$()}}},exportDataFile:function(e,t){if("json"===t)oe(JSON.stringify(this.exportData()),e,"json");else{if("xml"!==t)return;try{oe(this.exportBpmnXML(),e,"xml")}catch(s){console.warn("failed in exec function exportBpmnXML()! you need extend the xml.js plugin for supported.")}}}}};s(15);var re=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).handleChange=function(e){console.log(e.target.value),i.setState(Object(te.a)({},e.target.name,e.target.value))},i.gooFlow=null,i.myProps={id:"multi_demo",width:"900",height:"600",haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,useOperStack:!0,haveMulti:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,toolBtns:["start round mix","end round","task","node","chat","state","plug","join","fork","complex mix"],toolTextWidth:60,auth:Z.auth},i.global=q,i.plugIns=[J,U,Y,V,ne],i.exportDiagram=i.exportDiagram.bind(Object($.a)(i)),i.loadJson=i.loadJson.bind(Object($.a)(i)),i.state={jsonStr:""},i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsx)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:Object(f.jsx)("button",{type:"button",onClick:this.exportDiagram,children:"\u5bfc\u51fa\u6d41\u7a0b\u56fe\u7247"})});return Object(f.jsxs)("div",{id:"DemoExport",children:[Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,ref:function(t){return e.gooFlow=t}}),Object(f.jsx)("textarea",{style:{width:"900px",height:"280px"},id:"jsonResult",value:this.state.jsonStr,onChange:this.handleChange}),Object(f.jsx)("button",{type:"button",onClick:this.loadJson,children:"\u5bfc\u5165JSON"})]})}},{key:"exportDiagram",value:function(){this.gooFlow.exportDiagram("myFlow")}},{key:"loadJson",value:function(){console.log(this.gooFlow),this.gooFlow.loadData(JSON.parse(this.state.jsonStr))}},{key:"componentDidMount",value:function(){var e=this,t=this.gooFlow;Q.a.get("./demo/data2.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.setState({jsonStr:JSON.stringify(t.data)})})),t.bindOperEvent({onPrintClick:function(){t.print()},onBtnSaveClick:function(){t.exportDiagram("myFlow")}})}}]),s}(o.a.Component),ae={flag:"dragadd",methods:{_initDragAddOper:function(){if(this.$editable&&this.$refs.$tool){var e=this;j(this.$refs.$tool.$el,"mousedown","li",{},(function(t,s){var i=s.getAttribute("type"),o=s.title;if(e.$dragAddOper&&"cursor"!==i&&!x.isDrawingLine(i)){var n="",r=x.getCoor(t,e.$refs.$workArea),a=e.$nodeCustoms[i],l={width:104,height:26,type:i,title:null!=o&&""!==o?o:"--------",left:r.X,top:r.Y,canOver:!0};if(void 0!==a&&null!=a){a.width&&(l.width=a.width),a.height&&(l.height=a.height);var h='<i class="'+a.class+'" style="width:'+l.width+"px;height:"+l.height+'px;"></i>';n='<table cellspacing="0" style="width:'+l.width*e.scale+"px;height:"+l.height*e.scale+'px;margin:-1px"><tr><td class="ico">'+h+"</td></tr></table>"}else l.type.indexOf(" round")>-1?(l.width=26,l.height=26,l.title=""):l.type.indexOf(" rhomb")>0?(l.width=30,l.height=30,l.title=""):"group"===l.type?(l.width=200,l.height=100):"memo"===l.type?(l.width=140,l.height=54):n='<table cellspacing="1" style="width:'+(l.width*e.scale-2)+"px;height:"+(l.height*e.scale-2)+'px;"><tr><td class="ico"><i class="ico_'+l.type+'"></i></td><td><div>'+l.title+"</div></td></tr></table>";""===n&&(n='<table cellspacing="0" style="width:'+(l.width*e.scale-2)+"px;height:"+(l.height*e.scale-2)+'px;"><tr><td class="ico"><i class="ico_'+l.type+'"></i> '+l.title+"</td></tr></table>"),e.$refs.$ghost.setData("type",i),e.$refs.$ghost.html(n),e.$refs.$ghost.css({cursor:"move"}),e._bindMoveEvent(t,l,(function(t,s,i,o,n){if(s.$refs.$ghost.removeData("type"),!(o<0||n<0)&&t){if("group"===l.type){s.switchToolBtn("group");s.addArea((new Date).getTime(),{name:s.$areaPrefix+s.$max,left:o/s.scale,top:n/s.scale,color:["red","yellow","blue","green","milk"][s.$max%5],width:200,height:100})}else if("memo"===l.type)s.switchToolBtn("memo"),s.addMemo((new Date).getTime(),{text:"",left:o/s.scale,top:n/s.scale,width:140,height:54});else{s.switchToolBtn("cursor");var r=s.$slotNodeRenders[l.type],a={name:s.$nodePrefix+s.$max,left:o/s.scale,top:n/s.scale,width:l.width,height:l.height,type:l.type};r&&(Object.assign(a,r.initInfo),a.width=r.minWidth,a.height=r.minHeight),e.addNode((new Date).getTime(),a)}s.$max++}}),"move",l.width,l.height)}}))}}}};s(15),s(24);var le=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"aaaabbb",width:"900",height:"600",haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,dragAddOper:!0,useOperStack:!0,haveMulti:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,toolBtns:["start round mix","end round","task","node","huber","router","plug2"],nodeCustoms:{huber:{class:"custom_huber",width:102,height:50},router:{class:"custom_router",width:115,height:52}},auth:Z.auth},i.global=q,i.plugIns=[J,U,Y,ae,V],i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsx)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:"\u62d6\u62fd\u5f0f\u6dfb\u52a0\u5757\u72b6\u5143\u7d20\u64cd\u4f5c\u65b9\u5f0f"});return Object(f.jsx)("div",{id:"DemoDragadd",children:Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,ref:function(t){return e.gooFlow=t}})})}},{key:"componentDidMount",value:function(){var e=this.gooFlow;Q.a.get("./demo/data2.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.loadData(t.data)})),e.bindOperEvent({onPrintClick:function(){e.print()}})}}]),s}(o.a.Component);s(15);var he=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"aaaabbb",width:"900",height:"600",haveHead:!1,headLabel:!0,haveTool:!1,toolBtns:["start round mix","end round","task","node","chat","state","plug","join","fork","complex mix"],auth:Z.auth},i.global=q,i.plugIns=[J,U,Y,V],i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsx)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:"\u53ea\u8bfb\u6a21\u5f0f-\u624b\u52a8\u6807\u6ce8\u6f14\u793a"});return Object(f.jsx)("div",{id:"DemoReadonly",children:Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,ref:function(t){return e.gooFlow=t}})})}},{key:"componentDidMount",value:function(){var e=this.gooFlow;Q.a.get("./demo/data2.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.loadData(t.data)})),e.bindOperEvent({onItemFocus:function(t,s){var i=null;if("node"===s)i=e.state.$nodes[t];else{if("line"!==s)return;i=e.state.$lines[t]}return e.markItem(t,s,!i.marked),!1}})}}]),s}(o.a.Component);s(15);var de=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"aaaabbb",width:"900",height:"600",haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,useOperStack:!0,haveMulti:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,toolBtns:["start round mix","end round mix","task","node capsule","chat parallelogram","state","plug","join rhomb","fork rhomb","complex ellipse mix"],toolTextWidth:60,auth:Z.auth},i.global=q,i.plugIns=[J,U,Y,V,ne],i.exportDiagram=i.exportDiagram.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsxs)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:["\u7279\u6b8a\u5f62\u72b6\u7684\u8282\u70b9 ",Object(f.jsx)("button",{type:"button",onClick:this.exportDiagram,children:"\u5bfc\u51fa\u6d41\u7a0b\u56fe\u7247"})]});return Object(f.jsx)("div",{id:"DemoSpnode",children:Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,ref:function(t){return e.gooFlow=t}})})}},{key:"exportDiagram",value:function(){this.gooFlow.exportDiagram("myFlow")}},{key:"componentDidMount",value:function(){var e=this.gooFlow;Q.a.get("./demo/data3.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.loadData(t.data)})),e.bindOperEvent({onPrintClick:function(){e.print()},onBtnSaveClick:function(){e.exportDiagram("myFlow")}})}}]),s}(o.a.Component);s(15),s(72);var ce=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"aaaabbb",width:"800",height:"500",auth:Z.auth,toolBtns:["start round mix","end round mix","task","table","card","glass","state"],haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,haveGroup:!0,haveMemo:!0,useOperStack:!0},i.global=q,i.plugIns=[J,U,Y,V,ne],i.renderDemo=i.renderDemo.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsxs)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:["\u63d2\u69fd\u5f0f\u8282\u70b9 ",Object(f.jsx)("button",{type:"button",onClick:this.renderDemo,children:"\u91cd\u65b0\u6e32\u67d3\u4e00\u4e2a\u8282\u70b9"})]}),s={table:{minWidth:200,minHeight:300,resizable:!0,initInfo:{extra:{list:[]}},exec:function(t,s){return Object(f.jsxs)("div",{className:"table",children:[Object(f.jsx)("div",{className:"table-title","data-nid":t,children:s.name}),Object(f.jsx)("ul",{className:"table-tody","data-stop-bubble":"1",children:s.extra.list.map((function(t){return Object(f.jsxs)("li",{className:"table-tr",children:[Object(f.jsx)("div",{className:"table-td1",onClick:e.consoleLI.bind(e,t.fieldName,t.fieldType),children:t.fieldName}),Object(f.jsx)("div",{className:"table-td2",children:t.fieldType})]},t.fieldName)}))})]})}},card:{minWidth:280,minHeight:180,resizable:!0,initInfo:{extra:{}},exec:function(e,t){return Object(f.jsxs)("div",{className:"card-container","data-nid":e,children:[Object(f.jsx)("div",{className:"card-img",children:t.extra.image?Object(f.jsx)("img",{src:t.extra.image,alt:"",draggable:"false"}):Object(f.jsx)("div",{className:"card-no-img",children:"\u65e0\u56fe\u65e0\u771f\u76f8"})}),Object(f.jsxs)("div",{className:"card-main",children:[Object(f.jsx)("div",{className:"avator",children:t.extra.avator?Object(f.jsx)("img",{src:t.extra.avator,alt:"",draggable:"false"}):Object(f.jsx)("div",{className:"card-noavator",children:"\u65e0\u56fe\u65e0\u771f\u76f8"})}),Object(f.jsxs)("div",{className:"card-info","data-stop-bubble":"1",children:[Object(f.jsxs)("li",{children:[Object(f.jsx)("label",{children:"\u59d3\u540d\uff1a"}),Object(f.jsx)("span",{children:t.extra.userName||""})]}),Object(f.jsxs)("li",{children:[Object(f.jsx)("label",{children:"\u56fd\u7c4d\uff1a"}),Object(f.jsx)("span",{children:t.extra.country||""})]}),Object(f.jsxs)("li",{children:[Object(f.jsx)("label",{children:"\u7279\u957f\uff1a"}),Object(f.jsx)("span",{children:t.extra.speciality||""})]})]})]})]})}},glass:{minWidth:80,minHeight:100,resizable:!1,initInfo:{extra:{label:""}},exec:function(e,t){return Object(f.jsxs)("div",{className:"glass-container","data-nid":e,children:[Object(f.jsx)("div",{className:"glass-main",children:t.extra.label||""}),Object(f.jsx)("div",{className:"glass-info","data-stop-bubble":"1",children:t.name})]})}}};return Object(f.jsx)("div",{id:"DemoCustom",children:Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,slotNodeRenders:s,ref:function(t){return e.gooFlow=t}})})}},{key:"renderDemo",value:function(){this.gooFlow.setItemExtra("demo_node_2","node",{extra:{image:"img/card.png",avator:"/img/cjk.jpg",userName:"\u82cd\u4e95\u7a7a",country:"\u5c0f\u65e5\u5b50\u9713\u8679\u5c9b\u56fd",speciality:"\u7ae5\u989c\u5de8RU\u7684\u8001\u5e08"}},!0)}},{key:"consoleLI",value:function(e,t){console.log(e,t)}},{key:"componentDidMount",value:function(){var e=this.gooFlow;Q.a.get("./demo/data4.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.loadData(t.data)})),e.bindOperEvent({onPrintClick:function(){e.print()},onBtnSaveClick:function(){e.exportDiagram("myFlow")}})}}]),s}(o.a.Component);s(15),s(24);var pe=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"aaaabbb",width:"800",height:"500",haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,useOperStack:!0,haveMulti:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,toolBtns:["start round mix","end round mix","huber","router","plug2","complex mix"],nodeCustoms:{huber:{class:"custom_huber",width:102,height:50},router:{class:"custom_router",width:115,height:52}},auth:Z.auth},i.global=q,i.plugIns=[J,U,Y,V,ne],i.exportDiagram=i.exportDiagram.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsxs)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:["\u81ea\u5b9a\u4e49\u80cc\u666f\u56fe\u8282\u70b9 ",Object(f.jsx)("button",{type:"button",onClick:this.exportDiagram,children:"\u5bfc\u51fa\u6d41\u7a0b\u56fe\u7247"})]});return Object(f.jsx)("div",{id:"DemoCustom",children:Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,ref:function(t){return e.gooFlow=t}})})}},{key:"exportDiagram",value:function(){this.gooFlow.exportDiagram("myFlow")}},{key:"componentDidMount",value:function(){var e=this.gooFlow;Q.a.get("./demo/data3.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.loadData(t.data)})),e.bindOperEvent({onPrintClick:function(){e.print()},onBtnSaveClick:function(){e.exportDiagram("myFlow")}})}}]),s}(o.a.Component);Object.keys=Object.keys||function(e){var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(s);return t};var ue={flag:"multi",prop:{$multiNodes:{},$multiLines:{},$multiKey:"shift"},events:{onBatchAdd:null,onBatchDel:null,onBatchMove:null,onBatchMark:null},methods:{_isMultiKey:function(e){return!(!e.shiftKey||"shift"!==this.$multiKey)||!(!e.ctrlKey||"ctrl"!==this.$multiKey)},_wallAllMulti:function(){if(this.$multiNodes&&this.$multiLines){if(0===Object.keys(this.$multiNodes).length&&0===Object.keys(this.$multiLines).length)return this.$refs.$multiGhost.hide(),void this.$refs.$multiOper.hide();var e=0,t=0,s=-1,i=-1;for(var o in this.$multiNodes){var n=this.state.$nodes[o];(-1===s||n.left<s)&&(s=n.left),(-1===i||n.top<i)&&(i=n.top),n.width+n.left>e&&(e=n.width+n.left),n.height+n.top>t&&(t=n.height+n.top)}for(var r in this.$multiLines){var a=this.state.$lines[r],l=document.getElementById(r),h=l.getAttribute("from").split(","),d=[];d[0]=parseFloat(h[0]),d[1]=parseFloat(h[1]);var c=l.getAttribute("to").split(","),p=[];p[0]=parseFloat(c[0]),p[1]=parseFloat(c[1]),"sl"===a.type||("tb"===a.type?(d[1]=a.M,p[1]=a.M):"lr"===a.type&&(d[0]=a.M,p[0]=a.M)),(-1===s||d[0]<s)&&(s=d[0]),(-1===s||p[0]<s)&&(s=p[0]),(-1===i||d[1]<i)&&(i=d[1]),(-1===i||p[1]<i)&&(i=p[1]),d[0]>e&&(e=d[0]),p[0]>e&&(e=p[0]),d[1]>t&&(t=d[1]),p[1]>t&&(t=p[1])}this.$refs.$multiGhost.show({left:s-2+"px",top:i-2+"px",width:e-s+4+"px",height:t-i+4+"px"}),this.$refs.$multiOper.show({left:e+4+"px",top:i-2+"px"})}},_addtoMultiList:function(e,t,s){var i=null;"node"===t?(this.$multiNodes[e]=e,i=document.getElementById(e),k.addClass(i,"item_focus"),i.style.borderColor=this.GooFlow.color.line):"line"===t&&(this.$multiLines[e]=e,(i=document.getElementById(e).querySelector("path[stroke-linecap='round']")).setAttribute("stroke","#ff8800"),this.state.$lines[e].noArrow||i.setAttribute("marker-end","url(#arrow2)")),s&&this._wallAllMulti()},_removeFromMultiList:function(e,t,s){var i=null,o=null;if("node"===t){delete this.$multiNodes[e],i=document.getElementById(e),k.removeClass(i,"item_focus"),o=this.state.$nodes[e];var n=this.$nodeTypeMap[o.type]||o.type;o.marked?(k.addClass(i,"item_mark"),i.style.borderColor=this.GooFlow.color.mark):n.indexOf(" mix")>0?i.style.borderColor=this.GooFlow.color.mix:this.$nodeCustoms[n]?i.style.borderColor="transparent":i.style.borderColor=this.state.$nodes[e].color||this.GooFlow.color.node}else"line"===t&&(delete this.$multiLines[e],o=this.state.$lines[e],i=document.getElementById(e).querySelector("path[stroke-linecap='round']"),o.marked||(i.setAttribute("stroke",o.color||this.GooFlow.color.line),o.noArrow||i.setAttribute("marker-end","url(#arrow1)")));s&&this._wallAllMulti()},_clearMultiList:function(){for(var e in this.$multiNodes)this._removeFromMultiList(e,"node");for(var t in this.$multiLines)this._removeFromMultiList(t,"line");this._wallAllMulti()},_initMultiSelect:function(e){var t=this;t.$multiKey=e,this.$refs.$workArea.addEventListener("mousedown",(function(e){var s={X:0,Y:0};if("cursor"===t.state.$nowType){if(t._isMultiKey(e))return!1;if(t.$refs.$multiGhost.inShow()){if(0===Object.keys(t.$multiLines).length&&0===Object.keys(t.$multiNodes).length)return void t._wallAllMulti();var i=t.$refs.$multiGhost.position(),o=t.$refs.$multiGhost.offsetSize();if(!((s=x.getCoor(e,this)).X<i.left||s.X>i.left+o.width||s.Y<i.top||s.Y>i.top+o.height))return o.left=i.left,o.top=i.top,void t._bindMoveEvent(e,o,(function(e,t,s,i,n){e&&t.batchMove(t.$multiNodes,t.$multiLines,i-o.left,n-o.top),t._wallAllMulti()}));var n=e.target,r=n.tagName;if(!("svg"===r||"DIV"===r&&n.className.indexOf("GooFlow_work")>-1||"LABEL"===r))return;t.$refs.$multiGhost.show({left:s.X+"px",top:s.Y+"px",width:"0px",height:"0px"}),t.$refs.$multiOper.hide()}else{var a=e.target,l=a.tagName;if(!("svg"===l||"DIV"===l&&a.className.indexOf("GooFlow_work")>-1||"LABEL"===l))return;s=x.getCoor(e,this),t.$refs.$multiGhost.show({left:s.X+"px",top:s.Y+"px",width:"0",height:"0"}),t.$refs.$multiOper.hide()}var h=!1;document.onmousemove=function(e){e||(e=window.event);var i=x.getCoor(e,t.$refs.$workArea),o=i.X-s.X,n=i.Y-s.Y,r=t.$refs.$multiGhost.position();o<0&&(r.left=s.X+o,o*=-1),n<0&&(r.top=s.Y+n,n*=-1),h=!0,t.$refs.$multiGhost.css({left:r.left+"px",top:r.top+"px",width:o+"px",height:n+"px"})},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null;var s=t.$refs.$multiGhost.position(),i=t.$refs.$multiGhost.offsetSize(),o=s.left,n=s.top,r=i.width,a=i.height;if(""!==t.state.$focus&&t.blurItem(!1),t._clearMultiList(),h){for(var l in t.state.$nodes){var d=t.state.$nodes[l],c={left:d.left*t.scale,top:d.top*t.scale,right:(d.left+d.width)*t.scale,bottom:(d.top+d.height)*t.scale};if(!(c.left>=o&&c.left<=o+r||c.right>=o&&c.right<=o+r)||!(c.top>=n&&c.top<=n+a||c.bottom>=n&&c.bottom<=n+a))if(!(c.left<=o&&c.right>=o+r&&(n<=c.top&&n+a>=c.top||n<=c.bottom&&n+a>=c.bottom))&&!(c.top<=n&&c.bottom>=n+a&&(o<=c.left&&o+r>=c.left||o<=c.right&&o+r>=c.right)))continue;t._addtoMultiList(l,"node")}for(var p in t.state.$lines){var u,f,m=t.state.$lines[p],g=void 0,v=document.getElementById(p),$=v.getAttribute("from").split(","),b=[];b[0]=parseFloat($[0]),b[1]=parseFloat($[1]);var y=v.getAttribute("to").split(","),w=[];w[0]=parseFloat(y[0]),w[1]=parseFloat(y[1]),"sl"===m.type||("tb"===m.type?(b[1]=m.M,w[1]=m.M):"lr"===m.type&&(b[0]=m.M,w[0]=m.M)),u=b[0]>=o&&b[0]<=o+r&&b[1]>=n&&b[1]<=n+a,f=w[0]>=o&&w[0]<=o+r&&w[1]>=n&&w[1]<=n+a,(u||f||("tb"===m.type?g=n<=w[1]&&w[1]<=n+a&&(b[0]<=o&&w[0]>=o+r||w[0]<=o&&b[0]>=o+r):"lr"===m.type&&(g=o<=w[0]&&w[0]<=o+r&&(b[1]<=n&&w[1]>=n+a||w[1]<=n&&b[1]>=n+a)),g))&&t._addtoMultiList(p,"line")}t._wallAllMulti(),x.stopEventPop(e)}}}}))},batchMarkItem:function(e,t,s){if("function"!==typeof this.onBatchMark||!1!==this.onBatchMark(e,t,s)){if("object"===typeof e&&"number"===typeof e.length&&e.length>0)for(var i=0;i<e.length;++i)this.markItem(e[i],s,!1,!0,!0);if("object"===typeof t&&"number"===typeof t.length&&t.length>0)for(var o=0;o<t.length;++o)this.markItem(t[o],s,!1,!0,!0);"function"===typeof this.pushOper&&this.pushOper("batchMarkItem",[e,t,s]),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},batchAddItem:function(e,t){if("function"!==typeof this.onBatchAdd||!1!==this.onBatchAdd(e,t)){var s=[],i=[];for(var o in e)this.addNode(o,e[o],!1,!0,!0),i.push(o);for(var n in t)this.addLine(n,t[n],!1,!0,!0),s.push(n);"function"===typeof this.pushOper&&this.$editable&&this.pushOper("batchDelete",[i,s]),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},batchDelete:function(e,t){if("function"!==typeof this.onBatchDel||!1!==this.onBatchDel(e,t)){var s={},i={};if("object"===typeof e&&"number"===typeof e.length&&e.length>0)for(var o=0;o<e.length;++o)if(this.state.$nodes[e[o]]&&null!=this.state.$nodes[e[o]]){for(var n in i[e[o]]=JSON.parse(JSON.stringify(this.state.$nodes[e[o]])),this.state.$lines)this.state.$lines[n].from!==e[o]&&this.state.$lines[n].to!==e[o]||(s[n]=JSON.parse(JSON.stringify(this.state.$lines[n])),this.delLine(n,!1,!0,!0),this.$multiLines&&delete this.$multiLines[n]);this.delNode(e[o],!1,!0,!0),this.$multiNodes&&delete this.$multiNodes[e[o]]}if("object"===typeof t&&"number"===typeof t.length&&t.length>0)for(var r=0;r<t.length;++r)this.state.$lines[t[r]]&&null!=this.state.$lines[t[r]]&&(s[t[r]]=JSON.parse(JSON.stringify(this.state.$lines[t[r]])),this.delLine(t[r],!1,!0,!0),this.$multiLines&&delete this.$multiLines[t[r]]);"function"===typeof this.pushOper&&this.$editable&&this.pushOper("batchAddItem",[i,s]),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}},batchMove:function(e,t,s,i){if((0!==Object.keys(e).length||0!==Object.keys(t).length)&&"number"===typeof s&&"number"===typeof i&&("function"!==typeof this.onBatchMove||!1!==this.onBatchMove(e,t,s,i))){var o={},n={};if("object"===typeof e)for(var r in e){var a=this.state.$nodes[r];a&&null!=a&&(this.moveNode(r,a.left+s,a.top+i,!1,!0,!0),o[r]=r)}if("object"===typeof t)for(var l in t){var h=this.state.$lines[l];if(h&&null!=h&&("lr"===h.type||"tb"===h.type)){h.Ml="lr"===h.type?i+h.Ml:s+h.Ml,h.Mr="lr"===h.type?i+h.Mr:s+h.Mr;var d="lr"===h.type?s+h.M:i+h.M;h.M=-1,this.setLineM(l,d,!0,!1,!0),n[l]=l}}"function"===typeof this.pushOper&&this.$editable&&this.pushOper("batchMove",[o,n,-1*s,-1*i]),this.$navMap&&this.$nextTick((function(){this.refreshMap()}))}}}};s(15);var fe=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"multi_demo",width:"900",height:"600",haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,useOperStack:!0,haveMulti:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,toolBtns:["start round mix","end round","task","node","chat","state","plug","join","fork","complex mix"],toolTextWidth:60,multiKey:"ctrl",auth:Z.auth},i.global=q,i.plugIns=[J,U,Y,V,ue],i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsx)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:"\u591a\u9009\u5b9e\u9a8c"});return Object(f.jsx)("div",{id:"DemoMulti",children:Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,ref:function(t){return e.gooFlow=t}})})}},{key:"componentDidMount",value:function(){var e=this.gooFlow;Q.a.get("./demo/data2.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.loadData(t.data)})),e.bindOperEvent({onPrintClick:function(){e.print()}})}}]),s}(o.a.Component),me={canvasExtend:function(){se()},_toNum:function(e){return null!==e&&""!==e?parseInt(e.split("px")[0],10):void 0},_analyseArea:function(e){var t=e.querySelector(".bg"),s=x.getRealStyle(t);return{top:this._toNum(e.style.top),left:this._toNum(e.style.left),width:e.offsetWidth,height:e.offsetHeight,borderColor:s.borderTopColor,bgColor:s.backgroundColor,opacity:parseFloat(s.opacity)}},renderAreas:function(e,t,s){for(var i in t){var o=t[i];e.save(),o.bgColor=o.bgColor.replace("rgb","rgba").replace(")",", "+o.opacity+")"),o.borderColor=o.borderColor.replace("rgb","rgba").replace(")",", "+o.opacity+")"),e.fillStyle=o.bgColor,e.strokeStyle=o.borderColor,e.beginPath(),e.rect(o.left*s,o.top*s,o.width*s,o.height*s),e.fill(),e.stroke(),e.closePath(),e.restore()}},_analyseMemo:function(e,t){var s=x.getRealStyle(e);return{top:this._toNum(e.style.top)*t,left:this._toNum(e.style.left)*t,width:e.offsetWidth*t,height:e.offsetHeight*t,bgColor:s.color}},renderMemos:function(e,t){for(var s in t){var i=t[s];e.save(),e.fillStyle=i.bgColor,e.beginPath(),e.moveTo(i.left+5,i.top),e.lineTo(i.left+i.width,i.top),e.lineTo(i.left+i.width,i.top+i.height),e.lineTo(i.left,i.top+i.height),e.lineTo(i.left,i.top+5),e.lineTo(i.left+5,i.top),e.closePath(),e.fill(),e.restore(),e.save(),e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.moveTo(i.left+5,i.top),e.lineTo(i.left+5,i.top+5),e.lineTo(i.left,i.top+5),e.lineTo(i.left+5,i.top),e.closePath(),e.fill(),e.restore()}},_analyseNode:function(e,t){var s="";k.hasClass(e,"item_ellipse")&&(s="ellipse"),k.hasClass(e,"item_rhomb")&&(s="rhomb"),k.hasClass(e,"item_round")&&(s="round"),k.hasClass(e,"item_parallelogram")&&(s="parallelogram"),k.hasClass(e,"item_custom")&&(s="custom");var i=x.getRealStyle(e),o={top:this._toNum(e.style.top)*t,left:this._toNum(e.style.left)*t,width:e.offsetWidth*t,height:e.offsetHeight*t,borderColor:i.borderTopColor,borderWidth:this._toNum(i.borderTopWidth)*t,bgColor:i.backgroundColor,borderRadius:this._toNum(i.borderTopLeftRadius),spClass:s};return"custom"===s&&(o.borderColor="#999999"),o},renderNodes:function(e,t){for(var s in e.save(),t){var i=t[s];e.fillStyle=i.bgColor,"ellipse"===i.spClass?e.BezierEllipse(i.left+i.width/2,i.top+i.height/2,i.width/2,i.height/2).fill():"rhomb"===i.spClass?(e.save(),e.translate(i.left+i.width/2,i.top+i.height/2),e.rotate(45*Math.PI/180),e.roundRect(-i.width/2,-i.height/2,i.width-i.borderWidth,i.height-i.borderWidth,i.borderRadius).fill(),e.restore()):"parallelogram"===i.spClass?(e.save(),e.translate(i.left+i.width/2,i.top+i.height/2),e.transform(1,0,-12/i.height,1,0,0),e.roundRect(-i.width/2,-i.height/2,i.width-i.borderWidth,i.height-i.borderWidth,i.borderRadius).fill(),e.restore()):"custom"===i.spClass?(e.save(),e.strokeStyle=i.borderColor,e.lineCap="round",e.roundRect(i.left,i.top,i.width,i.height,i.borderRadius).stroke(),e.beginPath(),e.moveTo(i.left+2,i.top+2),e.lineTo(i.left+i.width-2,i.top+i.height-2),e.moveTo(i.left+2,i.top+i.height-2),e.lineTo(i.left+i.width-2,i.top+2),e.closePath(),e.stroke(),e.restore()):e.roundRect(i.left,i.top,i.width,i.height,i.borderRadius).fill(),"custom"!==i.spClass&&(e.strokeStyle=i.borderColor,e.lineWidth=0!==i.borderWidth?i.borderWidth:.1,e.stroke())}e.restore()},_analyseLine:function(e,t){var s=e.querySelector("path[stroke-linecap]"),i=s.getAttribute("marker-end"),o={color:s.getAttribute("stroke"),lineWidth:s.getAttribute("stroke-width")*t,lineCap:"round",noArrow:!i||null==i},n=s.style.strokeDasharray;o.lineDash=n&&null!=n;for(var r=s.getAttribute("d"),a=r.substring(2,r.length).split(/[L|Q]/),l=[],h=0;h<a.length;++h){a[h]=a[h].replace(/^\s+|\s+$/gm,"");var d=a[h].split(" ");2===d.length?l.push({x:parseFloat(d[0])*t,y:parseFloat(d[1])*t}):l.push({x:parseFloat(d[0])*t,y:parseFloat(d[1])*t,dX:parseFloat(d[2])*t,dY:parseFloat(d[3])*t})}o.points=l;var c=l.length,p=l[c-1].x-l[c-2].x,u=l[c-1].y-l[c-2].y;return o.angle=Math.atan2(u,p),o},renderLines:function(e,t){for(var s in t){var i=t[s];e.save(),e.setLineDash(i.lineDash?[2,3]:[]),e.strokeStyle=i.color,e.lineWidth=i.lineWidth,e.lineCap=i.lineCap;var o=i.points;e.beginPath(),e.moveTo(o[0].x,o[0].y);for(var n=1;n<o.length;++n)if(o[n].dX){var r=o[n].y===o[n].dY?Math.abs(o[n].x-o[n].dX):Math.abs(o[n].y-o[n].dY);e.arcTo(o[n].x,o[n].y,o[n].dX,o[n].dY,r),e.moveTo(o[n].dX,o[n].dY)}else e.lineTo(o[n].x,o[n].y),n!==o.length-1&&e.moveTo(o[n].x,o[n].y);e.closePath(),e.stroke(),i.noArrow||(e.translate(o[o.length-1].x,o[o.length-1].y),e.rotate(i.angle),e.fillStyle=i.color,e.beginPath(),e.moveTo(1*i.lineWidth,0),e.lineTo(-6*i.lineWidth,-3*i.lineWidth),e.lineTo(-6*i.lineWidth,3*i.lineWidth),e.lineTo(1*i.lineWidth,0),e.closePath(),e.fill()),e.restore()}},_clearMap:function(e){e.getContext("2d").clearRect(0,0,parseInt(e.getAttribute("width")),parseInt(e.getAttribute("height")));var t=e.nextSibling;t&&null!=t&&"viewbox"===t.className&&(t.style.top=0,t.style.left=0,t.style.width="100%",t.style.height="100%")}},ge={flag:"navmap",initFuncName:"canvasExtend",methods:{canvasExtend:function(){me.canvasExtend()},_locateViewBox:function(e){var t=this.$navMap.querySelector(".viewbox"),s=this.$refs.$workArea.parentNode,i=s.scrollLeft*e,o=s.scrollTop*e;t.style.left=i+"px",t.style.top=o+"px",t.style.width=s.clientWidth*e+"px",t.style.height=s.clientHeight*e+"px"},refreshMap:function(){var e=this.$navMap.querySelector("canvas"),t=e.getContext("2d");me._clearMap(e);var s=this._buildWorkSize();if(s.haveData){var i=e.width/s.width>e.height/s.height?e.height/s.height:e.width/s.width;this.$navMap.setAttribute("scale",""+i);for(var o={},n=this.$refs.$group.querySelectorAll(".GooFlow_area"),r=0;r<n.length;++r)o[n[r].id]=me._analyseArea(n[r]);me.renderAreas(t,o,i);for(var a={},l=this.$refs.$paper.querySelectorAll(".GooFlow_memo"),h=0;h<l.length;++h)a[l[h].id]=me._analyseMemo(l[h],i);me.renderMemos(t,a);for(var d={},c=this.$refs.$workArea.querySelectorAll(".GooFlow_item"),p=0;p<c.length;++p)d[c[p].id]=me._analyseNode(c[p],i);me.renderNodes(t,d);for(var u={},f=this.$refs.$draw.querySelectorAll("g"),m=0;m<f.length;++m)"GooFlow_tmp_line"!==f[m].getAttribute("tid")&&(u[f[m].id]=me._analyseLine(f[m],i));me.renderLines(t,u),this._locateViewBox(i)}},_initNavMap:function(e){if(e&&null!=e&&""!==e)if(this.$navMap=document.querySelector(e),this.$navMap&&null!=this.$navMap){var t=this.$navMap.clientWidth,s=this.$navMap.clientHeight;this.$navMap.className="GooFlow_nav_map",this.$navMap.style.width=t+"px",this.$navMap.style.height=s+"px",this.$navMap.setAttribute("unselectable","on"),this.$navMap.setAttribute("onselectstart","return false"),this.$navMap.setAttribute("onselect","document.selection.empty()");var i=document.createElement("canvas");i.className="map",i.width=t,i.height=s,this.$navMap.appendChild(i),(window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("Edge")>-1)&&(i=window.G_vmlCanvasManager.initElement(i));var o=document.createElement("div");o.className="viewbox",this.$navMap.appendChild(o);var n=this;this.$refs.$workArea.parentNode.addEventListener("scroll",(function(e){n._locateViewBox(parseFloat(n.$navMap.getAttribute("scale")))})),this.$navMap.querySelector(".viewbox").addEventListener("mousedown",(function(e){this.parentNode.setAttribute("isDown","1");var t=x.mouseP(e),s=n.$refs.$workArea.parentNode,i=t.x,o=t.y,r=s.scrollLeft,a=s.scrollTop,l=parseFloat(this.parentNode.getAttribute("scale"));document.onmousemove=function(e){if("1"===n.$navMap.getAttribute("isDown")){e||(e=window.event);var t=x.mouseP(e);if(i===t.x&&o===t.y)return!1;s.scrollLeft=r+(t.x-i)/l,s.scrollTop=a+(t.y-o)/l}},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,n.$navMap.removeAttribute("isDown")}}))}else delete this.$navMap}}};s(15),s(24);var ve=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"aaaabbb",width:"800",height:"500",haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,useOperStack:!0,haveMulti:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,toolBtns:["huber","router","plug2","complex mix"],nodeCustoms:{huber:{class:"custom_huber",width:102,height:50},router:{class:"custom_router",width:115,height:52}},auth:Z.auth},i.global=q,i.plugIns=[J,U,Y,V,ne,ge],i.exportDiagram=i.exportDiagram.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsxs)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:["\u5b9e\u65f6\u7684\u7f29\u7565\u5bfc\u822a\u56fe ",Object(f.jsx)("button",{type:"button",onClick:this.exportDiagram,children:"\u5bfc\u51fa\u6d41\u7a0b\u56fe\u7247"})]});return Object(f.jsxs)("div",{id:"DemoNavmap",children:[Object(f.jsx)("div",{style:{float:"left",width:"800px"},children:Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,navSelector:"#demo_navmap",ref:function(t){return e.gooFlow=t}})}),Object(f.jsx)("div",{style:{float:"left",width:"280px",border:"1px solid #999",backgroundColor:"#fff"},children:Object(f.jsx)("div",{id:"demo_navmap",style:{height:"180px"}})})]})}},{key:"exportDiagram",value:function(){this.gooFlow.exportDiagram("myFlow")}},{key:"componentDidMount",value:function(){var e=this.gooFlow;Q.a.get("./demo/child.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.loadData(t.data)})),e.bindOperEvent({onPrintClick:function(){e.print()},onBtnSaveClick:function(){e.exportDiagram("myFlow")}})}}]),s}(o.a.Component);s(15);var $e=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"multi_demo",width:"900",height:"600",haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,useOperStack:!0,haveMulti:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,toolBtns:["start round mix","end round","task","node","chat","state","plug","join","fork","complex mix"],toolTextWidth:60,auth:Z.auth},i.global=q,i.plugIns=[J,U,Y,V,ne],i.exportDiagram=i.exportDiagram.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsx)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:Object(f.jsx)("button",{type:"button",onClick:this.exportDiagram,children:"\u5bfc\u51fa\u6d41\u7a0b\u56fe\u7247"})});return Object(f.jsx)("div",{id:"DemoExport",children:Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,ref:function(t){return e.gooFlow=t}})})}},{key:"exportDiagram",value:function(){this.gooFlow.exportDiagram("myFlow")}},{key:"componentDidMount",value:function(){var e=this.gooFlow;Q.a.get("./demo/data2.json",{},{headers:{"Content-Type":"application/json"}}).then((function(t){e.loadData(t.data)})),e.bindOperEvent({onPrintClick:function(){e.print()},onBtnSaveClick:function(){e.exportDiagram("myFlow")}})}}]),s}(o.a.Component),be="    ",ye=be+be,xe=ye+be,we='<?xml version="1.0" encoding="UTF-8"?>\n<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"\n    xmlns:activiti="http://activiti.org/bpmn"\n    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n    targetNamespace="$#targetNamespace#"\n    xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL\n    http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd">\n';function je(e,t,s){var i=s.left+","+s.top+","+s.width+","+s.height;return ye+"<"+t+' id="'+e+'" g="'+i+'"'}function ke(e,t,s,i){var o=(i?"":"\n")+s+"<"+e,n="",r="",a=!1;for(var l in t)"object"===typeof t[l]?r+=ke(l,t[l],s+be):"text"===l?(r+=t[l],a=!0):n+=" "+l+'="'+t[l]+'"';return""===r||a||(r+="\n"+s),o+=n+(""===r?"/>":">"+r+"</"+e+">")}function Oe(e,t){for(var s=0;s<e.attributes.length;++s){var i=e.attributes[s];"id"!==i.nodeName&&(t[i.nodeName]=(o=i.nodeValue,!isNaN(parseFloat(o))&&isFinite(o)?parseFloat(o):"true"===o||"false"!==o&&o))}var o;if(1===e.childNodes.length&&"string"===typeof e.childNodes[0].data)t.text=e.childNodes[0].data;else for(var n=0;n<e.childNodes.length;++n){var r=e.childNodes[n];"string"!==typeof r.data&&(t[r.tagName]={},Oe(r,t[r.tagName]))}}var _e={flag:"xml",methods:{exportBpmnXML:function(e){"undefined"===typeof e&&(e={});var t=we.replace("$#targetNamespace#",this.$extra.targetNamespace||"Examples");for(var s in this.$extra)if("targetNamespace"!==s&&"id"!==s){var i=this.$extra[s];t+="object"===typeof i?ke(s,i,be,!0)+"\n":"    <"+s+">"+i+"</"+s+">\n"}var o=this.$extra.id||"myProcess",n=this.$title||"My Process";for(var r in t+="    <initNum>"+this.$max+"</initNum>\n",t+='    <process id="'+o+'" name="'+n+'">\n',this.state.$areas){var a=this.state.$areas[r];t+=je(r,"swimlane",a),t+=' name="'+r+'" title="'+a.name+'"';var l="";for(var h in a)"left"!==h&&"top"!==h&&"width"!==h&&"height"!==h&&"name"!==h&&("object"===typeof a[h]?l+=ke(h,a[h],xe):t+=" "+h+'="'+a[h]+'"');t+=""===l?"/>\n":">"+l+"\n"+ye+"</swimlane>\n"}for(var d in this.state.$memos){var c=this.state.$memos[d];t+=je(d,"memo",c),t+=">"+c.text+"\n"+ye+"</memo>\n"}for(var p in this.state.$nodes){var u=this.state.$nodes[p],f=e[u.type]||u.type;t+=je(p,f,u);var m="";for(var g in u)"left"===g||"top"===g||"width"===g||"height"===g||"type"===g||("areaId"===g&&null!=u.areaId?t+=' swimlane="'+u.areaId+'"':"object"===typeof u[g]?m+=ke(g,u[g],xe):t+=" "+g+'="'+u[g]+'"');t+=""===m?"/>\n":">"+m+"\n"+ye+"</"+f+">\n"}for(var v in this.state.$lines){var $=this.state.$lines[v];t+=ye+'<sequenceFlow id="'+v+'" sourceRef="'+$.from+'" targetRef="'+$.to+'"';var b="";for(var y in $)"from"!==y&&"to"!==y&&("object"===typeof $[y]?b+=ke(y,$[y],xe):t+=" "+y+'="'+$[y]+'"');t+=""===b?"/>\n":">"+b+"\n"+ye+"</sequenceFlow>\n"}return t+="    </process>\n</definitions>"},loadBpmnXML:function(e,t){"undefined"===typeof t&&(t={});var s={extra:{}};if("string"===typeof e){var i=e;if(window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("Edge")>-1)(e=new(window.ActivexObject||function(){this.loadXML=function(){}})("MSXML2.DOMDocument")).loadXML(i);else e=(new DOMParser).parseFromString(i,"text/xml")}var o=e.getElementsByTagName("definitions")[0];s.extra.targetNamespace=o.getAttribute("targetNamespace");for(var n=0;n<o.childNodes.length;n++){var r=o.childNodes[n];if("string"!==typeof r.data){var a=r.tagName;if("process"!==a){if("initNum"===a){s.initNum=parseInt(r.textContent,10);continue}s.extra[a]={},r.childNodes.length>0&&"string"===typeof r.childNodes[0].data?s.extra[a]=r.childNodes[0].data:Oe(r,s.extra[a])}else{s.extra.id=r.getAttribute("id"),s.title=r.getAttribute("name"),s.lines={},s.nodes={},s.areas={};for(var l=0;l<r.childNodes.length;++l){var h=r.childNodes[l];if("string"!==typeof h.data){var d=h.tagName,c=h.getAttribute("id");if("swimlane"===d){s.areas[c]={},Oe(h,s.areas[c]),delete s.areas[c].id,s.areas[c].name=s.areas[c].title,delete s.areas[c].title;var p=s.areas[c].g.split(",");delete s.areas[c].g,s.areas[c].left=parseFloat(p[0]),s.areas[c].top=parseFloat(p[1]),s.areas[c].width=parseFloat(p[2]),s.areas[c].height=parseFloat(p[3])}else if("memo"===d){"object"!==typeof s.memos&&(s.memos={}),s.memos[c]={},Oe(h,s.memos[c]),delete s.memos[c].id;var u=s.memos[c].g.split(",");delete s.memos[c].g,s.memos[c].left=parseFloat(u[0]),s.memos[c].top=parseFloat(u[1]),s.memos[c].width=parseFloat(u[2]),s.memos[c].height=parseFloat(u[3])}else if("sequenceFlow"===d)s.lines[c]={},Oe(h,s.lines[c]),delete s.lines[c].id,s.lines[c].from=s.lines[c].sourceRef,s.lines[c].to=s.lines[c].targetRef,delete s.lines[c].sourceRef,delete s.lines[c].targetRef;else{s.nodes[c]={},Oe(h,s.nodes[c]),delete s.nodes[c].id,"undefined"!==typeof s.nodes[c].swimlane&&(s.nodes[c].areaId=s.nodes[c].swimlane,delete s.nodes[c].swimlane);var f=s.nodes[c].g.split(",");delete s.nodes[c].g,s.nodes[c].left=parseFloat(f[0]),s.nodes[c].top=parseFloat(f[1]),s.nodes[c].width=parseFloat(f[2]),s.nodes[c].height=parseFloat(f[3]),s.nodes[c].type=t[h.tagName]||h.tagName}}}}}}this.loadData(s)}}};s(15);var Ne=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(e){var i;return Object(a.a)(this,s),(i=t.call(this,e)).gooFlow=null,i.myProps={id:"aaaabbb",width:"900",height:"430",haveHead:!0,headLabel:!0,headBtns:["new","open","save","undo","redo","reload","print"],haveTool:!0,useOperStack:!0,haveMulti:!0,haveDirDashed:!0,haveSegment:!0,haveSegDashed:!0,toolBtns:["start round mix","end round","task","node","state","complex mix"],toolTextWidth:60,auth:Z.auth},i.global=q,i.plugIns=[J,U,Y,V,_e,ne],i.exportXml=i.exportXml.bind(Object($.a)(i)),i.loadXmlAjax=i.loadXmlAjax.bind(Object($.a)(i)),i.DownloadFile=i.DownloadFile.bind(Object($.a)(i)),i}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=Object(f.jsxs)("div",{style:{marginLeft:"auto",marginRight:"15px"},children:[Object(f.jsx)("button",{type:"button",onClick:this.loadXmlAjax,children:"AJAX\u8f7d\u5165XML\u6570\u636e"}),Object(f.jsx)("button",{type:"button",onClick:this.exportXml,children:"\u5bfc\u51faXML\u6570\u636e"}),Object(f.jsx)("button",{type:"button",onClick:this.DownloadFile.bind(this,"flowJson","json"),children:"\u4e0b\u8f7dJSON"}),Object(f.jsx)("button",{type:"button",onClick:this.DownloadFile.bind(this,"flowXml","xml"),children:"\u4e0b\u8f7dXML"})]});return Object(f.jsxs)("div",{id:"DemoXml",children:[Object(f.jsx)(G,{property:this.myProps,global:this.global,plugIns:this.plugIns,headerCustom:t,ref:function(t){return e.gooFlow=t}}),Object(f.jsx)("textarea",{style:{width:"900px",height:"200px"},id:"xmlResult",readOnly:!0})]})}},{key:"DownloadFile",value:function(e,t){this.gooFlow.exportDataFile(e,t)}},{key:"exportXml",value:function(){document.getElementById("xmlResult").value=this.gooFlow.exportBpmnXML({"start round mix":"startEvent","end round mix":"endEvent"})}},{key:"loadXmlAjax",value:function(){var e=this.gooFlow;Q.a.get("./demo/data2.xml",{}).then((function(t){e.loadBpmnXML(t.data,{startEvent:"start round mix",endEvent:"end round mix"})}))}},{key:"componentDidMount",value:function(){this.loadXmlAjax()}}]),s}(o.a.Component),Me=function(e){Object(h.a)(s,e);var t=Object(d.a)(s);function s(){return Object(a.a)(this,s),t.apply(this,arguments)}return Object(l.a)(s,[{key:"render",value:function(){return Object(f.jsx)(c.a,{children:Object(f.jsxs)("div",{children:[Object(f.jsxs)("ul",{className:"nav",children:[Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/",children:"Home"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/base",children:"\u57fa\u672c\u529f\u80fd\u4f7f\u7528"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/import",children:"\u7b80\u5355\u7684\u6570\u636e\u5bfc\u5165"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/dragadd",children:"\u62d6\u62fd\u64cd\u4f5c\u65b9\u5f0f\u6dfb\u52a0\u5757\u5143\u7d20"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/readonly",children:"\u53ea\u8bfb\u6a21\u5f0f"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/spnode",children:"\u7279\u6b8a\u5f62\u72b6\u7684\u8282\u70b9"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/slot",children:"\u81ea\u5b9a\u4e49\u6e32\u67d3\u5185\u5bb9\u7684\u63d2\u69fd\u8282\u70b9"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/custom",children:"\u81ea\u5b9a\u4e49\u80cc\u666f\u56fe\u8282\u70b9"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/multi",children:"\u591a\u9009\u529f\u80fd\u64cd\u4f5c"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/navmap",children:"\u5b9e\u65f6\u7684\u7f29\u7565\u5bfc\u822a\u56fe"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/export",children:"\u5bfc\u51fa\u6d41\u7a0b\u56fe\u7247"})}),Object(f.jsx)("li",{children:Object(f.jsx)(c.b,{exact:!0,activeClassName:"selected",to:"/xml",children:"BPMN2.0 XML\u6570\u636e\u652f\u6301"})})]}),Object(f.jsxs)("div",{className:"content",children:[Object(f.jsx)(p.a,{path:"/",exact:!0,component:g}),Object(f.jsx)(p.a,{path:"/base",exact:!0,component:ee}),Object(f.jsx)(p.a,{path:"/import",exact:!0,component:re}),Object(f.jsx)(p.a,{path:"/dragadd",exact:!0,component:le}),Object(f.jsx)(p.a,{path:"/readonly",exact:!0,component:he}),Object(f.jsx)(p.a,{path:"/spnode",exact:!0,component:de}),Object(f.jsx)(p.a,{path:"/slot",exact:!0,component:ce}),Object(f.jsx)(p.a,{path:"/custom",exact:!0,component:pe}),Object(f.jsx)(p.a,{path:"/multi",exact:!0,component:fe}),Object(f.jsx)(p.a,{path:"/navmap",exact:!0,component:ve}),Object(f.jsx)(p.a,{path:"/export",exact:!0,component:$e}),Object(f.jsx)(p.a,{path:"/xml",exact:!0,component:Ne})]})]})})}}]),s}(i.Component),Ce=Me;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(f.jsx)(Ce,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[77,1,2]]]);